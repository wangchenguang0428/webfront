<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>40.6. 规则和命令状态</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="rules-privileges.html" title="40.5. 规则和权限" /><link rel="next" href="rules-triggers.html" title="40.7. 规则 vs 触发器" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">40.6. 规则和命令状态</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="rules-privileges.html" title="40.5. 规则和权限">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="rules.html" title="第 40 章 规则系统">上一级</a></td><th width="60%" align="center">第 40 章 规则系统</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="rules-triggers.html" title="40.7. 规则 vs 触发器">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="RULES-STATUS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">40.6. 规则和命令状态</h2></div></div></div><p>
    <span class="productname">PostgreSQL</span>服务器为它收到的每个命令返回一个命令状态字符串，例如<code class="literal">INSERT 149592 1</code>。没有涉及规则时这很简单，但是查询被规则重写时会发生什么呢？
</p><p>
    规则对命令状态的影响如下：

    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       如果没有查询的无条件<code class="literal">INSTEAD</code>规则，那么原始给出的查询将会被执行，并且它的命令状态将像平常一样被返回（但是请注意如果存在任何有条件<code class="literal">INSTEAD</code>规则，那么它们的反条件将被加到原始查询中。这样可能会减少它处理的行数，并且报告的状态将受影响）。
      </p></li><li class="listitem"><p>
       如果有查询的任何无条件<code class="literal">INSTEAD</code>规则，那么原始查询将完全不被执行。在这种情况下，服务器将返回由服务器将返回由<code class="literal">INSTEAD</code>规则（有条件的或无条件的）插入的最后一条和原始查询命令类型（<code class="command">INSERT</code>、<code class="command">UPDATE</code>或<code class="command">DELETE</code>）相同的查询的命令状态。如果任何规则添加的查询都不符合这些要求，那么返回的命令状态显示原始查询类型并且行计数和 OID 域为零。
      </p></li></ul></div><p>
</p><p>
    通过为任何想要的<code class="literal">INSTEAD</code>规则指定在活动规则中排名最后的规则名，程序员可以确保该规则都是在第二种情况里设置命令状态的规则，因为它会被最后一个应用。
</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="rules-privileges.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="rules.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="rules-triggers.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">40.5. 规则和权限 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 40.7. 规则 vs 触发器</td></tr></table></div></body></html>