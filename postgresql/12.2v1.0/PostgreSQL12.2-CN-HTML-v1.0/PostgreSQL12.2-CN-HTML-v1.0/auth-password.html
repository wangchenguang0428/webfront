<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>20.5. 口令认证</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="auth-trust.html" title="20.4. 信任认证" /><link rel="next" href="gssapi-auth.html" title="20.6. GSSAPI 认证" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">20.5. 口令认证</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="auth-trust.html" title="20.4. 信任认证">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="client-authentication.html" title="第 20 章 客户端认证">上一级</a></td><th width="60%" align="center">第 20 章 客户端认证</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="gssapi-auth.html" title="20.6. GSSAPI 认证">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="AUTH-PASSWORD"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.5. 口令认证</h2></div></div></div><a id="id-1.6.7.12.2" class="indexterm"></a><a id="id-1.6.7.12.3" class="indexterm"></a><a id="id-1.6.7.12.4" class="indexterm"></a><p>
    有几种基于口令的认证方法。这些方法的过程类似，但是区别在于用户口令如何被存放在服务器上以及客户端提供的口令如何被通过连接发送。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">scram-sha-256</code></span></dt><dd><p>
       方法<code class="literal">scram-sha-256</code>按照<a class="ulink" href="https://tools.ietf.org/html/rfc7677" target="_top">RFC 7677</a>中的描述执行SCRAM-SHA-256认证。它使用的是一种挑战-响应的方案，可以防止在不可信连接上对口令的嗅探并且支持在服务器上以一种加密哈希的方式存放口令，因此被认为是安全的。
      </p><p>
       这是当前提供的方法中最安全的一种，但是旧的客户端库不支持这种方法。
      </p></dd><dt><span class="term"><code class="literal">md5</code></span></dt><dd><p>
       方法<code class="literal">md5</code>使用一种自定义的安全性较低的挑战-响应机制。它能防止口令嗅探并且防止口令在服务器上以明文存储，但是无法保护攻击者想办法从服务器上窃取了口令哈希的情况。此外，现在认为MD5哈希算法对于确定攻击已经不再安全。
      </p><p>
       <code class="literal">md5</code>方法不能与<a class="xref" href="runtime-config-connection.html#GUC-DB-USER-NAMESPACE">db_user_namespace</a>特性一起使用。
      </p><p>
       为了简化从<code class="literal">md5</code>方法到较新的SCRAM方法的转变，如果在<code class="filename">pg_hba.conf</code>中指定了<code class="literal">md5</code>但是用户在服务器上的口令是为SCRAM（见下文）加密的，则将自动选择基于SCRAM的认证。
      </p></dd><dt><span class="term"><code class="literal">password</code></span></dt><dd><p>
       方法<code class="literal">password</code>以明文形式发送口令，因此它对于口令<span class="quote">“<span class="quote">嗅探</span>”</span>攻击很脆弱。如果可能应该尽量避免使用它。不过，如果连接被SSL加密保护着，那么可以安全地使用<code class="literal">password</code>（不过如果依靠SSL，SSL证书认证可能是更好的选择）。
      </p></dd></dl></div><p>
    <span class="productname">PostgreSQL</span>数据库口令独立于操作系统用户口令。每个数据库用户的口令被存储在<code class="literal">pg_authid</code>系统目录中。口令可以用 SQL 命令<a class="xref" href="sql-createuser.html" title="CREATE USER"><span class="refentrytitle">CREATE USER</span></a>和<a class="xref" href="sql-alterrole.html" title="ALTER ROLE"><span class="refentrytitle">ALTER ROLE</span></a>管理，例如<strong class="userinput"><code>CREATE ROLE foo WITH LOGIN PASSWORD 'secret'</code></strong>或者<span class="application">psql</span>的<code class="literal">\password</code>命令。如果没有为一个用户设置口令，那么存储的口令为空并且对该用户的口令认证总会失败。
   </p><p>
    不同的基于口令的认证方法的可用性取决于用户的口令在服务器上是如何被加密（或者更准确地说是哈希）的。这由设置口令时的配置参数<a class="xref" href="runtime-config-connection.html#GUC-PASSWORD-ENCRYPTION">password_encryption</a>控制。如果口令使用<code class="literal">scram-sha-256</code>设置加密，那么它可以被用于认证方法<code class="literal">scram-sha-256</code>和<code class="literal">password</code>（但后一种情况中口令将以明文传输）。如上所释，在这种情况下，指定的认证方法<code class="literal">md5</code>将自动切换到使用<code class="literal">scram-sha-256</code>方法。如果口令使用<code class="literal">md5</code>设置加密，那么它仅能用于<code class="literal">md5</code>和<code class="literal">password</code>认证方法说明（同样，后一种情况中口令以明文传输）。（之前的PostgreSQL发行版支持在服务器上存储明文口令。现在已经不可能了）。要检查当前存储的口令哈希，可以参考系统目录<code class="literal">pg_authid</code>。
   </p><p>
    要把现有的安装从<code class="literal">md5</code>升级到<code class="literal">scram-sha-256</code>，可以在确保所有在用的客户端已经足以支持SCRAM之后，在<code class="filename">postgresql.conf</code>中设置<code class="literal">password_encryption = 'scram-sha-256'</code>，然后让所有用户设置新口令并且在<code class="filename">pg_hba.conf</code>中将认证方法说明改为<code class="literal">scram-sha-256</code>.
   </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="auth-trust.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="client-authentication.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="gssapi-auth.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">20.4. 信任认证 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 20.6. GSSAPI 认证</td></tr></table></div></body></html>