<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>10.4. 值存储</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="typeconv-func.html" title="10.3. 函数" /><link rel="next" href="typeconv-union-case.html" title="10.5. UNION、CASE和相关结构" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">10.4. 值存储</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="typeconv-func.html" title="10.3. 函数">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="typeconv.html" title="第 10 章 类型转换">上一级</a></td><th width="60%" align="center">第 10 章 类型转换</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="typeconv-union-case.html" title="10.5. UNION、CASE和相关结构">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="TYPECONV-QUERY"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.4. 值存储</h2></div></div></div><p>
   将被插入到一个表的值会按照下列步骤被转换到目标列的数据类型。
  </p><div class="procedure" id="id-1.5.9.9.3"><p class="title"><strong>值存储类型转换</strong></p><ol class="procedure" type="1"><li class="step"><p>
检查一个与目标的准确匹配。
</p></li><li class="step"><p>
否则，尝试转换表达式为目标类型。如果在两种类型之间的一个
<em class="firstterm">赋值造型</em>已经被注册在<code class="structname">pg_cast</code>
目录（见<a class="xref" href="sql-createcast.html" title="CREATE CAST"><span class="refentrytitle">CREATE CAST</span></a>）中，
这是可能的。或者，如果该表达式是一个未知类型的文字，
则该文字串的内容将被提供给目标类型的输入转换例程。
</p></li><li class="step"><p>
检查是否有一个用于目标类型的尺寸调整造型。尺寸调整造型是一个从该类型到其自身的造型。 如果在<code class="structname">pg_cast</code>目录中找到一个，那么把表达式存储到目标列中之前把它应用到表达式。这样一个造型的实现函数总是采用一个额外的<code class="type">integer</code>类型的参数，它接收目标列的<code class="structfield">atttypmod</code>值（通常是它被声明的长度，尽管对于不同数据类型<code class="structfield">atttypmod</code>有不同的解释），并且它可能采用第三个<code class="type">boolean</code>参数来说明造型是显式的还是隐式的。该造型函数负责应用任何长度相关的语义，例如尺寸检查或截断。
</p></li></ol></div><div class="example" id="id-1.5.9.9.4"><p class="title"><strong>例 10.9. <code class="type">character</code>存储类型转换</strong></p><div class="example-contents"><p>
对于一个声明为<code class="type">character(20)</code>的目标列，下面的语句展示了被存储的值如何被正确地调整尺寸：

</p><pre class="screen">
CREATE TABLE vv (v character(20));
INSERT INTO vv SELECT 'abc' || 'def';
SELECT v, octet_length(v) FROM vv;

          v           | octet_length
----------------------+--------------
 abcdef               |           20
(1 row)
</pre><p>
</p><p>
实际发生的事情是两个未知文字被默认决定为<code class="type">text</code>，允许<code class="literal">||</code>操作符被决定为<code class="type">text</code>连接。 然后操作符的<code class="type">text</code>结果被转换成<code class="type">bpchar</code>（<span class="quote">“<span class="quote">空白填充字符</span>”</span>，<code class="type">character</code>数据类型的内部名称）来匹配目标列类型（由于从<code class="type">text</code>到<code class="type">bpchar</code>的转换是二进制强制的，这个转换不会插入任何实际的函数调用）。最后，尺寸调整函数<code class="literal">bpchar(bpchar, integer, boolean)</code>被从系统目录中找到并应用到操作符的结果和存储的列长度上。这个类型相关的函数执行必要的长度检查并增加填充的空间。
</p></div></div><br class="example-break" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="typeconv-func.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="typeconv.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="typeconv-union-case.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">10.3. 函数 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 10.5. <code class="literal">UNION</code>、<code class="literal">CASE</code>和相关结构</td></tr></table></div></body></html>