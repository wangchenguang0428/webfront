<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>11.3. 多列索引</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="indexes-types.html" title="11.2. 索引类型" /><link rel="next" href="indexes-ordering.html" title="11.4. 索引和ORDER BY" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">11.3. 多列索引</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="indexes-types.html" title="11.2. 索引类型">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="indexes.html" title="第 11 章 索引">上一级</a></td><th width="60%" align="center">第 11 章 索引</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="indexes-ordering.html" title="11.4. 索引和ORDER BY">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="INDEXES-MULTICOLUMN"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.3. 多列索引</h2></div></div></div><a id="id-1.5.10.6.2" class="indexterm"></a><p>
   一个索引可以定义在表的多个列上。例如，我们有这样一个表：
</p><pre class="programlisting">
CREATE TABLE test2 (
  major int,
  minor int,
  name varchar
);
</pre><p>
   （即将我们的<code class="filename">/dev</code>目录保存在数据库中）而且我们经常会做如下形式的查询：
</p><pre class="programlisting">
SELECT name FROM test2 WHERE major = <em class="replaceable"><code>constant</code></em> AND minor = <em class="replaceable"><code>constant</code></em>;
</pre><p>
   那么我们可以在<code class="structfield">major</code>和<code class="structfield">minor</code>上定义一个索引：
</p><pre class="programlisting">
CREATE INDEX test2_mm_idx ON test2 (major, minor);
</pre><p>
  </p><p>
   目前，只有 B-tree、GiST、GIN 和 BRIN 索引类型支持多列索引，最多可以指定32个列（该限制可以在源代码文件<code class="filename">pg_config_manual.h</code>中修改，但是修改后需要重新编译<span class="productname">PostgreSQL</span>）。
  </p><p>
   一个B-tree索引可以用于条件中涉及到任意索引列子集的查询，但是当先导列（即最左边的那些列）上有约束条件时索引最为有效。确切的规则是：在先导列上的等值约束，加上第一个无等值约束的列上的不等值约束，将被用于限制索引被扫描的部分。在这些列右边的列上的约束将在索引中被检查，这样它们适当节约了对表的访问，但它们并未减小索引被扫描的部分。例如，在<code class="literal">(a, b, c)</code>上有一个索引并且给定一个查询条件<code class="literal">WHERE a = 5 AND b &gt;= 42 AND c &lt; 77</code>，对索引的扫描将从第一个具有<code class="literal">a</code> = 5和<code class="literal">b</code> = 42的项开始向上进行，直到最后一个具有<code class="literal">a</code> = 5的项。在扫描过程中，具有<code class="literal">c</code> &gt;= 77的索引项将被跳过，但是它们还是会被扫描到。这个索引在原则上可以被用于在<code class="literal">b</code>和/或<code class="literal">c</code>上有约束而在<code class="literal">a</code>上没有约束的查询，但是整个索引都不得不被扫描，因此在大部分情况下规划器宁可使用一个顺序的表扫描来替代索引。
  </p><p>
   一个多列GiST索引可以用于条件中涉及到任意索引列子集的查询。在其余列上的条件将限制由索引返回的项，但是第一列上的条件是决定索引上扫描量的最重要因素。当第一列中具有很少的可区分值时，一个GiST索引将会相对比较低效，即便在其他列上有很多可区分值。
  </p><p>
   一个GIN索引可以用于条件中涉及到任意索引列子集的查询。与B-tree和GiST不同，GIN的搜索效率与查询条件中使用哪些索引列无关。
  </p><p>
   多列 BRIN 索引可以被用于涉及该索引被索引列的任意子集的查询条件。和 GIN 相似且不同于 B-树 或者 GiST，索引搜索效率与查询条件使用哪个索引列无关。在单个表上使用多个 BRIN 索引来取代一个多列 BRIN 索引的唯一原因是为了使用不同的<code class="literal">pages_per_range</code>存储参数。
  </p><p>
   当然，要使索引起作用，查询条件中的列必须要使用适合于索引类型的操作符，使用其他操作符的子句将不会被考虑使用索引。
  </p><p>
   多列索引应该较少地使用。在绝大多数情况下，单列索引就足够了且能节约时间和空间。具有超过三个列的索引不太有用，除非该表的使用是极端程式化的。<a class="xref" href="indexes-bitmap-scans.html" title="11.5. 组合多个索引">第 11.5 节</a>以及<a class="xref" href="indexes-index-only-scans.html" title="11.9. 只用索引的扫描和覆盖索引">第 11.9 节</a>中有对不同索引配置优点的讨论。
  </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="indexes-types.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="indexes.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="indexes-ordering.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">11.2. 索引类型 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 11.4. 索引和<code class="literal">ORDER BY</code></td></tr></table></div></body></html>