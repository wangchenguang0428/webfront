<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>8.4. 二进制数据类型</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="datatype-character.html" title="8.3. 字符类型" /><link rel="next" href="datatype-datetime.html" title="8.5. 日期/时间类型" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">8.4. 二进制数据类型</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="datatype-character.html" title="8.3. 字符类型">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="datatype.html" title="第 8 章 数据类型">上一级</a></td><th width="60%" align="center">第 8 章 数据类型</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="datatype-datetime.html" title="8.5. 日期/时间类型">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="DATATYPE-BINARY"><div class="titlepage"><div><div><h2 class="title" style="clear: both">8.4. 二进制数据类型</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="datatype-binary.html#id-1.5.7.12.9">8.4.1. <code class="type">bytea</code>的十六进制格式</a></span></dt><dt><span class="sect2"><a href="datatype-binary.html#id-1.5.7.12.10">8.4.2. <code class="type">bytea</code>的转义格式</a></span></dt></dl></div><a id="id-1.5.7.12.2" class="indexterm"></a><a id="id-1.5.7.12.3" class="indexterm"></a><p>
    <code class="type">bytea</code>数据类型允许存储二进制串，参见<a class="xref" href="datatype-binary.html#DATATYPE-BINARY-TABLE" title="表 8.6. 二进制数据类型">表 8.6</a>。
   </p><div class="table" id="DATATYPE-BINARY-TABLE"><p class="title"><strong>表 8.6. 二进制数据类型</strong></p><div class="table-contents"><table class="table" summary="二进制数据类型" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名字</th><th>存储尺寸</th><th>描述</th></tr></thead><tbody><tr><td><code class="type">bytea</code></td><td>1或4字节外加真正的二进制串</td><td>变长二进制串</td></tr></tbody></table></div></div><br class="table-break" /><p>
    二进制串是一个八位位组（或字节）的序列。 二进制串和字符串的区别有两个： 首先，二进制串明确允许存储零值的字节以及其它<span class="quote">“<span class="quote">不可打印的</span>”</span>字节（通常是位于十进制范围32到126之外的字节）。 字符串不允许零字节，并且也不允许那些对于数据库的选定字符集编码是非法的任何其它字节值或者字节值序列。 第二，对二进制串的操作会处理实际上的字节，而字符串的处理和取决于区域设置。 简单说，二进制字串适用于存储那些程序员认为是<span class="quote">“<span class="quote">裸字节</span>”</span>的数据，而字符串适合存储文本。
   </p><p>
    <code class="type">bytea</code>类型支持两种用于输入和输出的格式：<span class="quote">“<span class="quote">十六进制</span>”</span>格式和<span class="productname">PostgreSQL</span>的历史的<span class="quote">“<span class="quote">转义</span>”</span>格式。在输入时这两种格式总是会被接受。输出格式则取决于配置参数<a class="xref" href="runtime-config-client.html#GUC-BYTEA-OUTPUT">bytea_output</a>，其默认值为十六进制（注意十六进制格式是在<span class="productname">PostgreSQL</span> 9.0中被引入的，早期的版本和某些工具无法理解它）。
   </p><p>
    <acronym class="acronym">SQL</acronym>标准定义了一种不同的二进制串类型， 叫做<code class="type">BLOB</code>或者<code class="type">BINARY LARGE OBJECT</code>。其输入格式和<code class="type">bytea</code>不同，但是提供的函数和操作符大多一样。
   </p><div class="sect2" id="id-1.5.7.12.9"><div class="titlepage"><div><div><h3 class="title">8.4.1. <code class="type">bytea</code>的十六进制格式</h3></div></div></div><p>
    <span class="quote">“<span class="quote">十六进制</span>”</span>格式将二进制数据编码为每个字节2个十六进制位，最高有效位在前。整个串以序列<code class="literal">\x</code>开头（用以和转义格式区分）。在某些情景中，开头的反斜线可能需要通过双写来转义，详见(see <a class="xref" href="sql-syntax-lexical.html#SQL-SYNTAX-STRINGS" title="4.1.2.1. 字符串常量">第 4.1.2.1 节</a>)。 作为输入，十六进制位可以是大写也可以是小写，在位对之间可以有空白（但是在位对内部以及开头的<code class="literal">\x</code>序列中不能有空白）。十六进制格式和很多外部应用及协议相兼容，并且其转换速度要比转义格式更快，因此人们更愿意用它。
   </p><p>
    例子：
</p><pre class="programlisting">
SELECT '\xDEADBEEF';
</pre><p>
   </p></div><div class="sect2" id="id-1.5.7.12.10"><div class="titlepage"><div><div><h3 class="title">8.4.2. <code class="type">bytea</code>的转义格式</h3></div></div></div><p>
    <span class="quote">“<span class="quote">转义</span>”</span>格式是<code class="type">bytea</code>类型的传统<span class="productname">PostgreSQL</span>格式。它采用将二进制串表示成ASCII字符序列的方法，而将那些无法用ASCII字符表示的字节转换成特殊的转义语句。从应用的角度来看，如果将字节表示为字符有意义，那么这种表示将很方便。但是在实际中，这常常是令人困扰的，因为它使二进制串和字符串之间的区别变得模糊，并且这种特别的转义机制也有点难于处理。因此这种格式可能会在大部分新应用中避免使用。
   </p><p>
    在转义模式下输入<code class="type">bytea</code>值时，某些值的字节<span class="emphasis"><em>必须</em></span>被转义，而所有的字节值都<span class="emphasis"><em>可以</em></span>被转义。通常，要转义一个字节，需要把它转换成与它的三位八进制值， 并且前导一个反斜线。反斜线本身（十进制字节值92）也可以用双写的反斜线表示。<a class="xref" href="datatype-binary.html#DATATYPE-BINARY-SQLESC" title="表 8.7. bytea文字转义字节">表 8.7</a>显示了必须被转义的字符，并给出了可以使用的替代转义序列。
   </p><div class="table" id="DATATYPE-BINARY-SQLESC"><p class="title"><strong>表 8.7. <code class="type">bytea</code>文字转义字节</strong></p><div class="table-contents"><table class="table" summary="bytea文字转义字节" border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th>十进制字节值</th><th>描述</th><th>转义输入表示</th><th>例子</th><th>十六进制表示</th></tr></thead><tbody><tr><td>0</td><td>0字节</td><td><code class="literal">'\000'</code></td><td><code class="literal">SELECT '\000'::bytea;</code></td><td><code class="literal">\x00</code></td></tr><tr><td>39</td><td>单引号</td><td><code class="literal">''''</code>或<code class="literal">'\047'</code></td><td><code class="literal">SELECT ''''::bytea;</code></td><td><code class="literal">\x27</code></td></tr><tr><td>92</td><td>反斜线</td><td><code class="literal">'\\'</code>或<code class="literal">'\134'</code></td><td><code class="literal">SELECT '\\'::bytea;</code></td><td><code class="literal">\x5c</code></td></tr><tr><td>0到31和127到255</td><td><span class="quote">“<span class="quote">不可打印的</span>”</span>字节</td><td><code class="literal">'\<em class="replaceable"><code>xxx'</code></em></code>（八进制值）</td><td><code class="literal">SELECT '\001'::bytea;</code></td><td><code class="literal">\x01</code></td></tr></tbody></table></div></div><br class="table-break" /><p>
    转义<span class="quote">“<span class="quote">不可打印的</span>”</span>字节的要求取决于区域设置。在某些实例中，你可以不理睬它们，让它们保持未转义的状态。
   </p><p>
    如<a class="xref" href="datatype-binary.html#DATATYPE-BINARY-SQLESC" title="表 8.7. bytea文字转义字节">表 8.7</a>中所示，要求单引号必须写两次的原因对任何SQL命令中的字符串常量都是一样的。
   文字解析器消耗最外层的单引号，并缩减成对的单引号为一个普通数据字符。
   <code class="type">bytea</code>输入函数看到的只是一个单引号，它将其视为普通数据字符。
   但是，<code class="type">bytea</code>输入函数将反斜杠视为特殊字符，<a class="xref" href="datatype-binary.html#DATATYPE-BINARY-SQLESC" title="表 8.7. bytea文字转义字节">表 8.7</a>中显示的其他行为由该函数实现。
   </p><p>
    在某些情况下，反斜杠必须加倍，如上所示，因为通用的字符串文字解析器也会
    将一对反斜杠减少为一个数据字符;请参阅<a class="xref" href="sql-syntax-lexical.html#SQL-SYNTAX-STRINGS" title="4.1.2.1. 字符串常量">第 4.1.2.1 节</a>。
   </p><p>
    <code class="type">Bytea</code>字节默认被输出为<code class="literal">hex</code>格式。如果你把<a class="xref" href="runtime-config-client.html#GUC-BYTEA-OUTPUT">bytea_output</a>改为<code class="literal">escape</code>，<span class="quote">“<span class="quote">不可打印的</span>”</span>字节会被转换成与之等效的三位八进制值并且前置一个反斜线。大部分<span class="quote">“<span class="quote">可打印的</span>”</span>字节被输出为它们在客户端字符集中的标准表示形式，例如：

</p><pre class="programlisting">
SET bytea_output = 'escape';

SELECT 'abc \153\154\155 \052\251\124'::bytea;
     bytea
----------------
 abc klm *\251T
</pre><p>

    十进制值为92（反斜线）的字节在输出时被双写。详情请见<a class="xref" href="datatype-binary.html#DATATYPE-BINARY-RESESC" title="表 8.8. bytea输出转义字节">表 8.8</a>。
   </p><div class="table" id="DATATYPE-BINARY-RESESC"><p class="title"><strong>表 8.8. <code class="type">bytea</code>输出转义字节</strong></p><div class="table-contents"><table class="table" summary="bytea输出转义字节" border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th>十进制字节值</th><th>描述</th><th>转义的输出表示</th><th>例子</th><th>输出结果</th></tr></thead><tbody><tr><td>92</td><td>反斜线</td><td><code class="literal">\\</code></td><td><code class="literal">SELECT '\134'::bytea;</code></td><td><code class="literal">\\</code></td></tr><tr><td>0到31和127到255</td><td><span class="quote">“<span class="quote">不可打印的</span>”</span>字节</td><td><code class="literal">\<em class="replaceable"><code>xxx</code></em></code>（八进制值）</td><td><code class="literal">SELECT '\001'::bytea;</code></td><td><code class="literal">\001</code></td></tr><tr><td>32到126</td><td><span class="quote">“<span class="quote">可打印的</span>”</span>字节</td><td>客户端字符集表示</td><td><code class="literal">SELECT '\176'::bytea;</code></td><td><code class="literal">~</code></td></tr></tbody></table></div></div><br class="table-break" /><p>
    根据你使用的<span class="productname">PostgreSQL</span>前端，你在转义和未转义<code class="type">bytea</code>串方面可能需要做额外的工作。例如，如果你的接口自动翻译换行和回车，你可能也不得不转义它们。
   </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="datatype-character.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="datatype.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="datatype-datetime.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">8.3. 字符类型 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 8.5. 日期/时间类型</td></tr></table></div></body></html>