<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>initdb</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="reference-server.html" title="PostgreSQL 服务器应用" /><link rel="next" href="pgarchivecleanup.html" title="pg_archivecleanup" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">initdb</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="reference-server.html" title="PostgreSQL 服务器应用">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-server.html" title="PostgreSQL 服务器应用">上一级</a></td><th width="60%" align="center">PostgreSQL 服务器应用</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="pgarchivecleanup.html" title="pg_archivecleanup">下一页</a></td></tr></table><hr></hr></div><div class="refentry" id="APP-INITDB"><div class="titlepage"></div><a id="id-1.9.5.3.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">initdb</span></h2><p>initdb — 创建一个新的<span class="productname">PostgreSQL</span>数据库集簇</p></div><div class="refsynopsisdiv"><h2>大纲</h2><div class="cmdsynopsis"><p id="id-1.9.5.3.4.1"><code class="command">initdb</code> [<em class="replaceable"><code>option</code></em>...]  [ <code class="option">--pgdata</code>  |   <code class="option">-D</code> ]<em class="replaceable"><code> directory</code></em> </p></div></div><div class="refsect1" id="R1-APP-INITDB-1"><h2>
   描述
  </h2><p>
   <code class="command">initdb</code>创建一个新的<span class="productname">PostgreSQL</span>数据库集簇。一个数据库集簇是由一个单一服务器实例管理的数据库的集合。
  </p><p>
   一个数据库集簇的创建包括创建存放数据库数据的目录、生成共享目录表（属于整个集簇而不是任何特定数据库的表）并且创建<code class="literal">template1</code>和<code class="literal">postgres</code>数据库。当你后来创建一个新的数据库时，任何在<code class="literal">template1</code>数据库中的东西都会被复制（因此，任何已安装在<code class="literal">template1</code>中的东西都会被自动地复制到后来创建的每一个数据库中）。<code class="literal">postgres</code>数据库是便于用户、工具和第三方应用使用的默认数据库。
  </p><p>
   尽管<code class="command">initdb</code>将尝试创建指定的数据目录，它可能没有权限（如果想要的数据目录的父目录被根用户拥有）。要在这样一种设置中初始化，作为 root 创建一个空数据目录，然后使用<code class="command">chown</code>将该目录赋予给数据库用户账户，再然后<code class="command">su</code>成为该数据库用户并运行<code class="command">initdb</code>。
  </p><p>
   <code class="command">initdb</code>必须以将拥有该服务器进程的用户运行，因为该服务器需要访问<code class="command">initdb</code>创建的文件和目录。因为该服务器不能作为 root 运行，你不能以 root 运行<code class="command">initdb</code>（事实上它会拒绝这样做）。
  </p><p>
    由于安全原因，由<code class="command">initdb</code>创建的新集簇默认将只能由集簇拥有者访问。<code class="option">--allow-group-access</code>选项允许与集簇拥有者同组的任何用户读取集簇中的文件。这对非特权用户执行备份很有用。
  </p><p>
   <code class="command">initdb</code>初始化该数据库集簇的默认区域和字符集编码。当一个数据库被创建时，其字符集编码、排序顺序（<code class="literal">LC_COLLATE</code>）和字符集类（<code class="literal">LC_CTYPE</code>，例如大写、小写、数字）可以被独立设置。<code class="command">initdb</code>为<code class="literal">template1</code>数据库确定那些设置，它们将作为所有其他数据库的默认值。
  </p><p>
   要修改默认排序顺序或字符集类，使用<code class="option">--lc-collate</code>和<code class="option">--lc-ctype</code>选项。除<code class="literal">C</code>或<code class="literal">POSIX</code>之外的排序顺序也有性能罚值。由于这些原因，在运行<code class="command">initdb</code>时选择正确的区域很重要。
  </p><p>
   余下的区域分类可以在服务器启动之后改变。你也可以使用<code class="option">--locale</code>来为所有区域分类设置默认值，包括排序顺序和字符集类。所有服务器区域值（<code class="literal">lc_*</code>）可以通过<code class="command">SHOW ALL</code>显示。详见<a class="xref" href="locale.html" title="23.1. 区域支持">第 23.1 节</a>。
  </p><p>
   要修改默认编码，使用<code class="option">--encoding</code>。详见<a class="xref" href="multibyte.html" title="23.3. 字符集支持">第 23.3 节</a>.
  </p></div><div class="refsect1" id="id-1.9.5.3.6"><h2>选项</h2><p>
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-A <em class="replaceable"><code>authmethod</code></em></code><br /></span><span class="term"><code class="option">--auth=<em class="replaceable"><code>authmethod</code></em></code></span></dt><dd><p>
        这个选项为本地用户指定在<code class="filename">pg_hba.conf</code>中使用的默认认证方法（<code class="literal">host</code>和<code class="literal">local</code>行）。<code class="command">initdb</code>将使用指定的认证方法为非复制连接以及复制连接填充<code class="filename">pg_hba.conf</code>项。
       </p><p>
        除非你信任你系统上的所有本地用户，不要使用<code class="literal">trust</code>。为了安装方便，<code class="literal">trust</code>是默认值。
       </p></dd><dt><span class="term"><code class="option">--auth-host=<em class="replaceable"><code>authmethod</code></em></code></span></dt><dd><p>
        这个选项为通过 TCP/IP 连接的本地用户指定在<code class="filename">pg_hba.conf</code>中使用的认证方法（<code class="literal">host</code>行）。
       </p></dd><dt><span class="term"><code class="option">--auth-local=<em class="replaceable"><code>authmethod</code></em></code></span></dt><dd><p>
        这个选项为通过 Unix 域套接字连接的本地用户指定在<code class="filename">pg_hba.conf</code>中使用的认证方法（<code class="literal">local</code>行）。
       </p></dd><dt><span class="term"><code class="option">-D <em class="replaceable"><code>directory</code></em></code><br /></span><span class="term"><code class="option">--pgdata=<em class="replaceable"><code>directory</code></em></code></span></dt><dd><p>
        这个选项指定数据库集簇应该存放的目录。这是<code class="command">initdb</code>要求的唯一信息，但是你可以通过设定<code class="envar">PGDATA</code>环境变量来避免书写它，这很方便因为之后数据库服务器（<code class="command">postgres</code>）可以使用同一个变量来找到数据库目录。
       </p></dd><dt><span class="term"><code class="option">-E <em class="replaceable"><code>encoding</code></em></code><br /></span><span class="term"><code class="option">--encoding=<em class="replaceable"><code>encoding</code></em></code></span></dt><dd><p>
        选择模板数据库的编码。这也将是后来创建的任何数据库的默认编码，除非你覆盖它。默认值来自于区域，或者如果该值不起作用则为<code class="literal">SQL_ASCII</code>。<span class="productname">PostgreSQL</span>服务器所支持的字符集在<a class="xref" href="multibyte.html#MULTIBYTE-CHARSET-SUPPORTED" title="23.3.1. 被支持的字符集">第 23.3.1 节</a>中描述。
       </p></dd><dt id="APP-INITDB-ALLOW-GROUP-ACCESS"><span class="term"><code class="option">-g</code><br /></span><span class="term"><code class="option">--allow-group-access</code></span></dt><dd><p>
        允许与集簇拥有者同组的用户读取<code class="command">initdb</code>创建的所有集簇文件。
       <span class="productname">Windows</span>会忽略此选项，因为它不支持<acronym class="acronym">POSIX</acronym>样式的组权限。

       </p></dd><dt id="APP-INITDB-DATA-CHECKSUMS"><span class="term"><code class="option">-k</code><br /></span><span class="term"><code class="option">--data-checksums</code></span></dt><dd><p>
        在数据页面上使用校验码来帮助检测 I/O 系统造成的损坏。启用校验码将会引起显著的性能惩罚。如果设置，则为所有对象计算校验和，在整个数据库中。
        所有校验和失败都将报告在<a class="xref" href="monitoring-stats.html#PG-STAT-DATABASE-VIEW" title="表 27.12. pg_stat_database视图">pg_stat_database</a> 视图。
       </p></dd><dt><span class="term"><code class="option">--locale=<em class="replaceable"><code>locale</code></em></code></span></dt><dd><p>
        为数据库集簇设置默认区域。如果这个选项没有被指定，该区域将从<code class="command">initdb</code>所运行的环境中继承。区域支持在<a class="xref" href="locale.html" title="23.1. 区域支持">第 23.1 节</a>中描述。
       </p></dd><dt><span class="term"><code class="option">--lc-collate=<em class="replaceable"><code>locale</code></em></code><br /></span><span class="term"><code class="option">--lc-ctype=<em class="replaceable"><code>locale</code></em></code><br /></span><span class="term"><code class="option">--lc-messages=<em class="replaceable"><code>locale</code></em></code><br /></span><span class="term"><code class="option">--lc-monetary=<em class="replaceable"><code>locale</code></em></code><br /></span><span class="term"><code class="option">--lc-numeric=<em class="replaceable"><code>locale</code></em></code><br /></span><span class="term"><code class="option">--lc-time=<em class="replaceable"><code>locale</code></em></code></span></dt><dd><p>
        和<code class="option">--locale</code>相似，但是只在指定的分类中设置区域。
       </p></dd><dt><span class="term"><code class="option">--no-locale</code></span></dt><dd><p>
        等效于<code class="option">--locale=C</code>。
       </p></dd><dt><span class="term"><code class="option">-N</code><br /></span><span class="term"><code class="option">--no-sync</code></span></dt><dd><p>
        默认情况下，<code class="command">initdb</code>将等待所有文件被安全地写到磁盘。这个选项会导致<code class="command">initdb</code>不等待就返回，这当然更快，但是也意味着一次后续的操作系统崩溃可能让数据目录损坏。通常，这个选项对测试有用，但是不应该在创建生产安装时使用。
       </p></dd><dt><span class="term"><code class="option">--pwfile=<em class="replaceable"><code>filename</code></em></code></span></dt><dd><p>
        让<code class="command">initdb</code>从一个文件读取数据库超级用户的口令。该文件的第一行被当作口令。
       </p></dd><dt><span class="term"><code class="option">-S</code><br /></span><span class="term"><code class="option">--sync-only</code></span></dt><dd><p>
        安全地把所有数据库文件写入到磁盘并退出。这不会执行任何正常的<span class="application">initdb</span>操作。
       </p></dd><dt><span class="term"><code class="option">-T <em class="replaceable"><code>config</code></em></code><br /></span><span class="term"><code class="option">--text-search-config=<em class="replaceable"><code>config</code></em></code></span></dt><dd><p>
        设置默认的文本搜索配置。详见<a class="xref" href="runtime-config-client.html#GUC-DEFAULT-TEXT-SEARCH-CONFIG">default_text_search_config</a>。
       </p></dd><dt><span class="term"><code class="option">-U <em class="replaceable"><code>username</code></em></code><br /></span><span class="term"><code class="option">--username=<em class="replaceable"><code>username</code></em></code></span></dt><dd><p>
        选择数据库超级用户的用户名。这个的默认值是实际运行<code class="command">initdb</code>的用户的名称。超级用户的名字是什么真的不重要，但是你可以选择保留常用的名字<span class="systemitem">postgres</span>，即使操作系统的用户名不同。
       </p></dd><dt><span class="term"><code class="option">-W</code><br /></span><span class="term"><code class="option">--pwprompt</code></span></dt><dd><p>
        让<code class="command">initdb</code>提示要求为数据库超级用户给予一个口令。如果你没有计划使用口令认证，这就不重要。否则在你设置一个口令之前你就无法使用口令认证。
       </p></dd><dt><span class="term"><code class="option">-X <em class="replaceable"><code>directory</code></em></code><br /></span><span class="term"><code class="option">--waldir=<em class="replaceable"><code>directory</code></em></code></span></dt><dd><p>
        这个选项指定预写式日志会被存储在哪个目录中。
       </p></dd><dt><span class="term"><code class="option">--wal-segsize=<em class="replaceable"><code>size</code></em></code></span></dt><dd><p>
        设置<em class="firstterm">WAL段尺寸</em>，以兆字节为单位。这是WAL日志中每个文件的尺寸。默认的尺寸为16兆字节。该值必须位于2的1次幂和1024次幂（兆字节）之间。这个选项只能在初始化期间设置，并且之后不能更改。
       </p><p>
        调整这个值来控制WAL日志传送或者归档可能会有用。此外，在有大量WAL的数据库中，每个目录中数量巨大的WAL文件可能会成为性能和管理问题。增加WAL文件尺寸将会降低WAL文件的数量。
       </p></dd></dl></div><p>
   </p><p>
    其他较少使用的选项：

    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-d</code><br /></span><span class="term"><code class="option">--debug</code></span></dt><dd><p>
        打印来自引导后端的调试输出以及普通大众不那么感兴趣的一些消息。引导后端被程序<code class="command">initdb</code>用来创建目录表。这个选项会生成大量极端无聊的输出。
       </p></dd><dt><span class="term"><code class="option">-L <em class="replaceable"><code>directory</code></em></code></span></dt><dd><p>
        指定<code class="command">initdb</code>应从哪里寻找它的输入文件来初始化数据库集簇。这通常没有必要。如果你需要显式指定它们的位置，你应该被告知。
       </p></dd><dt><span class="term"><code class="option">-n</code><br /></span><span class="term"><code class="option">--no-clean</code></span></dt><dd><p>
        默认情况下，当<code class="command">initdb</code>确定有一个错误阻止它完整地创建数据库集簇，它会移除在它发现无法完成任务之前创建的任何文件。这个选项会抑制这种整理并且对调试有用。
       </p></dd></dl></div><p>
   </p><p>
    其他选项：

    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt><dd><p>
       打印<span class="application">initdb</span>版本并退出。
       </p></dd><dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt><dd><p>
       显示有关<span class="application">initdb</span>命令行参数的帮助并退出。
       </p></dd></dl></div><p>
   </p></div><div class="refsect1" id="id-1.9.5.3.7"><h2>环境</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="envar">PGDATA</code></span></dt><dd><p>
      指定数据库集簇应该被存放的目录，可以使用<code class="option">-D</code>选项覆盖。
     </p></dd><dt><span class="term"><code class="envar">PG_COLOR</code></span></dt><dd><p>
      规定在诊断消息中是否使用颜色。可能的值为<code class="literal">always</code>、 <code class="literal">auto</code>、<code class="literal">never</code>。
     </p></dd><dt><span class="term"><code class="envar">TZ</code></span></dt><dd><p>
      指定创建的数据集簇的默认时区。值应该是一个完整的时区名称（见<a class="xref" href="datatype-datetime.html#DATATYPE-TIMEZONES" title="8.5.3.  时区">第 8.5.3 节</a>）。
     </p></dd></dl></div><p>
   和大部分其他<span class="productname">PostgreSQL</span>工具相似，这个工具也使用<span class="application">libpq</span>（见<a class="xref" href="libpq-envars.html" title="33.14. 环境变量">第 33.14 节</a>）支持的环境变量。
  </p></div><div class="refsect1" id="id-1.9.5.3.8"><h2>注解</h2><p>
   <code class="command">initdb</code>可以通过<code class="command">pg_ctl initdb</code>被调用。
  </p></div><div class="refsect1" id="id-1.9.5.3.9"><h2>参见</h2><span class="simplelist"><a class="xref" href="app-pg-ctl.html" title="pg_ctl"><span class="refentrytitle"><span class="application">pg_ctl</span></span></a>, <a class="xref" href="app-postgres.html" title="postgres"><span class="refentrytitle"><span class="application">postgres</span></span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="reference-server.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-server.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="pgarchivecleanup.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">PostgreSQL 服务器应用 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> <span class="application">pg_archivecleanup</span></td></tr></table></div></body></html>