<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>45.1. Python 2 vs. Python 3</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="plpython.html" title="第 45 章 PL/Python - Python 过程语言" /><link rel="next" href="plpython-funcs.html" title="45.2. PL/Python 函数" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">45.1. Python 2 vs. Python 3</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="plpython.html" title="第 45 章 PL/Python - Python 过程语言">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="plpython.html" title="第 45 章 PL/Python - Python 过程语言">上一级</a></td><th width="60%" align="center">第 45 章 PL/Python - Python 过程语言</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="plpython-funcs.html" title="45.2. PL/Python 函数">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="PLPYTHON-PYTHON23"><div class="titlepage"><div><div><h2 class="title" style="clear: both">45.1. Python 2 vs. Python 3</h2></div></div></div><p>
   PL/Python 同时支持 Python 2 和 Python 3 两种语言变体（PostgreSQL 安装指导可能包含了所支持的 Python 次版本的更精确的信息）。因为 Python 2 和 Python 3 语言变体在某些重要的方面并不兼容，PL/Python 使用了下列命名和转换模式以避免混淆它们：

   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      名为<code class="literal">plpython2u</code>的 PostgreSQL 语言实现了基于 Python 2 语言变体的 PL/Python。
     </p></li><li class="listitem"><p>
      名为<code class="literal">plpython3u</code>的 PostgreSQL 语言实现了基于 Python 3 语言变体的 PL/Python。
     </p></li><li class="listitem"><p>
      名为<code class="literal">plpythonu</code>的语言实现了基于默认 Python语言变体（当前是 Python 2）的 PL/Python（这种默认与任何本地 Python 安装所认为的<span class="quote">“<span class="quote">默认</span>”</span>无关，例如<code class="filename">/usr/bin/python</code>）。在遥远的未来，PostgreSQL 的发布中可能会把这种默认语言变体改成 Python 3，这取决于 Python 社区迁移到 Python 3 的进度。
     </p></li></ul></div><p>

   这种模式类似于<a class="ulink" href="https://www.python.org/dev/peps/pep-0394/" target="_top">PEP 394</a>中关于<code class="command">python</code>命令的命名和转换的推荐。
  </p><p>
   到底是 Python 2 还是 Python 3 的 PL/Python 可用或是两者都可用，取决于编译配置或者被安装的包。
  </p><div class="tip"><h3 class="title">提示</h3><p>
    如果是编译安装，则取决于在安装期间找到的 Python 版本或者用<code class="envar">PYTHON</code>环境变量显式设置的版本，见<a class="xref" href="install-procedure.html" title="16.4. 安装过程">第 16.4 节</a>。要在一个安装中让两种变体的 PL/Python 都可用，源代码树必须被配置和编译两次。
   </p></div><p>
   这产生了下列的使用和迁移策略：

   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      现有用户以及对 Python 3 不感兴趣的用户使用<code class="literal">plpythonu</code>语言并且在可预见的未来不必做出任何改变。我们推荐通过迁移到 Python 2.6/2.7 逐步地让代码<span class="quote">“<span class="quote">经得起未来的考验</span>”</span>以简化最终迁移到 Python 3 的工作。
     </p><p>
      实际上，很多 PL/Python 函数可以用很少或者不做修改就迁移到 Python 3。
     </p></li><li class="listitem"><p>
      对于代码严重依赖于 Python 2 并且不打算做改变的用户可以使用<code class="literal">plpython2u</code>语言。这将在很长时间内都有效，直到 PostgreSQL 完全删除掉对 Python 2 的支持。
     </p></li><li class="listitem"><p>
      想投入 Python 3 的怀抱的用户可以使用<code class="literal">plpython3u</code>语言，在当前的标准下这将一直有效。在遥远的未来，当 Python 3 成为默认以后，出于审美的原因，<span class="quote">“<span class="quote">3</span>”</span>可能会被移除。
     </p></li><li class="listitem"><p>
      想要构建一个只有 Python 3 的操作系统环境的冒险者们，可以更改<a class="link" href="catalog-pg-pltemplate.html" title="51.37. pg_pltemplate"><code class="structname">pg_pltemplate</code></a>的内容让<code class="literal">plpythonu</code>等价于<code class="literal">plpython3u</code>，记住这将会让他们的安装与世界的其他大部分东西都不兼容。
     </p></li></ul></div><p>
  </p><p>
   有关移植到 Python 3 的更多信息还可见文档<a class="ulink" href="https://docs.python.org/3/whatsnew/3.0.html" target="_top">What's
   New In Python 3.0</a>。
  </p><p>
   不允许在同一个会话中使用基于 Python 2 的 PL/Python 以及基于 Python 3 的 PL/Python，因为动态模块中的符号会冲突，这会导致 PostgreSQL 服务器进程的崩溃。在一个会话中有一个检查来阻止混淆 Python 的主版本，如果检测到不匹配会中断会话。不过，可以在同一个数据库中对不同的会话使用两种 PL/Python 变体。
  </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="plpython.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="plpython.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="plpython-funcs.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">第 45 章 PL/Python - Python 过程语言 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 45.2. PL/Python 函数</td></tr></table></div></body></html>