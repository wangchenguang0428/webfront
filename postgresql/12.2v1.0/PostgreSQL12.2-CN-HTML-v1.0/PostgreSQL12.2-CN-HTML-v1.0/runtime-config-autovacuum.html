<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>19.10. 自动清理</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="runtime-config-statistics.html" title="19.9. 运行时统计数据" /><link rel="next" href="runtime-config-client.html" title="19.11. 客户端连接默认值" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">19.10. 自动清理</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config-statistics.html" title="19.9. 运行时统计数据">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="第 19 章 服务器配置">上一级</a></td><th width="60%" align="center">第 19 章 服务器配置</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="runtime-config-client.html" title="19.11. 客户端连接默认值">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="RUNTIME-CONFIG-AUTOVACUUM"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.10. 自动清理</h2></div></div></div><a id="id-1.6.6.13.2" class="indexterm"></a><p>
      这些设置控制<em class="firstterm">autovacuum</em>特性的行为。详情请参考
      <a class="xref" href="routine-vacuuming.html#AUTOVACUUM" title="24.1.6. 自动清理后台进程">第 24.1.6 节</a>。注意很多这些设置可以被针对每个表
      的设置所覆盖，请见<a class="xref" href="sql-createtable.html#SQL-CREATETABLE-STORAGE-PARAMETERS" title="存储参数">存储参数</a>。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-AUTOVACUUM"><span class="term"><code class="varname">autovacuum</code> (<code class="type">boolean</code>)
      <a id="id-1.6.6.13.4.1.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        控制服务器是否运行自动清理启动器后台进程。默认为开启，
        不过要自动清理正常工作还需要启用<a class="xref" href="runtime-config-statistics.html#GUC-TRACK-COUNTS">track_counts</a>。
        该参数只能在<code class="filename">postgresql.conf</code>文件或服务器命令行中设置，
        不过，通过更改表存储参数可以为表禁用自动清理。
       </p><p>
        注意即使该参数被禁用，系统也会在需要防止事务ID回卷时发起清理进程。详情请见<a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="24.1.5. 防止事务 ID 回卷失败">第 24.1.5 节</a>。
       </p></dd><dt id="GUC-LOG-AUTOVACUUM-MIN-DURATION"><span class="term"><code class="varname">log_autovacuum_min_duration</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.13.4.2.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        如果自动清理运行至少该值所指定的时间量，被自动清理执行的每一个动作都会被日志记录。
        将该参数设置为0会记录所有的自动清理动作。 <code class="literal">-1</code>（默认值）将禁用对自动清理动作的记录。
        如果指定值时没有单位，则以毫秒为单位。
        例如，如果你将它设置为<code class="literal">250ms</code>，则所有运行250ms或更长时间的
        自动清理和分析将被记录。此外，当该参数被设置为除<code class="literal">-1</code>外的任何值时，
        如果一个自动清理动作由于一个锁冲突或者被并发删除的关系而被跳过，将会为此记录一个消息。
        开启这个参数对于追踪自动清理活动非常有用。这个参数只能在
        <code class="filename">postgresql.conf</code>文件或者服务器命令行中设置。但是可以通过更改表的存储
        参数为个别表覆盖这个设置。
       </p></dd><dt id="GUC-AUTOVACUUM-MAX-WORKERS"><span class="term"><code class="varname">autovacuum_max_workers</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.13.4.3.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        指定能同时运行的自动清理进程（除了自动清理启动器之外）的最大数量。默认值为3。该参数只能在服务器启动时设置。
       </p></dd><dt id="GUC-AUTOVACUUM-NAPTIME"><span class="term"><code class="varname">autovacuum_naptime</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.13.4.4.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        指定自动清理在任意给定数据库上运行的最小延迟。在每一轮中后台进程检查数据库并根据需要为数据库中的表发出<code class="command">VACUUM</code>和<code class="command">ANALYZE</code>命令。
        如果指定值时没有单位，则以秒为单位。默认值为1分钟（<code class="literal">1min</code>）。该参数只能在<code class="filename">postgresql.conf</code>文件或在服务器命令行上设置。
       </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-THRESHOLD"><span class="term"><code class="varname">autovacuum_vacuum_threshold</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.13.4.5.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        指定能在一个表上触发<code class="command">VACUUM</code>的被插入、被更新或被删除元组的最小数量。默认值为50个元组。该参数只能在<code class="filename">postgresql.conf</code>文件或在服务器命令中设置。但是对个别表可以通过修改表存储参数来覆盖该设置。
       </p></dd><dt id="GUC-AUTOVACUUM-ANALYZE-THRESHOLD"><span class="term"><code class="varname">autovacuum_analyze_threshold</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.13.4.6.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        指定能在一个表上触发<code class="command">ANALYZE</code>的被插入、被更新或被删除元组的最小数量。默认值为50个元组。该参数只能在<code class="filename">postgresql.conf</code>文件或在服务器命令中设置。但是对个别表可以通过修改表存储参数来覆盖该设置。
       </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-SCALE-FACTOR"><span class="term"><code class="varname">autovacuum_vacuum_scale_factor</code> (<code class="type">floating point</code>)
      <a id="id-1.6.6.13.4.7.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        指定一个表尺寸的分数，在决定是否触发<code class="command">VACUUM</code>时将它加到<code class="varname">autovacuum_vacuum_threshold</code>上。默认值为0.2（表尺寸的20%）。该参数只能在<code class="filename">postgresql.conf</code>文件或在服务器命令中设置。但是对个别表可以通过修改表存储参数来覆盖该设置。
       </p></dd><dt id="GUC-AUTOVACUUM-ANALYZE-SCALE-FACTOR"><span class="term"><code class="varname">autovacuum_analyze_scale_factor</code> (<code class="type">floating point</code>)
      <a id="id-1.6.6.13.4.8.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        指定一个表尺寸的分数，在决定是否触发<code class="command">ANALYZE</code>时将它加到<code class="varname">autovacuum_analyze_threshold</code>上。默认值为0.1（表尺寸的10%）。该参数只能在<code class="filename">postgresql.conf</code>文件或在服务器命令中设置。但是对个别表可以通过修改表存储参数来覆盖该设置。
       </p></dd><dt id="GUC-AUTOVACUUM-FREEZE-MAX-AGE"><span class="term"><code class="varname">autovacuum_freeze_max_age</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.13.4.9.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        指定在一个<code class="command">VACUUM</code>操作被强制执行来防止表中事务ID回卷之前，一个表的<code class="structname">pg_class</code>.<code class="structfield">relfrozenxid</code>域能保持的最大年龄（事务的）。注意即便自动清理被禁用，系统也将发起自动清理进程来阻止回卷。
       </p><p>
        清理也允许从<code class="filename">pg_xact</code>子目录中移除旧文件，这也是为什么默认值被设置为较低的2亿事务。该参数只能在服务器启动时设置，但是对于个别表可以通过修改表存储参数来降低该设置。详见<a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="24.1.5. 防止事务 ID 回卷失败">第 24.1.5 节</a>。
       </p></dd><dt id="GUC-AUTOVACUUM-MULTIXACT-FREEZE-MAX-AGE"><span class="term"><code class="varname">autovacuum_multixact_freeze_max_age</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.13.4.10.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        指定在一个<code class="command">VACUUM</code>操作被强制执行来防止表中多事务ID回卷之前，一个表的<code class="structname">pg_class</code>.<code class="structfield">relminmxid</code>域能保持的最大年龄（多事务的）。注意即便自动清理被禁用，系统也将发起自动清理进程来阻止回卷。
       </p><p>
        清理多事务也允许从<code class="filename">pg_multixact/members</code>和<code class="filename">pg_multixact/offsets</code>子目录中移除旧文件，这也是为什么默认值被设置为较低的400万多事务。该参数只能在服务器启动时设置，但是对于个别表可以通过修改表存储参数来降低该设置。详见<a class="xref" href="routine-vacuuming.html#VACUUM-FOR-MULTIXACT-WRAPAROUND" title="24.1.5.1. 多事务和回卷">第 24.1.5.1 节</a>。
       </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-COST-DELAY"><span class="term"><code class="varname">autovacuum_vacuum_cost_delay</code> (<code class="type">floating point</code>)
      <a id="id-1.6.6.13.4.11.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        指定用于自动<code class="command">VACUUM</code>操作中的代价延迟值。如果指定-1（默认值），则使用<a class="xref" href="runtime-config-resource.html#GUC-VACUUM-COST-DELAY">vacuum_cost_delay</a>值。
        如果指定值时没有单位，则以毫秒为单位。默认值为2毫秒。该参数只能在<code class="filename">postgresql.conf</code>文件或在服务器命令中设置。但是对个别表可以通过修改表存储参数来覆盖该设置。
       </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-COST-LIMIT"><span class="term"><code class="varname">autovacuum_vacuum_cost_limit</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.13.4.12.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        指定用于自动<code class="command">VACUUM</code>操作中的代价限制值。如果指定-1（默认值），则使用<a class="xref" href="runtime-config-resource.html#GUC-VACUUM-COST-LIMIT">vacuum_cost_limit</a>值。注意该值被按比例地分配到运行中的自动清理工作者上（如果有多个），因此每一个工作者的限制值之和不会超过这个变量中的值。该参数只能在<code class="filename">postgresql.conf</code>文件或在服务器命令中设置。但是对个别表可以通过修改表存储参数来覆盖该设置。
       </p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-statistics.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-client.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">19.9. 运行时统计数据 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 19.11. 客户端连接默认值</td></tr></table></div></body></html>