<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>9.18. 数组函数和操作符</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="functions-conditional.html" title="9.17. 条件表达式" /><link rel="next" href="functions-range.html" title="9.19. 范围函数和操作符" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">9.18. 数组函数和操作符</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="functions-conditional.html" title="9.17. 条件表达式">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="functions.html" title="第 9 章 函数和操作符">上一级</a></td><th width="60%" align="center">第 9 章 函数和操作符</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="functions-range.html" title="9.19. 范围函数和操作符">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="FUNCTIONS-ARRAY"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.18. 数组函数和操作符</h2></div></div></div><p>
   <a class="xref" href="functions-array.html#ARRAY-OPERATORS-TABLE" title="表 9.51. 数组操作符">表 9.51</a>显示了可以用于数组类型的操作符。
  </p><div class="table" id="ARRAY-OPERATORS-TABLE"><p class="title"><strong>表 9.51. 数组操作符</strong></p><div class="table-contents"><table class="table" summary="数组操作符" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>操作符</th><th>描述</th><th>例子</th><th>结果</th></tr></thead><tbody><tr><td> <code class="literal">=</code> </td><td>等于</td><td><code class="literal">ARRAY[1.1,2.1,3.1]::int[] = ARRAY[1,2,3]</code></td><td><code class="literal">t</code></td></tr><tr><td> <code class="literal">&lt;&gt;</code> </td><td>不等于</td><td><code class="literal">ARRAY[1,2,3] &lt;&gt; ARRAY[1,2,4]</code></td><td><code class="literal">t</code></td></tr><tr><td> <code class="literal">&lt;</code> </td><td>小于</td><td><code class="literal">ARRAY[1,2,3] &lt; ARRAY[1,2,4]</code></td><td><code class="literal">t</code></td></tr><tr><td> <code class="literal">&gt;</code> </td><td>大于</td><td><code class="literal">ARRAY[1,4,3] &gt; ARRAY[1,2,4]</code></td><td><code class="literal">t</code></td></tr><tr><td> <code class="literal">&lt;=</code> </td><td>小于等于</td><td><code class="literal">ARRAY[1,2,3] &lt;= ARRAY[1,2,3]</code></td><td><code class="literal">t</code></td></tr><tr><td> <code class="literal">&gt;=</code> </td><td>大于等于</td><td><code class="literal">ARRAY[1,4,3] &gt;= ARRAY[1,4,3]</code></td><td><code class="literal">t</code></td></tr><tr><td> <code class="literal">@&gt;</code> </td><td>包含</td><td><code class="literal">ARRAY[1,4,3] @&gt; ARRAY[3,1,3]</code></td><td><code class="literal">t</code></td></tr><tr><td> <code class="literal">&lt;@</code> </td><td>被包含</td><td><code class="literal">ARRAY[2,2,7] &lt;@ ARRAY[1,7,4,2,6]</code></td><td><code class="literal">t</code></td></tr><tr><td> <code class="literal">&amp;&amp;</code> </td><td>重叠（具有公共元素）</td><td><code class="literal">ARRAY[1,4,3] &amp;&amp; ARRAY[2,1]</code></td><td><code class="literal">t</code></td></tr><tr><td> <code class="literal">||</code> </td><td>数组和数组串接</td><td><code class="literal">ARRAY[1,2,3] || ARRAY[4,5,6]</code></td><td><code class="literal">{1,2,3,4,5,6}</code></td></tr><tr><td> <code class="literal">||</code> </td><td>数组和数组串接</td><td><code class="literal">ARRAY[1,2,3] || ARRAY[[4,5,6],[7,8,9]]</code></td><td><code class="literal">{{1,2,3},{4,5,6},{7,8,9}}</code></td></tr><tr><td> <code class="literal">||</code> </td><td>元素到数组串接</td><td><code class="literal">3 || ARRAY[4,5,6]</code></td><td><code class="literal">{3,4,5,6}</code></td></tr><tr><td> <code class="literal">||</code> </td><td>数组到元素串接</td><td><code class="literal">ARRAY[4,5,6] || 7</code></td><td><code class="literal">{4,5,6,7}</code></td></tr></tbody></table></div></div><br class="table-break" /><p>
   数组排序操作符（<code class="literal">&lt;</code>、<code class="literal">&gt;=</code>等）对数组内容进行逐个元素的比较，使用默认的元素数据类型的B-tree比较函数，并根据第一个差值进行排序。 多维数组的元素按照行序进行访问（最后的下标变化最快）。如果两个数组的内容相同但维数不等，那么维度信息中的第一个不同将决定排序顺序（这是对<span class="productname">PostgreSQL</span> 8.2 之前版本的修改： 老版本认为内容相同的两个数组相等，即使它们的维数或下标范围并不相同）。
  </p><p>
   数组包含操作符（<code class="literal">&lt;@</code>和<code class="literal">@&gt;</code>）认为，如果一个数组的每一个元素出现在另一个数组中，那么这个数组就被包含在另一个数组中。重复数组不做特殊处理，因此<code class="literal">ARRAY[1]</code>和<code class="literal">ARRAY[1,1]</code>分别被认为包含了另一个数组。
  </p><p>
   参阅<a class="xref" href="arrays.html" title="8.15. 数组">第 8.15 节</a>获取有关数组操作符行为的更多细节。有关哪些操作符支持被索引的操作，请参阅<a class="xref" href="indexes-types.html" title="11.2. 索引类型">第 11.2 节</a>。
  </p><p>
   <a class="xref" href="functions-array.html#ARRAY-FUNCTIONS-TABLE" title="表 9.52. 数组函数">表 9.52</a>展示了可以用于数组类型的函数。 参阅<a class="xref" href="arrays.html" title="8.15. 数组">第 8.15 节</a>获取更多信息以及使用这些函数的例子。
  </p><a id="id-1.5.8.23.8" class="indexterm"></a><a id="id-1.5.8.23.9" class="indexterm"></a><a id="id-1.5.8.23.10" class="indexterm"></a><a id="id-1.5.8.23.11" class="indexterm"></a><a id="id-1.5.8.23.12" class="indexterm"></a><a id="id-1.5.8.23.13" class="indexterm"></a><a id="id-1.5.8.23.14" class="indexterm"></a><a id="id-1.5.8.23.15" class="indexterm"></a><a id="id-1.5.8.23.16" class="indexterm"></a><a id="id-1.5.8.23.17" class="indexterm"></a><a id="id-1.5.8.23.18" class="indexterm"></a><a id="id-1.5.8.23.19" class="indexterm"></a><a id="id-1.5.8.23.20" class="indexterm"></a><a id="id-1.5.8.23.21" class="indexterm"></a><a id="id-1.5.8.23.22" class="indexterm"></a><a id="id-1.5.8.23.23" class="indexterm"></a><a id="id-1.5.8.23.24" class="indexterm"></a><div class="table" id="ARRAY-FUNCTIONS-TABLE"><p class="title"><strong>表 9.52. 数组函数</strong></p><div class="table-contents"><table class="table" summary="数组函数" border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th>函数</th><th>返回类型</th><th>描述</th><th>例子</th><th>结果</th></tr></thead><tbody><tr><td>
         <code class="literal">
          <code class="function">array_append</code>(<code class="type">anyarray</code>, <code class="type">anyelement</code>)
         </code>
        </td><td><code class="type">anyarray</code></td><td>向一个数组的末端追加一个元素</td><td><code class="literal">array_append(ARRAY[1,2], 3)</code></td><td><code class="literal">{1,2,3}</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_cat</code>(<code class="type">anyarray</code>, <code class="type">anyarray</code>)
         </code>
        </td><td><code class="type">anyarray</code></td><td>连接两个数组</td><td><code class="literal">array_cat(ARRAY[1,2,3], ARRAY[4,5])</code></td><td><code class="literal">{1,2,3,4,5}</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_ndims</code>(<code class="type">anyarray</code>)
         </code>
        </td><td><code class="type">int</code></td><td>返回数组的维度数</td><td><code class="literal">array_ndims(ARRAY[[1,2,3], [4,5,6]])</code></td><td><code class="literal">2</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_dims</code>(<code class="type">anyarray</code>)
         </code>
        </td><td><code class="type">text</code></td><td>返回数组的维度的文本表示</td><td><code class="literal">array_dims(ARRAY[[1,2,3], [4,5,6]])</code></td><td><code class="literal">[1:2][1:3]</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_fill</code>(<code class="type">anyelement</code>, <code class="type">int[]</code>,
          [<span class="optional">, <code class="type">int[]</code></span>])
         </code>
        </td><td><code class="type">anyarray</code></td><td>返回一个用提供的值和维度初始化好的数组，可以选择下界不为 1</td><td><code class="literal">array_fill(7, ARRAY[3], ARRAY[2])</code></td><td><code class="literal">[2:4]={7,7,7}</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_length</code>(<code class="type">anyarray</code>, <code class="type">int</code>)
         </code>
        </td><td><code class="type">int</code></td><td>返回被请求的数组维度的长度</td><td><code class="literal">array_length(array[1,2,3], 1)</code></td><td><code class="literal">3</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_lower</code>(<code class="type">anyarray</code>, <code class="type">int</code>)
         </code>
        </td><td><code class="type">int</code></td><td>返回被请求的数组维度的下界</td><td><code class="literal">array_lower('[0:2]={1,2,3}'::int[], 1)</code></td><td><code class="literal">0</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_position</code>(<code class="type">anyarray</code>, <code class="type">anyelement</code> [<span class="optional">, <code class="type">int</code></span>])
         </code>
        </td><td><code class="type">int</code></td><td>返回在该数组中从第三个参数指定的元素开始或者
        第一个元素开始（数组必须是一维的）、第二个参数的
        第一次出现的下标</td><td><code class="literal">array_position(ARRAY['sun','mon','tue','wed','thu','fri','sat'], 'mon')</code></td><td><code class="literal">2</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_positions</code>(<code class="type">anyarray</code>, <code class="type">anyelement</code>)
         </code>
        </td><td><code class="type">int[]</code></td><td>返回在第一个参数给定的数组（数组必须是一维的）中，
        第二个参数所有出现位置的下标组成的数组</td><td><code class="literal">array_positions(ARRAY['A','A','B','A'], 'A')</code></td><td><code class="literal">{1,2,4}</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_prepend</code>(<code class="type">anyelement</code>, <code class="type">anyarray</code>)
         </code>
        </td><td><code class="type">anyarray</code></td><td>向一个数组的首部追加一个元素</td><td><code class="literal">array_prepend(1, ARRAY[2,3])</code></td><td><code class="literal">{1,2,3}</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_remove</code>(<code class="type">anyarray</code>, <code class="type">anyelement</code>)
         </code>
        </td><td><code class="type">anyarray</code></td><td>从数组中移除所有等于给定值的所有元素（数组必须是一维的）</td><td><code class="literal">array_remove(ARRAY[1,2,3,2], 2)</code></td><td><code class="literal">{1,3}</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_replace</code>(<code class="type">anyarray</code>, <code class="type">anyelement</code>, <code class="type">anyelement</code>)
         </code>
        </td><td><code class="type">anyarray</code></td><td>将每一个等于给定值的数组元素替换成一个新值</td><td><code class="literal">array_replace(ARRAY[1,2,5,4], 5, 3)</code></td><td><code class="literal">{1,2,3,4}</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_to_string</code>(<code class="type">anyarray</code>, <code class="type">text</code> [<span class="optional">, <code class="type">text</code></span>])
         </code>
        </td><td><code class="type">text</code></td><td>使用提供的定界符和可选的空串连接数组元素</td><td><code class="literal">array_to_string(ARRAY[1, 2, 3, NULL, 5], ',', '*')</code></td><td><code class="literal">1,2,3,*,5</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">array_upper</code>(<code class="type">anyarray</code>, <code class="type">int</code>)
         </code>
        </td><td><code class="type">int</code></td><td>返回被请求的数组维度的上界</td><td><code class="literal">array_upper(ARRAY[1,8,3,7], 1)</code></td><td><code class="literal">4</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">cardinality</code>(<code class="type">anyarray</code>)
         </code>
        </td><td><code class="type">int</code></td><td>返回数组中元素的总数，如果数组为空则返回 0</td><td><code class="literal">cardinality(ARRAY[[1,2],[3,4]])</code></td><td><code class="literal">4</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">string_to_array</code>(<code class="type">text</code>, <code class="type">text</code> [<span class="optional">, <code class="type">text</code></span>])
         </code>
        </td><td><code class="type">text[]</code></td><td>使用提供的定界符和可选的空串将字符串划分成数组元素</td><td><code class="literal">string_to_array('xx~^~yy~^~zz', '~^~', 'yy')</code></td><td><code class="literal">{xx,NULL,zz}</code></td></tr><tr><td>
         <code class="literal">
          <code class="function">unnest</code>(<code class="type">anyarray</code>)
         </code>
        </td><td><code class="type">setof anyelement</code></td><td>将一个数组扩展成一组行</td><td><code class="literal">unnest(ARRAY[1,2])</code></td><td><pre class="literallayout">1
2</pre>(2 rows)</td></tr><tr><td>
         <code class="literal">
          <code class="function">unnest</code>(<code class="type">anyarray</code>, <code class="type">anyarray</code> [, ...])
         </code>
        </td><td><code class="type">setof anyelement, anyelement [, ...]</code></td><td>把多维数组（可能是不同类型）扩展成一个行的集合。
        这只允许用在 FROM 子句中，见
         <a class="xref" href="queries-table-expressions.html#QUERIES-TABLEFUNCTIONS" title="7.2.1.4. 表函数">第 7.2.1.4 节</a></td><td><code class="literal">unnest(ARRAY[1,2],ARRAY['foo','bar','baz'])</code></td><td><pre class="literallayout">1    foo
2    bar
NULL baz</pre>(3 rows)</td></tr></tbody></table></div></div><br class="table-break" /><p>
    在<code class="function">array_position</code>和<code class="function">array_positions</code>中，
    每一个数组元素都使用<code class="literal">IS NOT DISTINCT FROM</code>
    语义与要搜索的值比较。
   </p><p>
    在<code class="function">array_position</code>中，如果值没有找到则返回
    <code class="literal">NULL</code>。
   </p><p>
    在<code class="function">array_positions</code>中，只有当数组为
    <code class="literal">NULL</code>时才返回<code class="literal">NULL</code>，如果该值
    没有在该数组中找到则返回一个空数组。
   </p><p>
    在<code class="function">string_to_array</code>中，如果定界符参数为 NULL，输入字符串中的每一个字符将变成结果数组中的一个独立元素。如果定界符是一个空串，则整个输入字符串被作为一个单一元素的数组返回。否则输入字符串会被在每一个出现定界符字符串的位置分裂。
   </p><p>
    在<code class="function">string_to_array</code>中，如果空值串参数被忽略或者为 NULL，输入中的子串不会被替换成 NULL。在<code class="function">array_to_string</code>中，如果空值串参数被忽略或者为 NULL，该数组中的任何空值元素会被简单地跳过并且不会在输出串中被表示。
   </p><div class="note"><h3 class="title">注意</h3><p>
     <code class="function">string_to_array</code>的行为中有两点与<span class="productname">PostgreSQL</span> 9.1之前的版本不同。首先，当输入串的长度为零时，它将返回一个空（无元素）数组而不是 NULL。其次，如果定界符串为 NULL，该函数会将输入划分成独立字符，而不是像以前那样返回 NULL。
    </p></div><p>
    也可参见<a class="xref" href="functions-aggregate.html" title="9.20. 聚集函数">第 9.20 节</a>了解用于数组的聚集函数<code class="function">array_agg</code>。
   </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="functions-conditional.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="functions.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="functions-range.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">9.17. 条件表达式 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 9.19. 范围函数和操作符</td></tr></table></div></body></html>