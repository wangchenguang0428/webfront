<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>66.5. GIN 提示和技巧</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="gin-implementation.html" title="66.4. 实现" /><link rel="next" href="gin-limit.html" title="66.6. 限制" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">66.5. GIN 提示和技巧</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="gin-implementation.html" title="66.4. 实现">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="gin.html" title="第 66 章 GIN 索引">上一级</a></td><th width="60%" align="center">第 66 章 GIN 索引</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="gin-limit.html" title="66.6. 限制">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="GIN-TIPS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">66.5. GIN 提示和技巧</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">创建 vs. 插入</span></dt><dd><p>
     插入到一个<acronym class="acronym">GIN</acronym>索引可能会很慢，因为为一个项可能需要插入很多歌键。因此，对于一个表的批量插入，我们建议删除 GIN 索引，然后在完成批量插入后重建它。
    </p><p>
     从<span class="productname">PostgreSQL</span> 8.4 开始，这个建议已经不再需要了，因为可以使用延迟索引（详见<a class="xref" href="gin-implementation.html#GIN-FAST-UPDATE" title="66.4.1. GIN 快速更新技术">第 66.4.1 节</a>）。但是对于非常大量的更新，还是最好先删除再重建索引。
    </p></dd><dt><span class="term"><a class="xref" href="runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM">maintenance_work_mem</a></span></dt><dd><p>
     一个<acronym class="acronym">GIN</acronym>索引的建立时间对<code class="varname">maintenance_work_mem</code>设置很敏感；它不考虑在索引创建期间在工作内存上的节省。
    </p></dd><dt><span class="term"><a class="xref" href="runtime-config-client.html#GUC-GIN-PENDING-LIST-LIMIT">gin_pending_list_limit</a></span></dt><dd><p>
     在向一个已有的开启了<code class="literal">fastupdate</code>的<acronym class="acronym">GIN</acronym>
     中进行插入时，系统将在待处理项列表增长到超过<code class="varname">gin_pending_list_limit</code>
     时清理该列表。为了避免在观测到的响应时间上出现波动，让待处理列表清理操作
     在后台进行（即通过 autovacuum）比较好。可以通过增加<code class="varname">gin_pending_list_limit</code>
     或者让 autovacuum 更激进来避免前台的清理操作。不过，增大清理操作的
     阈值意味着如果一次前台清理发生，它将需要更长的时间。
    </p><p>
     可以通过改变存储参数为每个 GIN 索引覆盖它所用的<code class="varname">gin_pending_list_limit</code>，
     这样允许每个 GIN 索引拥有自己的清理阈值。例如，可以只为被大量更新的 GIN 索引增加
     该阈值，而对其他的索引减小该阈值。
    </p></dd><dt><span class="term"><a class="xref" href="runtime-config-client.html#GUC-GIN-FUZZY-SEARCH-LIMIT">gin_fuzzy_search_limit</a></span></dt><dd><p>
     开发<acronym class="acronym">GIN</acronym>索引的主要目的是在<span class="productname">PostgreSQL</span>中创建对高可扩展全文搜索的支持，并且一次全文搜索返回一个非常大的结果集也是很常见的情况。此外，当查询包含非常频繁的词时情况也是如此，因此大结果集不是非常有用。因为从磁盘读取很多元组并且对它们排序可能会花费很多时间，这对于产品来说是不可接受的（注意索引搜索本身是很快的）。
    </p><p>
     为了能够控制这类查询的执行，<acronym class="acronym">GIN</acronym>对于返回的行数有一个可配置的软上限：<code class="varname">gin_fuzzy_search_limit</code>配置参数。默认它被设置为 0 （意为无限制）。如果设置了一个非零限制，那么被返回的集合是整个结果集的一个子集，并且是随机选择的。
    </p><p>
     <span class="quote">“<span class="quote">软</span>”</span>意味着被返回结果的实际数量可以与指定的限制不同，这取决于查询和系统随机数生成器的质量。
    </p><p>
     根据经验，在数千级别的值（如 5000 — 20000）比较好。
    </p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="gin-implementation.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="gin.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="gin-limit.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">66.4. 实现 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 66.6. 限制</td></tr></table></div></body></html>