<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.18. intarray</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="intagg.html" title="F.17. intagg" /><link rel="next" href="isn.html" title="F.19. isn" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.18. intarray</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="intagg.html" title="F.17. intagg">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="附录 F. 额外提供的模块">上一级</a></td><th width="60%" align="center">附录 F. 额外提供的模块</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="isn.html" title="F.19. isn">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="INTARRAY"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.18. intarray</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="intarray.html#id-1.11.7.27.6">F.18.1. <code class="filename">intarray</code> 函数和操作符</a></span></dt><dt><span class="sect2"><a href="intarray.html#id-1.11.7.27.7">F.18.2. 索引支持</a></span></dt><dt><span class="sect2"><a href="intarray.html#id-1.11.7.27.8">F.18.3. 例子</a></span></dt><dt><span class="sect2"><a href="intarray.html#id-1.11.7.27.9">F.18.4. 测试基准</a></span></dt><dt><span class="sect2"><a href="intarray.html#id-1.11.7.27.10">F.18.5. 作者</a></span></dt></dl></div><a id="id-1.11.7.27.2" class="indexterm"></a><p>
  <code class="filename">intarray</code>模块提供了一些有用的函数和操作符来操纵不含空值的整数数组。也提供了对使用某些操作符的索引搜索的支持。
 </p><p>
  如果一个提供的数组中包含任何 NULL 元素，所有这些操作都将抛出一个错误。
 </p><p>
  很多这些操作只对一维数组有意义。尽管它们将接受更多维数的数组输入，数据将被当作一个按照存储顺序排列的线性数组对待。
 </p><div class="sect2" id="id-1.11.7.27.6"><div class="titlepage"><div><div><h3 class="title">F.18.1. <code class="filename">intarray</code> 函数和操作符</h3></div></div></div><p>
   <code class="filename">intarray</code>模块提供的函数被列在<a class="xref" href="intarray.html#INTARRAY-FUNC-TABLE" title="表 F.9. intarray 函数">表 F.9</a>中，操作符被列在<a class="xref" href="intarray.html#INTARRAY-OP-TABLE" title="表 F.10. intarray 操作符">表 F.10</a>中。
  </p><div class="table" id="INTARRAY-FUNC-TABLE"><p class="title"><strong>表 F.9. <code class="filename">intarray</code> 函数</strong></p><div class="table-contents"><table class="table" summary="intarray 函数" border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th>函数</th><th>返回类型</th><th>描述</th><th>例子</th><th>结果</th></tr></thead><tbody><tr><td><code class="function">icount(int[])</code><a id="id-1.11.7.27.6.3.2.2.1.1.2" class="indexterm"></a></td><td><code class="type">int</code></td><td>数组中元素的数量</td><td><code class="literal">icount('{1,2,3}'::int[])</code></td><td><code class="literal">3</code></td></tr><tr><td><code class="function">sort(int[], text dir)</code><a id="id-1.11.7.27.6.3.2.2.2.1.2" class="indexterm"></a></td><td><code class="type">int[]</code></td><td>排序数组 — <em class="parameter"><code>dir</code></em>必须是<code class="literal">asc</code>或<code class="literal">desc</code></td><td><code class="literal">sort('{1,2,3}'::int[], 'desc')</code></td><td><code class="literal">{3,2,1}</code></td></tr><tr><td><code class="function">sort(int[])</code></td><td><code class="type">int[]</code></td><td>以升序排序</td><td><code class="literal">sort(array[11,77,44])</code></td><td><code class="literal">{11,44,77}</code></td></tr><tr><td><code class="function">sort_asc(int[])</code><a id="id-1.11.7.27.6.3.2.2.4.1.2" class="indexterm"></a></td><td><code class="type">int[]</code></td><td>以升序排序</td><td><code class="literal"></code></td><td><code class="literal"></code></td></tr><tr><td><code class="function">sort_desc(int[])</code><a id="id-1.11.7.27.6.3.2.2.5.1.2" class="indexterm"></a></td><td><code class="type">int[]</code></td><td>以降序排序</td><td><code class="literal"></code></td><td><code class="literal"></code></td></tr><tr><td><code class="function">uniq(int[])</code><a id="id-1.11.7.27.6.3.2.2.6.1.2" class="indexterm"></a></td><td><code class="type">int[]</code></td><td>移除临近的重复</td><td><code class="literal">uniq(sort('{1,2,3,2,1}'::int[]))</code></td><td><code class="literal">{1,2,3}</code></td></tr><tr><td><code class="function">idx(int[], int item)</code><a id="id-1.11.7.27.6.3.2.2.7.1.2" class="indexterm"></a></td><td><code class="type">int</code></td><td>匹配<em class="parameter"><code>item</code></em>的第一个元素的索引（如果没有为 0）</td><td><code class="literal">idx(array[11,22,33,22,11], 22)</code></td><td><code class="literal">2</code></td></tr><tr><td><code class="function">subarray(int[], int start, int len)</code><a id="id-1.11.7.27.6.3.2.2.8.1.2" class="indexterm"></a></td><td><code class="type">int[]</code></td><td>从位置<em class="parameter"><code>start</code></em>开始的由<em class="parameter"><code>len</code></em>个元素组成的元组部分</td><td><code class="literal">subarray('{1,2,3,2,1}'::int[], 2, 3)</code></td><td><code class="literal">{2,3,2}</code></td></tr><tr><td><code class="function">subarray(int[], int start)</code></td><td><code class="type">int[]</code></td><td>从位置<em class="parameter"><code>start</code></em>开始的元组部分</td><td><code class="literal">subarray('{1,2,3,2,1}'::int[], 2)</code></td><td><code class="literal">{2,3,2,1}</code></td></tr><tr><td><code class="function">intset(int)</code><a id="id-1.11.7.27.6.3.2.2.10.1.2" class="indexterm"></a></td><td><code class="type">int[]</code></td><td>创建单一元素数组</td><td><code class="literal">intset(42)</code></td><td><code class="literal">{42}</code></td></tr></tbody></table></div></div><br class="table-break" /><div class="table" id="INTARRAY-OP-TABLE"><p class="title"><strong>表 F.10. <code class="filename">intarray</code> 操作符</strong></p><div class="table-contents"><table class="table" summary="intarray 操作符" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>操作符</th><th>返回</th><th>描述</th></tr></thead><tbody><tr><td><code class="literal">int[] &amp;&amp; int[]</code></td><td><code class="type">boolean</code></td><td>重叠 — 如果数组有至少一个公共元素，则为<code class="literal">true</code></td></tr><tr><td><code class="literal">int[] @&gt; int[]</code></td><td><code class="type">boolean</code></td><td>包含 — 如果左数组包含右数组，则为<code class="literal">true</code></td></tr><tr><td><code class="literal">int[] &lt;@ int[]</code></td><td><code class="type">boolean</code></td><td>被包含 — 如果左数组被右数组包含，则为<code class="literal">true</code></td></tr><tr><td><code class="literal"># int[]</code></td><td><code class="type">int</code></td><td>数组中元素的数目</td></tr><tr><td><code class="literal">int[] # int</code></td><td><code class="type">int</code></td><td>索引（与<code class="function">idx</code>函数相同）</td></tr><tr><td><code class="literal">int[] + int</code></td><td><code class="type">int[]</code></td><td>把元素推到数组中（增加到数组末尾）</td></tr><tr><td><code class="literal">int[] + int[]  </code></td><td><code class="type">int[]</code></td><td>数组串接（把右数组增加到左数组的末尾）</td></tr><tr><td><code class="literal">int[] - int</code></td><td><code class="type">int[]</code></td><td>从数组中移除匹配右参数的项</td></tr><tr><td><code class="literal">int[] - int[]</code></td><td><code class="type">int[]</code></td><td>从左数组中移除右数组的元素</td></tr><tr><td><code class="literal">int[] | int</code></td><td><code class="type">int[]</code></td><td>参数的联合</td></tr><tr><td><code class="literal">int[] | int[]</code></td><td><code class="type">int[]</code></td><td>数组的联合</td></tr><tr><td><code class="literal">int[] &amp; int[]</code></td><td><code class="type">int[]</code></td><td>数组的交</td></tr><tr><td><code class="literal">int[] @@ query_int</code></td><td><code class="type">boolean</code></td><td>如果数组满足查询（见下文），则为<code class="literal">true</code></td></tr><tr><td><code class="literal">query_int ~~ int[]</code></td><td><code class="type">boolean</code></td><td>如果数组满足查询（<code class="literal">@@</code>交换子），则为<code class="literal">true</code></td></tr></tbody></table></div></div><br class="table-break" /><p>
   （在 PostgreSQL 8.2 之前，包含操作符<code class="literal">@&gt;</code>和<code class="literal">&lt;@</code>分别被称为<code class="literal">@</code>和<code class="literal">~</code>。这些名称仍然有效，但是已被弃用并且将最终被移除。注意旧名称与核心几何数据类型之前所遵循的习惯相反！）
  </p><p>
   操作符<code class="literal">&amp;&amp;</code>、<code class="literal">@&gt;</code>和<code class="literal">&lt;@</code>等效于<span class="productname">PostgreSQL</span>的内建同名操作符，不过它们只能在不含空值的整数数组上工作，而内建的操作符可以对任何数组类型工作。这种限制使它们在很多情况下比内建操作符更快。
  </p><p>
   <code class="literal">@@</code>和<code class="literal">~~</code>操作符测试一个数组是否满足一个<em class="firstterm">query</em>，它被表示成一种特殊数据类型<code class="type">query_int</code>的一个值。一个由整数值组成的<em class="firstterm">查询</em>会被针对数组的元素检查，可能会组合使用操作符<code class="literal">&amp;</code>（AND）、<code class="literal">|</code>（OR）以及<code class="literal">!</code>（NOT）。根据需要可以使用圆括号。例如，查询<code class="literal">1&amp;(2|3)</code>匹配包含 1 并且还包括 2 或 3 的数组。
  </p></div><div class="sect2" id="id-1.11.7.27.7"><div class="titlepage"><div><div><h3 class="title">F.18.2. 索引支持</h3></div></div></div><p>
   <code class="filename">intarray</code>提供对于<code class="literal">&amp;&amp;</code>、<code class="literal">@&gt;</code>、<code class="literal">&lt;@</code>和<code class="literal">@@</code>操作符以及常规数组相等的索引支持。
  </p><p>
   提供了两种 GiST 索引操作符类：<code class="literal">gist__int_ops</code>（被默认使用）适合于中小尺寸的数据集，而<code class="literal">gist__intbig_ops</code>使用一种更大的签名并且更适合于索引大型数据集（即，包含大量可区分数组值的列）。该实现使用了一种带有内建有损压缩的 RD 树结构。
  </p><p>
   也有一种非默认的 GIN 操作符类<code class="literal">gin__int_ops</code>支持相同的操作符。
  </p><p>
   在 GiST 和 GIN 索引之间的选择取决于 GiST 和 GIN 的相对性能特点，
   这将在其他地方讨论。
  </p></div><div class="sect2" id="id-1.11.7.27.8"><div class="titlepage"><div><div><h3 class="title">F.18.3. 例子</h3></div></div></div><pre class="programlisting">
-- 一个消息可以在一个或多个<span class="quote">“<span class="quote">小节</span>”</span>中
CREATE TABLE message (mid INT PRIMARY KEY, sections INT[], ...);

-- 创建专门的索引
CREATE INDEX message_rdtree_idx ON message USING GIST (sections gist__int_ops);

-- 选择小节 1 或 2 中的消息 - OVERLAP 操作符
SELECT message.mid FROM message WHERE message.sections &amp;&amp; '{1,2}';

-- 选择小节 1 和 2 中的消息 - CONTAINS 操作符
SELECT message.mid FROM message WHERE message.sections @&gt; '{1,2}';

-- 相同，使用 QUERY 操作符
SELECT message.mid FROM message WHERE message.sections @@ '1&amp;2'::query_int;
</pre></div><div class="sect2" id="id-1.11.7.27.9"><div class="titlepage"><div><div><h3 class="title">F.18.4. 测试基准</h3></div></div></div><p>
   源代码目录<code class="filename">contrib/intarray/bench</code>包含有一个基准测试套件，可以针对
   一个安装好的<span class="productname">PostgreSQL</span>服务器运行这个套件（还要求安装
   <code class="filename">DBD::Pg</code>）。要运行测试基准：
  </p><pre class="programlisting">
cd .../contrib/intarray/bench
createdb TEST
psql -c "CREATE EXTENSION intarray" TEST
./create_test.pl | psql TEST
./bench.pl
</pre><p>
   <code class="filename">bench.pl</code>脚本有多个选项，当它不使用任何参数运行时会显示这些选项。
  </p></div><div class="sect2" id="id-1.11.7.27.10"><div class="titlepage"><div><div><h3 class="title">F.18.5. 作者</h3></div></div></div><p>
   所有工作由 Teodor Sigaev（<code class="email">&lt;<a class="email" href="mailto:teodor@sigaev.ru">teodor@sigaev.ru</a>&gt;</code>）和 Oleg Bartunov（<code class="email">&lt;<a class="email" href="mailto:oleg@sai.msu.su">oleg@sai.msu.su</a>&gt;</code>）完成。更多信息请见<a class="ulink" href="http://www.sai.msu.su/~megera/postgres/gist/" target="_top">http://www.sai.msu.su/~megera/postgres/gist/</a>。Andrey Oktyabrski 完成了一项伟大的工作，他增加了新的函数和操作。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="intagg.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="isn.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">F.17. intagg </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> F.19. isn</td></tr></table></div></body></html>