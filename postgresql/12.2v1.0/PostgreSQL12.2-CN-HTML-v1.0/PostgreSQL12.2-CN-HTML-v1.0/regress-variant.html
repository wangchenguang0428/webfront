<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>32.3. 变体比较文件</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="regress-evaluation.html" title="32.2. 测试评估" /><link rel="next" href="regress-tap.html" title="32.4. TAP 测试" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">32.3. 变体比较文件</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="regress-evaluation.html" title="32.2. 测试评估">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="regress.html" title="第 32 章 回归测试">上一级</a></td><th width="60%" align="center">第 32 章 回归测试</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="regress-tap.html" title="32.4. TAP 测试">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="REGRESS-VARIANT"><div class="titlepage"><div><div><h2 class="title" style="clear: both">32.3. 变体比较文件</h2></div></div></div><p>
    因为某些测试生来就会产生依赖环境的结果，我们提供了方法来指定替代的<span class="quote">“<span class="quote">预期</span>”</span>结果文件。每一个回归测试可以有多个比较文件来展示在不同平台上的可能结果。有两种独立的机制来决定为每一个测试使用哪个比较文件。
   </p><p>
    第一种机制允许为指定平台选择比较文件。这是一个映射文件<code class="filename">src/test/regress/resultmap</code>，它定义了为每一个平台使用哪个比较文件。要为一个特定平台消除虚假的测试<span class="quote">“<span class="quote">失败</span>”</span>，你可以首先选择或创建一个变体结果文件，然后在<code class="filename">resultmap</code>文件中增加一行。
   </p><p>
    在该映射文件中的每一行的形式为：
</p><pre class="synopsis">
testname:output:platformpattern=comparisonfilename
</pre><p>
    测试名只是该特定回归测试模块的名称。输出值指定要检查哪个输出文件。对于标准回归测试，这总是<code class="literal">out</code>。该值对应于输出文件的文件扩展。平台模式是一个 Unix 工具<code class="command">expr</code>风格的模式（即在开头带有一个隐式<code class="literal">^</code>锚的正则表达式）。它被与<code class="command">config.guess</code>打印出的平台名称进行匹配。匹配文件名称是替补的结果比较文件的基础名。
   </p><p>
    例如：某些系统缺少工作<code class="literal">strtof</code>函数，我们的解决方法在<code class="filename">float4</code>回归测试中会导致舍入误差。
    因此，我们提供一个变体比较文件<code class="filename">float4-misrounded-input.out</code>，其中包括了在这些系统上的期望结果。
    要在<span class="systemitem">HP-UX 10</span>平台上屏蔽这种虚假的<span class="quote">“<span class="quote">failure</span>”</span> 消息，<code class="filename">resultmap</code>包括：
</p><pre class="programlisting">
float4:out:hppa.*-hp-hpux10.*=float4-misrounded-input.out
</pre><p>
    这将触发<code class="command">config.guess</code> 的输出匹配 <code class="literal">hppa.*-hp-hpux10.*</code>的任何机器。
    <code class="filename">resultmap</code>中的其他行为其他平台选择适用的变体比较文件。
   </p><p>
    第二种变体比较文件的选择机制更加自动：它简单地在多个提供的比较文件中采用<span class="quote">“<span class="quote">最佳匹配</span>”</span>。回归测试驱动器脚本对一个测试考虑两种标准比较文件，<code class="literal"><em class="replaceable"><code>testname</code></em>.out</code>以及名为<code class="literal"><em class="replaceable"><code>testname</code></em>_<em class="replaceable"><code>digit</code></em>.out</code>的变体文件（其中<em class="replaceable"><code>digit</code></em>是任何单一数字<code class="literal">0</code>-<code class="literal">9</code>）。如果任一这种文件是一个完全匹配，测试被认为是通过的。否则，产生最短区别的文件被用来创建失败报告（如果<code class="filename">resultmap</code>包括特定测试的一个项，那么基础<em class="replaceable"><code>testname</code></em>是<code class="filename">resultmap</code>中给定的替补名称）。
   </p><p>
    例如，对于<code class="literal">char</code>测试，比较文件<code class="filename">char.out</code>包含在<code class="literal">C</code>和<code class="literal">POSIX</code>区域中期望的结果，而文件<code class="filename">char_1.out</code>包含在其他很多区域中的排序结果。
   </p><p>
    最佳匹配机制被设计为与区域依赖的结果协同工作，但是它可以被用在任何测试结果无法只从平台名很容易地预测的情况中。这种机制的一个限制是测试驱动器不能说出哪个变体对当前环境是真正<span class="quote">“<span class="quote">正确的</span>”</span>，它将只是选择看起来工作得最好的变体。因此对你认为在所有上下文中具有同等合法性的变体结果使用这种机制才是最安全的。
   </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="regress-evaluation.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="regress.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="regress-tap.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">32.2. 测试评估 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 32.4. TAP 测试</td></tr></table></div></body></html>