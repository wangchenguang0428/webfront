<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>18.11. 使用SSH隧道的安全 TCP/IP 连接</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="gssapi-enc.html" title="18.10. Secure TCP/IP Connections with GSSAPI Encryption" /><link rel="next" href="event-log-registration.html" title="18.12. 在Windows上注册事件日志" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">18.11. 使用<span xmlns="http://www.w3.org/1999/xhtml" class="application">SSH</span>隧道的安全 TCP/IP 连接</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="gssapi-enc.html" title="18.10. Secure TCP/IP Connections with GSSAPI Encryption">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime.html" title="第 18 章 服务器设置和操作">上一级</a></td><th width="60%" align="center">第 18 章 服务器设置和操作</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="event-log-registration.html" title="18.12. 在Windows上注册事件日志">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="SSH-TUNNELS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">18.11. 使用<span class="application">SSH</span>隧道的安全 TCP/IP 连接</h2></div></div></div><a id="id-1.6.5.13.2" class="indexterm"></a><p>
   可以使用<span class="application">SSH</span>来加密客户端和<span class="productname">PostgreSQL</span>服务器之间的网络连接。如果处理得当，这将提供一个足够安全的网络连接，即使是对那些无 SSL 能力的客户端。
  </p><p>
   首先确认在<span class="productname">PostgreSQL</span>服务器的同一台机器上正确运行着一个<span class="application">SSH</span>服务器，并且你可以使用<code class="command">ssh</code>作为某个用户登入。然后你可以从客户端机器采用下面这种形式的命令建立一个安全的隧道：
</p><pre class="programlisting">
ssh -L 63333:localhost:5432 joe@foo.com
</pre><p>
   <code class="option">-L</code>参数中的第一个数（63333）是隧道在你那一端的端口号，它可以是任意未用过的端口（IANA 把端口 49152 到 65535 保留为个人使用）。第二个数（5432）是隧道的远端：你的服务器所使用的端口号。在端口号之间的名字或 IP 地址是你准备连接的数据库服务器的主机，至于你是从哪个主机登入的，在这个例子中则由<code class="literal">foo.com</code>表示。为了使用这个隧道连接到数据库服务器，你在本地机器上连接到端口 63333：
</p><pre class="programlisting">
psql -h localhost -p 63333 postgres
</pre><p>
   对于数据库服务器，在这个环境中它将把你看做是连接到<code class="literal">localhost</code>的主机<code class="literal">foo.com</code>上的真实用户<code class="literal">joe</code>，并且它会使用被配置用于来自这个用户和主机的连接的认证过程。注意服务器将不会认为连接是 SSL 加密的，因为事实上<span class="application">SSH</span>服务器和<span class="productname">PostgreSQL</span>服务器之间没有加密。只要它们在同一台机器上，这就不会造成任何额外的安全风险。
  </p><p>
   为了让隧道设置成功，你必须允许通过<code class="command">ssh</code>作为<code class="literal">joe@foo.com</code>连接，就像你已经尝试使用<code class="command">ssh</code>来创建一个终端会话。
  </p><p>
   你应当也已经设定好了端口转发：
</p><pre class="programlisting">
ssh -L 63333:foo.com:5432 joe@foo.com
</pre><p>
   但是数据库服务器则将会看到连接从它的<code class="literal">foo.com</code>接口进来，它没有被默认设置<code class="literal">listen_addresses = 'localhost'</code>所打开。这通常不是你想要的。
  </p><p>
   如果你必须通过某个登录主机<span class="quote">“<span class="quote">跳</span>”</span>到数据库服务器，一个可能的设置看起来像：
</p><pre class="programlisting">
ssh -L 63333:db.foo.com:5432 joe@shell.foo.com
</pre><p>
   注意这种从<code class="literal">shell.foo.com</code>到<code class="literal">db.foo.com</code>的连接的方法将不会被 SSH 隧道加密。当网络被限制于各种方法时，SSH 提供了相当多的配置可能性。详情请参考 SSH 的文档。
  </p><div class="tip"><h3 class="title">提示</h3><p>
    一些其他的应用可以提供安全隧道，它们使用和刚刚描述的 SSH 概念上相似的过程。
   </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="gssapi-enc.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="event-log-registration.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">18.10. Secure TCP/IP Connections with GSSAPI Encryption </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 18.12. 在<span class="systemitem">Windows</span>上注册<span class="application">事件日志</span></td></tr></table></div></body></html>