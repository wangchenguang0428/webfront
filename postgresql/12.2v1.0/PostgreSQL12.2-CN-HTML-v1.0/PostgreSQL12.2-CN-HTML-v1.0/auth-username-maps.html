<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>20.2. 用户名映射</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="auth-pg-hba-conf.html" title="20.1. pg_hba.conf文件" /><link rel="next" href="auth-methods.html" title="20.3. 认证方法" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">20.2. 用户名映射</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="auth-pg-hba-conf.html" title="20.1. pg_hba.conf文件">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="client-authentication.html" title="第 20 章 客户端认证">上一级</a></td><th width="60%" align="center">第 20 章 客户端认证</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 12.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="auth-methods.html" title="20.3. 认证方法">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="AUTH-USERNAME-MAPS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.2. 用户名映射</h2></div></div></div><a id="id-1.6.7.9.2" class="indexterm"></a><p>
   当使用像 Ident 或者 GSSAPI 之类的外部认证系统时，发起连接的操作系统用户名可能不同于要被使用的数据库用户（角色）。在这种情况下，一个用户名映射可被用来把操作系统用户名映射到数据库用户。要使用用户名映射，在<code class="filename">pg_hba.conf</code>的选项域指定<code class="literal">map</code>=<em class="replaceable"><code>map-name</code></em>。此选项支持所有接收外部用户名的认证方法。由于不同的连接可能需要不同的映射，在<code class="filename">pg_hba.conf</code>中的<em class="replaceable"><code>map-name</code></em>参数中指定要被使用的映射名，用以指示哪个映射用于每个个体连接。
  </p><p>
   用户名映射定义在 ident 映射文件中，默认情况下它被命名为<code class="filename">pg_ident.conf</code><a id="id-1.6.7.9.4.2" class="indexterm"></a>并被存储在集簇的数据目录中（不过，可以把该映射文件放在其他地方，见<a class="xref" href="runtime-config-file-locations.html#GUC-IDENT-FILE">ident_file</a>配置参数）。ident 映射文件包含的行的一般格式：
</p><pre class="synopsis">
<em class="replaceable"><code>map-name</code></em> <em class="replaceable"><code>system-username</code></em> <em class="replaceable"><code>database-username</code></em>
</pre><p>
   以在<code class="filename">pg_hba.conf</code>中同样的方式处理注释和空白。<em class="replaceable"><code>map-name</code></em>是一个任意名称，它将被用于在<code class="filename">pg_hba.conf</code>中引用该映射。其他两个域指定一个操作系统用户名和一个匹配的数据库用户名。相同的<em class="replaceable"><code>map-name</code></em>可以被反复地用在同一个映射中指定多个用户映射。
  </p><p>
   对于一个给定操作系统用户可以对应多少个数据库用户没有限制，反之亦然。因此，一个映射中的项应该被看成意味着<span class="quote">“<span class="quote">这个操作系统用户被允许作为这个数据库用户连接</span>”</span>，而不是按时它们等价。如果有任何映射项把从外部认证系统获得的用户名和用户要求的数据库用户名配对，该连接将被允许。
  </p><p>
   如果<em class="replaceable"><code>system-username</code></em>域以一个斜线（<code class="literal">/</code>）开始，域的剩余部分被当做一个正则表达式（<span class="productname">PostgreSQL</span>的正则表达式语法详见<a class="xref" href="functions-matching.html#POSIX-SYNTAX-DETAILS" title="9.7.3.1. 正则表达式细节">第 9.7.3.1 节</a>）。正则表达式可以包括一个单一的捕获，或圆括号子表达式，然后它可以在<em class="replaceable"><code>database-username</code></em>域中以<code class="literal">\1</code>（反斜线一）被引用。这允许在单个行中多个用户名的映射，这特别有助于简单的语法替换。例如，这些项
</p><pre class="programlisting">
mymap   /^(.*)@mydomain\.com$      \1
mymap   /^(.*)@otherdomain\.com$   guest
</pre><p>
   将为用户移除以<code class="literal">@mydomain.com</code>结束的系统用户名的域部分，以及允许系统名以<code class="literal">@otherdomain.com</code>结束的任意用户作为<code class="literal">guest</code>登入。
  </p><div class="tip"><h3 class="title">提示</h3><p>
    记住在默认情况下，一个正则表达式可以只匹配字符串的一部分。如上例所示，使用<code class="literal">^</code>和<code class="literal">$</code>来强制匹配整个系统用户名通常是明智的。
   </p></div><p>
   在启动以及主服务器进程收到<span class="systemitem">SIGHUP</span><a id="id-1.6.7.9.8.2" class="indexterm"></a>信号时，<code class="filename">pg_ident.conf</code>文件会被读取。 
   如果你在活动的系统上编辑了该文件，你将需要通知 postmaster（使用<code class="literal">pg_ctl reload</code>,调用SQL函数<code class="function">pg_reload_conf()</code>, 或用<code class="literal">kill -HUP</code>）重新读取文件。
  </p><p>
   <a class="xref" href="auth-username-maps.html#EXAMPLE-PG-IDENT.CONF" title="例 20.2. 一个示例 pg_ident.conf 文件">例 20.2</a>中展示了一个可以联合<code class="filename">pg_hba.conf</code>文件（<a class="xref" href="auth-pg-hba-conf.html#EXAMPLE-PG-HBA.CONF" title="例 20.1. 示例 pg_hba.conf 项">例 20.1</a>）使用的<code class="filename">pg_ident.conf</code>文件。在这个例子中，对于任何登入到 192.168 网络上的一台机器的用户， 如果该用户没有操作系统用户名<code class="literal">bryanh</code>、<code class="literal">ann</code>或<code class="literal">robert</code>，则他不会被授予访问权限。只有当 Unix 用户<code class="literal">robert</code>尝试作为<span class="productname">PostgreSQL</span>用户<code class="literal">bob</code>（而不是作为<code class="literal">robert</code>或其他人）连接时，他才被允许访问。<code class="literal">ann</code>只被允许作为<code class="literal">ann</code>连接。用户<code class="literal">bryanh</code>被允许以<code class="literal">bryanh</code>或者<code class="literal">guest1</code>连接。
  </p><div class="example" id="EXAMPLE-PG-IDENT.CONF"><p class="title"><strong>例 20.2. 一个示例 <code class="filename">pg_ident.conf</code> 文件</strong></p><div class="example-contents"><pre class="programlisting">
# MAPNAME       SYSTEM-USERNAME         PG-USERNAME

omicron         bryanh                  bryanh
omicron         ann                     ann
# bob 在这些机器上有用户名 robert
omicron         robert                  bob
# bryanh 也可以作为 guest1 连接
omicron         bryanh                  guest1
</pre></div></div><br class="example-break" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="auth-pg-hba-conf.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="client-authentication.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="auth-methods.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">20.1. <code class="filename">pg_hba.conf</code>文件 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 20.3. 认证方法</td></tr></table></div></body></html>