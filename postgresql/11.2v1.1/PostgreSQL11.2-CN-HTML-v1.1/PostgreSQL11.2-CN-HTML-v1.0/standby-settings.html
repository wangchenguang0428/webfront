<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>27.3. 后备服务器设置</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="recovery-target-settings.html" title="27.2. 恢复目标设置" /><link rel="next" href="monitoring.html" title="第 28 章 监控数据库活动" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">27.3. 后备服务器设置</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="recovery-target-settings.html" title="27.2. 恢复目标设置">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="recovery-config.html" title="第 27 章 恢复配置">上一级</a></td><th width="60%" align="center">第 27 章 恢复配置</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 11.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="monitoring.html" title="第 28 章 监控数据库活动">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="STANDBY-SETTINGS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">27.3. 后备服务器设置</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="STANDBY-MODE"><span class="term"><code class="varname">standby_mode</code> (<code class="type">boolean</code>)
        <a id="id-1.6.14.8.2.1.1.3" class="indexterm"></a>
        </span></dt><dd><p>
          指定是否将<span class="productname">PostgreSQL</span>服务器作为一个后备服务器启动。如果这个参数为<code class="literal">on</code>，当到达已归档 WAL 末尾时该服务器将不会停止恢复，但是将通过使用<code class="varname">restore_command</code>获得新的 WAL 段以及/或者通过使用<code class="varname">primary_conninfo</code>设置连接到主服务器来尝试继续恢复。
         </p></dd><dt id="PRIMARY-CONNINFO"><span class="term"><code class="varname">primary_conninfo</code> (<code class="type">string</code>)
        <a id="id-1.6.14.8.2.2.1.3" class="indexterm"></a>
        </span></dt><dd><p>
          指定后备服务器用来连接主服务器的连接字符串。这个字符串的格式在<a class="xref" href="libpq-connect.html#LIBPQ-CONNSTRING" title="34.1.1. 连接字符串">第 34.1.1 节</a>中描述。如果在这个字符串中有任何选项未被指定，那么将检查相应的环境变量（见<a class="xref" href="libpq-envars.html" title="34.14. 环境变量">第 34.14 节</a>）。如果环境变量也没有被设置，则使用默认值。
         </p><p>
          连接字符串应当指定主服务器的主机名（或地址），以及端口号（如果它和后备服务器的默认端口不同）。还要指定对应于主服务器上合适权限角色的用户名（见<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-AUTHENTICATION" title="26.2.5.1. 认证">第 26.2.5.1 节</a>）。如果主服务器要求口令认证，还需要提供一个口令。它可以在<code class="varname">primary_conninfo</code>字符串中提供，或者在后备服务器（使用<code class="literal">replication</code>作为数据库名）的一个单独<code class="filename">~/.pgpass</code>文件中提供。不要在<code class="varname">primary_conninfo</code>字符串中指定一个数据库名。
         </p><p>
          如果<code class="varname">standby_mode</code>为<code class="literal">off</code>，这个设置没有效果。
         </p></dd><dt id="PRIMARY-SLOT-NAME"><span class="term"><code class="varname">primary_slot_name</code> (<code class="type">string</code>)
        <a id="id-1.6.14.8.2.3.1.3" class="indexterm"></a>
        </span></dt><dd><p>
          有选择地指定通过流复制连接到主服务器时使用一个现有的复制槽来控制上游节点上的资源移除（见<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-SLOTS" title="26.2.6. 复制槽">第 26.2.6 节</a>）。如果没有设置<code class="varname">primary_conninfo</code>则这个设置无效。
         </p></dd><dt id="TRIGGER-FILE"><span class="term"><code class="varname">trigger_file</code> (<code class="type">string</code>)
        <a id="id-1.6.14.8.2.4.1.3" class="indexterm"></a>
        </span></dt><dd><p>
          指定一个触发器文件，该文件的存在会结束后备机中的恢复。即使这个值没有被设置，你也能够使用<code class="command">pg_ctl promote</code>来提升后备机。如果<code class="varname">standby_mode</code>为<code class="literal">off</code>，这个设置没有效果。
         </p></dd><dt id="RECOVERY-MIN-APPLY-DELAY"><span class="term"><code class="varname">recovery_min_apply_delay</code> (<code class="type">integer</code>)
      <a id="id-1.6.14.8.2.5.1.3" class="indexterm"></a>
      </span></dt><dd><p>
        某人情况下，一个后备服务器会尽快恢复来自于主服务器的 WAL 记录。有一份数据的延时拷贝是有用的，它能提供机会纠正数据丢失错误。这个参数允许你将恢复延迟一段固定的时间，如果没有指定单位则以毫秒为单位。例如，如果你设置这个参数为<code class="literal">5min</code>，对于一个事务提交，只有当后备机上的系统时钟超过主服务器报告的提交时间至少 5分钟时，后备机才会重放该事务。
       </p><p>
        有可能服务器之间的复制延迟会超过这个参数的值，在这种情况下则不会增加延迟。注意延迟是根据主服务器上写 WAL 的时间戳以及后备机上的当前时间来计算。由于网络延迟或者级联复制配置导致的传输延迟可能会显著地减少实际等待时间。如果主服务器和后备机上的系统时钟不同步，这会导致恢复比预期的更早应用记录。但这不是一个主要问题，因为这个参数有用的设置比服务器之间的典型事件偏差要大得多。
       </p><p>
        只有在事务提交的 WAL 记录上才会发生延迟。其他记录还是会被尽可能快地重放，这不会成为问题，因为 MVCC 可见性规则确保了在对应的提交记录被应用之前它们的效果不会被看到。
       </p><p>
        一旦恢复中的数据库已经达到一致状态，延迟就会产生，直到后备机被提升或者触发。在那之后，后备机将会结束恢复并且不再等待。
       </p><p>
        这个参数的目的是和流复制部署一起使用，但是，如果指定了该参数，所有的情况下都会遵守它。使用这个特性也会让<code class="varname">hot_standby_feedback</code>被延迟，这可能导致主服务器的膨胀，两者一起使用时要小心。
        
        </p><div class="warning"><h3 class="title">警告</h3><p>
          当<code class="varname">synchronous_commit</code>被设置为<code class="literal">remote_apply</code>时，同步复制会受到这个设置的影响，每一个<code class="literal">COMMIT</code>都需要等待被应用。
         </p></div><p>
       </p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="recovery-target-settings.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="recovery-config.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="monitoring.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">27.2. 恢复目标设置 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 第 28 章 监控数据库活动</td></tr></table></div></body></html>