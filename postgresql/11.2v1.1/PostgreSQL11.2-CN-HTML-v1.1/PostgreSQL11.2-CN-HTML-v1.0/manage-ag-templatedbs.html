<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>22.3. 模板数据库</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="manage-ag-createdb.html" title="22.2. 创建一个数据库" /><link rel="next" href="manage-ag-config.html" title="22.4. 数据库配置" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">22.3. 模板数据库</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="manage-ag-createdb.html" title="22.2. 创建一个数据库">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="managing-databases.html" title="第 22 章 管理数据库">上一级</a></td><th width="60%" align="center">第 22 章 管理数据库</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 11.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="manage-ag-config.html" title="22.4. 数据库配置">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="MANAGE-AG-TEMPLATEDBS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">22.3. 模板数据库</h2></div></div></div><p>
   <code class="command">CREATE DATABASE</code>实际上通过拷贝一个已有数据库进行工作。默认情况下，它拷贝名为<code class="literal">template1</code><a id="id-1.6.9.6.2.3" class="indexterm"></a>的标准系统数据库。所以该数据库是创建新数据库的<span class="quote">“<span class="quote">模板</span>”</span>。 如果你为<code class="literal">template1</code>数据库增加对象，这些对象将被拷贝到后续创建的用户数据库中。 这种行为允许对数据库中标准对象集合的站点本地修改。例如，如果你把过程语言<span class="application">PL/Perl</span>安装到 <code class="literal">template1</code>中，那么你在创建用户数据库后不需要额外的操作就可以使用该语言。
  </p><p>
   系统里还有名为<code class="literal">template0</code><a id="id-1.6.9.6.3.2" class="indexterm"></a>的第二个标准系统数据库。这个数据库包含和<code class="literal">template1</code>初始内容一样的数据，也就是说，只包含你的<span class="productname">PostgreSQL</span>版本预定义的标准对象。在数据库集簇被初始化之后，不应该对<code class="literal">template0</code>做任何修改。通过指示<code class="command">CREATE DATABASE</code>使用<code class="literal">template0</code>取代<code class="literal">template1</code>进行拷贝，你可以创建一个<span class="quote">“<span class="quote">纯净的</span>”</span>用户数据库，它不会包含任何<code class="literal">template1</code>中的站点本地附加物。 这一点在恢复一个<code class="literal">pg_dump</code>转储时非常方便：转储脚本应该在一个纯净的数据库 中恢复以确保我们重建被转储数据库的正确内容，而不和任何现在可能已经被加入到<code class="literal">template1</code>中的附加物相冲突。
  </p><p>
   另一个从<code class="literal">template0</code>而不是<code class="literal">template1</code>复制的常见原因是， 可以在复制<code class="literal">template0</code>时指定新的编码和区域设置，而一个<code class="literal">template1</code>的副本必须使用和它相同的设置。这是因为的<code class="literal">template1</code>可能包含编码相关或区域相关的数据，而<code class="literal">template0</code>中没有。
  </p><p>
   要通过拷贝<code class="literal">template0</code>来创建一个数据库，使用：SQL 环境中的
</p><pre class="programlisting">
CREATE DATABASE <em class="replaceable"><code>dbname</code></em> TEMPLATE template0;
</pre><p>
   或者 shell 中的
</p><pre class="programlisting">
createdb -T template0 <em class="replaceable"><code>dbname</code></em>
</pre><p>
  </p><p>
   可以创建额外的模板数据库，并且实际上可以通过将集簇中任意数据库指定为<code class="command">CREATE DATABASE</code>的模板来从该数据库拷贝。不过，我们必需明白，这个功能并不是设计作为一般性的<span class="quote">“<span class="quote"><code class="command">COPY DATABASE</code></span>”</span>功能。主要的限制是当源数据库被拷贝时，不能有其他会话连接到它。如果在<code class="command">CREATE DATABASE</code>开始时存在任何其它连接，那么该命令将会失败。在拷贝操作期间，到源数据库的新连接将被阻止。
  </p><p>
   对于每一个数据库在<code class="literal">pg_database</code><a id="id-1.6.9.6.7.2" class="indexterm"></a>中存在两个有用的标志： <code class="literal">datistemplate</code>和<code class="literal">datallowconn</code>列。<code class="literal">datistemplate</code>可以被设置来指示该数据库是不是要作为<code class="command">CREATE DATABASE</code>的模板。如果设置了这个标志，那么该数据库可以被任何有 <code class="literal">CREATEDB</code>权限的用户克隆；如果没有被设置，那么只有超级用户和该数据库的拥有者可以克隆它。如果<code class="literal">datallowconn</code>为假，那么将不允许与该数据库建立任何新的连接（但已有的会话不会因为把该标志设置为假而被中止）。<code class="literal">template0</code>通常被标记为<code class="literal">datallowconn = false</code>来阻止对它的修改。<code class="literal">template0</code>和<code class="literal">template1</code>通常总是被标记为<code class="literal">datistemplate = true</code>。
  </p><div class="note"><h3 class="title">注意</h3><p>
     除了<code class="literal">template1</code>是<code class="command">CREATE DATABASE</code>的默认源数据库名之外， <code class="literal">template1</code>和<code class="literal">template0</code>没有任何特殊的状态。例如，我们可以删除<code class="literal">template1</code>然后从<code class="literal">template0</code>重新创建它而不会有任何不良效果。如果我们不小心在<code class="literal">template1</code>中增加了一堆垃圾，那么我们就会建议做这样的操作（要删除<code class="literal">template1</code>，它必须有<code class="literal">pg_database.datistemplate = false</code>）。
   </p><p>
    当数据库集簇被初始化时，也会创建<code class="literal">postgres</code>数据库。这个数据库用于做为用户和应用连接的默认数据库。它只是 <code class="literal">template1</code>的一个拷贝，需要时可以删除并重建。
   </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="manage-ag-createdb.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="managing-databases.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="manage-ag-config.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">22.2. 创建一个数据库 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 22.4. 数据库配置</td></tr></table></div></body></html>