<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>43.1. 综述</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="plpgsql.html" title="第 43 章 PL/pgSQL - SQL过程语言" /><link rel="next" href="plpgsql-structure.html" title="43.2. PL/pgSQL的结构" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">43.1. 综述</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="plpgsql.html" title="第 43 章 PL/pgSQL - SQL过程语言">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="plpgsql.html" title="第 43 章 PL/pgSQL - SQL过程语言">上一级</a></td><th width="60%" align="center">第 43 章 <span xmlns="http://www.w3.org/1999/xhtml" class="application">PL/pgSQL</span> - <acronym xmlns="http://www.w3.org/1999/xhtml" class="acronym">SQL</acronym>过程语言</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 11.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="plpgsql-structure.html" title="43.2. PL/pgSQL的结构">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="PLPGSQL-OVERVIEW"><div class="titlepage"><div><div><h2 class="title" style="clear: both">43.1. 综述</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="plpgsql-overview.html#PLPGSQL-ADVANTAGES">43.1.1. 使用<span class="application">PL/pgSQL</span>的优点</a></span></dt><dt><span class="sect2"><a href="plpgsql-overview.html#PLPGSQL-ARGS-RESULTS">43.1.2. 支持的参数和结果数据类型</a></span></dt></dl></div><p>
  <span class="application">PL/pgSQL</span>是一种用于<span class="productname">PostgreSQL</span>数据库系统的可载入的过程语言。<span class="application">PL/pgSQL</span>的设计目标是创建一种这样的可载入过程语言

    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       可以被用来创建函数和触发器过程，
      </p></li><li class="listitem"><p>
       对<acronym class="acronym">SQL</acronym>语言增加控制结构，
      </p></li><li class="listitem"><p>
       可以执行复杂计算，
      </p></li><li class="listitem"><p>
       继承所有用户定义类型、函数和操作符，
      </p></li><li class="listitem"><p>
       可以被定义为受服务器信任，
      </p></li><li class="listitem"><p>
       便于使用。
      </p></li></ul></div><p>
   </p><p>
    用<span class="application">PL/pgSQL</span>创建的函数可以被用在任何可以使用内建函数的地方。例如，可以创建复杂条件的计算函数并且后面用它们来定义操作符或把它们用于索引表达式。
   </p><p>
    在<span class="productname">PostgreSQL</span> 9.0 和以后的版本中，<span class="application">PL/pgSQL</span>是默认被安装的。但是它仍然是一种可载入模块，因此特别关注安全性的管理员可以选择移除它。
   </p><div class="sect2" id="PLPGSQL-ADVANTAGES"><div class="titlepage"><div><div><h3 class="title">43.1.1. 使用<span class="application">PL/pgSQL</span>的优点</h3></div></div></div><p>
     <acronym class="acronym">SQL</acronym>被<span class="productname">PostgreSQL</span>和大多数其他关系数据库用作查询语言。它是可移植的并且容易学习。但是每一个<acronym class="acronym">SQL</acronym>语句必须由数据库服务器单独执行。
    </p><p>
     这意味着你的客户端应用必须发送每一个查询到数据库服务器、等待它被处理、接收并处理结果、做一些计算，然后发送更多查询给服务器。如果你的客户端和数据库服务器不在同一台机器上，所有这些会引起进程间通信并且将带来网络负担。
    </p><p>
     通过<span class="application">PL/pgSQL</span>，你可以将一整块计算和一系列查询分组在数据库服务器<span class="emphasis"><em>内部</em></span>，这样就有了一种过程语言的能力并且使 SQL 更易用，但是节省了相当多的客户端/服务器通信开销。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> 客户端和服务器之间的额外往返通信被消除 </p></li><li class="listitem"><p> 客户端不需要的中间结果不必被整理或者在服务器和客户端之间传送 </p></li><li class="listitem"><p> 多轮的查询解析可以被避免 </p></li></ul></div><p> 与不使用存储函数的应用相比，这能够导致可观的性能提升。
    </p><p>
     还有，通过<span class="application">PL/pgSQL</span>你可以使用 SQL 中所有的数据类型、操作符和函数。
    </p></div><div class="sect2" id="PLPGSQL-ARGS-RESULTS"><div class="titlepage"><div><div><h3 class="title">43.1.2. 支持的参数和结果数据类型</h3></div></div></div><p>
     <span class="application">PL/pgSQL</span>编写的函数可以接受服务器支持的任何标量或数组数据类型作为参数，并且它们能够返回任何这些类型的结果。它们也能接受或返回任何用名称指定的组合类型（行类型）。还可以声明一个<span class="application">PL/pgSQL</span>函数为接受<code class="type">record</code>，这表示任意组合类型都将作为输入，或者声明为返回<code class="type">record</code>，表示结果是一种行类型，它的列由调用查询中的说明确定（如<a class="xref" href="queries-table-expressions.html#QUERIES-TABLEFUNCTIONS" title="7.2.1.4. 表函数">第 7.2.1.4 节</a>中所讨论）。
    </p><p>
     <span class="application">PL/pgSQL</span>函数可以通过使用<code class="literal">VARIADIC</code>标记被声明为接受数量不定的参数。如<a class="xref" href="xfunc-sql.html#XFUNC-SQL-VARIADIC-FUNCTIONS" title="38.5.5. 带有可变数量参数的SQL函数">第 38.5.5 节</a>中所讨论的，它的工作方式和 SQL 函数一样。
    </p><p>
     <span class="application">PL/pgSQL</span>函数也可以被声明为接受并返回多态类型<code class="type">anyelement</code>、<code class="type">anyarray</code>、<code class="type">anynonarray</code>、<code class="type">anyenum</code>以及<code class="type">anyrange</code>。如<a class="xref" href="extend-type-system.html#EXTEND-TYPES-POLYMORPHIC" title="38.2.5. 多态类型">第 38.2.5 节</a>中所讨论的，由一个多态函数处理的实际数据类型会随着调用改变。在<a class="xref" href="plpgsql-declarations.html#PLPGSQL-DECLARATION-PARAMETERS" title="43.3.1. 声明函数参数">第 43.3.1 节</a>中展示了一个例子。
    </p><p>
     <span class="application">PL/pgSQL</span>函数还能够被声明为返回一个任意（可作为一个单一实例返回的）数据类型的<span class="quote">“<span class="quote">集合</span>”</span>（或表）。这样的一个函数通过为结果集的每个期望元素执行<code class="command">RETURN NEXT</code>来产生输出，或者通过使用<code class="command">RETURN QUERY</code>来输出一个查询计算的结果。
    </p><p>
     最后，如果一个<span class="application">PL/pgSQL</span>函数没有可用的返回值，它可以被声明为返回<code class="type">void</code>（另外一种选择是，在那种情况下它可以被写作一个过程）。
    </p><p>
     <span class="application">PL/pgSQL</span>函数也能够被声明为用输出参数代替返回类型的一个显式说明。这没有为该语言增加任何基础功能，但是它常常很方便，特别是对于要返回多个值的情况。<code class="literal">RETURNS TABLE</code>符号也可以被用来替代<code class="literal">RETURNS SETOF</code>。
    </p><p>
     在<a class="xref" href="plpgsql-declarations.html#PLPGSQL-DECLARATION-PARAMETERS" title="43.3.1. 声明函数参数">第 43.3.1 节</a>和<a class="xref" href="plpgsql-control-structures.html#PLPGSQL-STATEMENTS-RETURNING" title="43.6.1. 从一个函数返回">第 43.6.1 节</a>中有详细的例子。
    </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="plpgsql.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="plpgsql.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="plpgsql-structure.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">第 43 章 <span class="application">PL/pgSQL</span> - <acronym class="acronym">SQL</acronym>过程语言 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 43.2. <span class="application">PL/pgSQL</span>的结构</td></tr></table></div></body></html>