<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>28.4. 进度报告</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="monitoring-locks.html" title="28.3. 查看锁" /><link rel="next" href="dynamic-trace.html" title="28.5. 动态追踪" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">28.4. 进度报告</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="monitoring-locks.html" title="28.3. 查看锁">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="monitoring.html" title="第 28 章 监控数据库活动">上一级</a></td><th width="60%" align="center">第 28 章 监控数据库活动</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 11.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="dynamic-trace.html" title="28.5. 动态追踪">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="PROGRESS-REPORTING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">28.4. 进度报告</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="progress-reporting.html#VACUUM-PROGRESS-REPORTING">28.4.1. VACUUM进度报告</a></span></dt></dl></div><p>
   <span class="productname">PostgreSQL</span>有能力在命令执行期间报告特定命令的进度。当前，唯一一种支持进度报告的命令是<code class="command">VACUUM</code>。这在未来可能会被扩充。
  </p><div class="sect2" id="VACUUM-PROGRESS-REPORTING"><div class="titlepage"><div><div><h3 class="title">28.4.1. VACUUM进度报告</h3></div></div></div><p>
   只要<code class="command">VACUUM</code>正在运行，每一个当前正在清理的后端（包括autovacuum工作者进程）在<code class="structname">pg_stat_progress_vacuum</code>视图中都会有一行。下面的表描述了将被报告的信息并且提供了如何解释它们的信息。进度报告当前不支持<code class="command">VACUUM FULL</code>，运行着<code class="command">VACUUM FULL</code>的后端将不会在这个视图中列出。
  </p><div class="table" id="PG-STAT-PROGRESS-VACUUM-VIEW"><p class="title"><strong>表 28.21. <code class="structname">pg_stat_progress_vacuum</code>视图</strong></p><div class="table-contents"><table class="table" summary="pg_stat_progress_vacuum视图" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>列</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td><code class="structfield">pid</code></td><td><code class="type">integer</code></td><td>后端的进程ID。</td></tr><tr><td><code class="structfield">datid</code></td><td><code class="type">oid</code></td><td>这个后端连接的数据库的OID。</td></tr><tr><td><code class="structfield">datname</code></td><td><code class="type">name</code></td><td>这个后端连接的数据库的名称。</td></tr><tr><td><code class="structfield">relid</code></td><td><code class="type">oid</code></td><td>被vacuum的表的OID。</td></tr><tr><td><code class="structfield">phase</code></td><td><code class="type">text</code></td><td>
       vacuum的当前处理阶段。请参考<a class="xref" href="progress-reporting.html#VACUUM-PHASES" title="表 28.22. VACUUM的阶段">表 28.22</a>。
     </td></tr><tr><td><code class="structfield">heap_blks_total</code></td><td><code class="type">bigint</code></td><td>
       该表中堆块的总数。这个数字在扫描开始时报告，之后增加的块将不会（并且不需要）被这个<code class="command">VACUUM</code>访问。
     </td></tr><tr><td><code class="structfield">heap_blks_scanned</code></td><td><code class="type">bigint</code></td><td>
       被扫描的堆块数量。由于<a class="link" href="storage-vm.html" title="68.4. 可见性映射">可见性映射</a>被用来优化扫描，一些块将被跳过而不做检查，被跳过的块会被包括在这个总数中，因此当清理完成时这个数字最终将会等于<code class="structfield">heap_blks_total</code>。仅当处于<code class="literal">扫描堆</code>阶段时这个计数器才会前进。
     </td></tr><tr><td><code class="structfield">heap_blks_vacuumed</code></td><td><code class="type">bigint</code></td><td>
       被清理的堆块数量。除非表没有索引，这个计数器仅在处于<code class="literal">清理堆</code>阶段时才会前进。不包含死亡元组的块会被跳过，因此这个计数器可能有时会向前跳跃一个比较大的增量。
     </td></tr><tr><td><code class="structfield">index_vacuum_count</code></td><td><code class="type">bigint</code></td><td>
       已完成的索引清理周期数。
     </td></tr><tr><td><code class="structfield">max_dead_tuples</code></td><td><code class="type">bigint</code></td><td>
      在需要执行一个索引清理周期之前我们可以存储的死亡元组数，取决于<a class="xref" href="runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM">maintenance_work_mem</a>。
     </td></tr><tr><td><code class="structfield">num_dead_tuples</code></td><td><code class="type">bigint</code></td><td>
       从上一个索引清理周期以来收集的死亡元组数。
     </td></tr></tbody></table></div></div><br class="table-break" /><div class="table" id="VACUUM-PHASES"><p class="title"><strong>表 28.22. VACUUM的阶段</strong></p><div class="table-contents"><table class="table" summary="VACUUM的阶段" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>阶段</th><th>描述</th></tr></thead><tbody><tr><td><code class="literal">初始化</code></td><td>
       <code class="command">VACUUM</code>正在准备开始扫描堆。这个阶段应该很简短。
     </td></tr><tr><td><code class="literal">扫描堆</code></td><td>
       <code class="command">VACUUM</code>正在扫描堆。如果需要，它将会对每个页面进行修建以及碎片整理，并且可能会执行冻结动作。<code class="structfield">heap_blks_scanned</code>列可以用来监控扫描的进度。
     </td></tr><tr><td><code class="literal">清理索引</code></td><td>
       <code class="command">VACUUM</code>当前正在清理索引。如果一个表拥有索引，那么每次清理时这个阶段会在堆扫描完成后至少发生一次。如果<a class="xref" href="runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM">maintenance_work_mem</a>不足以存放找到的死亡元组，则每次清理时会多次清理索引。
     </td></tr><tr><td><code class="literal">清理堆</code></td><td>
       <code class="command">VACUUM</code>当前正在清理堆。清理堆与扫描堆不是同一个概念，清理堆发生在每一次清理索引的实例之后。如果<code class="structfield">heap_blks_scanned</code>小于<code class="structfield">heap_blks_total</code>，系统将在这个阶段完成之后回去扫描堆；否则，系统将在这个阶段完成后开始清理索引。
     </td></tr><tr><td><code class="literal">清除索引</code></td><td>
       <code class="command">VACUUM</code>当前正在清除索引。这个阶段发生在堆被完全扫描并且对堆和索引的所有清理都已经完成以后。
     </td></tr><tr><td><code class="literal">截断堆</code></td><td>
       <code class="command">VACUUM</code>正在截断堆，以便把关系尾部的空页面返还给操作系统。这个阶段发生在清除完索引之后。
     </td></tr><tr><td><code class="literal">执行最后的清除</code></td><td>
       <code class="command">VACUUM</code>在执行最终的清除。在这个阶段中，<code class="command">VACUUM</code>将清理空闲空间映射、更新<code class="literal">pg_class</code>中的统计信息并且将统计信息报告给统计收集器。当这个阶段完成时，<code class="command">VACUUM</code>也就结束了。
     </td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="monitoring-locks.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="monitoring.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="dynamic-trace.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">28.3. 查看锁 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 28.5. 动态追踪</td></tr></table></div></body></html>