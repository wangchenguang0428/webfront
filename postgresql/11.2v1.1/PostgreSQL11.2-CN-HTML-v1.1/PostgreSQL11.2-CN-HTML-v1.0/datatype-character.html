<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>8.3. 字符类型</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="datatype-money.html" title="8.2. 货币类型" /><link rel="next" href="datatype-binary.html" title="8.4. 二进制数据类型" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">8.3. 字符类型</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="datatype-money.html" title="8.2. 货币类型">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="datatype.html" title="第 8 章 数据类型">上一级</a></td><th width="60%" align="center">第 8 章 数据类型</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 11.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="datatype-binary.html" title="8.4. 二进制数据类型">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="DATATYPE-CHARACTER"><div class="titlepage"><div><div><h2 class="title" style="clear: both">8.3. 字符类型</h2></div></div></div><a id="id-1.5.7.11.2" class="indexterm"></a><a id="id-1.5.7.11.3" class="indexterm"></a><a id="id-1.5.7.11.4" class="indexterm"></a><a id="id-1.5.7.11.5" class="indexterm"></a><a id="id-1.5.7.11.6" class="indexterm"></a><a id="id-1.5.7.11.7" class="indexterm"></a><a id="id-1.5.7.11.8" class="indexterm"></a><div class="table" id="DATATYPE-CHARACTER-TABLE"><p class="title"><strong>表 8.4. 字符类型</strong></p><div class="table-contents"><table class="table" summary="字符类型" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>名字</th><th>描述</th></tr></thead><tbody><tr><td><code class="type">character varying(<em class="replaceable"><code>n</code></em>)</code>, <code class="type">varchar(<em class="replaceable"><code>n</code></em>)</code></td><td>有限制的变长</td></tr><tr><td><code class="type">character(<em class="replaceable"><code>n</code></em>)</code>, <code class="type">char(<em class="replaceable"><code>n</code></em>)</code></td><td>定长，空格填充</td></tr><tr><td><code class="type">text</code></td><td>无限变长</td></tr></tbody></table></div></div><br class="table-break" /><p>
    <a class="xref" href="datatype-character.html#DATATYPE-CHARACTER-TABLE" title="表 8.4. 字符类型">表 8.4</a>显示了在<span class="productname">PostgreSQL</span>里可用的一般用途的字符类型。
   </p><p>
    <acronym class="acronym">SQL</acronym>定义了两种基本的字符类型： <code class="type">character varying(<em class="replaceable"><code>n</code></em>)</code>和<code class="type">character(<em class="replaceable"><code>n</code></em>)</code>， 其中<em class="replaceable"><code>n</code></em>是一个正整数。两种类型都可以存储最多<em class="replaceable"><code>n</code></em>个字符长的串。试图存储更长的串到这些类型的列里会产生一个错误， 除非超出长度的字符都是空白，这种情况下该串将被截断为最大长度（这个看上去有点怪异的例外是<acronym class="acronym">SQL</acronym>标准要求的）。 如果要存储的串比声明的长度短，类型为<code class="type">character</code>的值将会用空白填满；而类型为<code class="type">character varying</code>的值将只是存储短些的串。
   </p><p>
    如果我们明确地把一个值造型成<code class="type">character varying(<em class="replaceable"><code>n</code></em>)</code>或者<code class="type">character(<em class="replaceable"><code>n</code></em>)</code>， 那么超长的值将被截断成<em class="replaceable"><code>n</code></em>个字符，而不会抛出错误（这也是<acronym class="acronym">SQL</acronym>标准的要求）。
   </p><p>
    <code class="type">varchar(<em class="replaceable"><code>n</code></em>)</code>和<code class="type">char(<em class="replaceable"><code>n</code></em>)</code>的概念分别是<code class="type">character varying(<em class="replaceable"><code>n</code></em>)</code>和<code class="type">character(<em class="replaceable"><code>n</code></em>)</code>的别名。没有长度声明词的<code class="type">character</code>等效于<code class="type">character(1)</code>。如果不带长度说明词使用<code class="type">character varying</code>，那么该类型接受任何长度的串。后者是一个<span class="productname">PostgreSQL</span>的扩展。
   </p><p>
    另外，<span class="productname">PostgreSQL</span>提供<code class="type">text</code>类型，它可以存储任何长度的串。尽管类型<code class="type">text</code>不是<acronym class="acronym">SQL</acronym>标准，但是许多其它 SQL 数据库系统也有它。
   </p><p>
    类型<code class="type">character</code>的值物理上都用空白填充到指定的长度<em class="replaceable"><code>n</code></em>， 并且以这种方式存储和显示。不过，拖尾的空白被当作是没有意义的，并且在比较两个
    <code class="type">character</code>类型值时不会考虑它们。在空白有意义的排序规则中，这种行为可能会
    产生意料之外的结果，例如<code class="command">SELECT 'a '::CHAR(2) collate "C" &lt;
    E'a\n'::CHAR(2)</code>会返回真（即便<code class="literal">C</code>区域会认为一个空格比新行更大）。当把一个<code class="type">character</code>值转换成其他
    字符串类型之一时，拖尾的空白会被移除。请注意，在<code class="type">character varying</code>和<code class="type">text</code>值里， 结尾的空白语意上<span class="emphasis"><em>是</em></span>有含义的，并且在使用模式匹配（如<code class="literal">LIKE</code>和正则表达式）时也会被考虑。
   </p><p>
    这些类型的存储需求是 4 字节加上实际的字串，如果是 character 的话再加上填充的字节。长的字串将会自动被系统压缩， 因此在磁盘上的物理需求可能会更少些。长的数值也会存储在后台表里面，这样它们就不会干扰对短字段值的快速访问。 不管怎样，允许存储的最长字串大概是 1 GB。 （允许在数据类型声明中出现的的 n 的最大值比这还小。 修改这个行为没有甚么意义，因为在多字节编码下字符和字节的数目可能差别很大。 如果你想存储没有特定上限的长字串，那么使用 text 或者没有长度声明词的 character varying， 而不要选择一个任意长度限制。）
    一个短串（最长126字节）的存储要求是1个字节外加实际的串，该串在<code class="type">character</code>情况下包含填充的空白。长一些的串在前面需要4个字节而不是1个字节。长串会被系统自动压缩，这样在磁盘上的物理需求可能会更少。非常长的值也会被存储在背景表中，这样它们不会干扰对较短的列值的快速访问。在任何情况下，能被存储的最长的字符串是1GB（数据类型定义中<em class="replaceable"><code>n</code></em>能允许的最大值比这个值要小。修改它没有用处，因为对于多字节字符编码来说，字符的数量和字节数可能完全不同。如果你想要存储没有指定上限的长串，使用<code class="type">text</code>或没有长度声明的<code class="type">character varying</code>，而不是给出一个任意长度限制）。
   </p><div class="tip"><h3 class="title">提示</h3><p>
     这三种类型之间没有性能差别，只不过是在使用填充空白的类型的时候需要更多存储尺寸，以及在存储到一个有长度约束的列时需要少量额外CPU周期来检查长度。虽然在某些其它的数据库系统里，<code class="type">character(<em class="replaceable"><code>n</code></em>)</code>有一定的性能优势，但在<span class="productname">PostgreSQL</span>里没有。事实上，<code class="type">character(<em class="replaceable"><code>n</code></em>)</code>通常是这三种类型之中最慢的一个，因为它需要额外的存储开销。在大多数情况下，应该使用<code class="type">text</code>或者<code class="type">character varying</code>。
    </p></div><p>
    请参考<a class="xref" href="sql-syntax-lexical.html#SQL-SYNTAX-STRINGS" title="4.1.2.1. 字符串常量">第 4.1.2.1 节</a>获取关于串文本的语法的信息，以及参阅<a class="xref" href="functions.html" title="第 9 章 函数和操作符">第 9 章</a>获取关于可用操作符和函数的信息。 数据库的字符集决定用于存储文本值的字符集；有关字符集支持的更多信息，请参考<a class="xref" href="multibyte.html" title="23.3. 字符集支持">第 23.3 节</a>。
   </p><div class="example" id="id-1.5.7.11.19"><p class="title"><strong>例 8.1. 使用字符类型</strong></p><div class="example-contents"><pre class="programlisting">
CREATE TABLE test1 (a character(4));
INSERT INTO test1 VALUES ('ok');
SELECT a, char_length(a) FROM test1; -- <span id="co.datatype-char"></span>(1)
<code class="computeroutput">
  a   | char_length
------+-------------
 ok   |           2
</code>

CREATE TABLE test2 (b varchar(5));
INSERT INTO test2 VALUES ('ok');
INSERT INTO test2 VALUES ('good      ');
INSERT INTO test2 VALUES ('too long');
<code class="computeroutput">ERROR:  value too long for type character varying(5)</code>
INSERT INTO test2 VALUES ('too long'::varchar(5)); -- explicit truncation
SELECT b, char_length(b) FROM test2;
<code class="computeroutput">
   b   | char_length
-------+-------------
 ok    |           2
 good  |           5
 too l |           5
</code>
</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co.datatype-char">(1)</a> </p></td><td valign="top" align="left"><p>
       函数<code class="function">char_length</code>在<a class="xref" href="functions-string.html" title="9.4. 字符串函数和操作符">第 9.4 节</a>中讨论。
      </p></td></tr></table></div></div></div><br class="example-break" /><p>
    在<span class="productname">PostgreSQL</span>里另外还有两种定长字符类型，在<a class="xref" href="datatype-character.html#DATATYPE-CHARACTER-SPECIAL-TABLE" title="表 8.5. 特殊字符类型">表 8.5</a>里显示。 <code class="type">name</code>类型<span class="emphasis"><em>只</em></span>用于在内部系统目录中存储标识符并且不是给一般用户使用的。该类型长度当前定为 64 字节（63 可用字符加结束符）但在<code class="literal">C</code>源代码应该使用常量 <code class="symbol">NAMEDATALEN</code>引用。这个长度是在编译的时候设置的（因而可以为特殊用途调整），缺省的最大长度在以后的版本可能会改变。类型<code class="type">"char"</code>（注意引号）和 <code class="type">char(1)</code>是不一样的，它只用了一个字节的存储空间。它在系统内部用于系统目录当做简化的枚举类型用。
   </p><div class="table" id="DATATYPE-CHARACTER-SPECIAL-TABLE"><p class="title"><strong>表 8.5. 特殊字符类型</strong></p><div class="table-contents"><table class="table" summary="特殊字符类型" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名字</th><th>存储尺寸</th><th>描述</th></tr></thead><tbody><tr><td><code class="type">"char"</code></td><td>1字节</td><td>单字节内部类型</td></tr><tr><td><code class="type">name</code></td><td>64字节</td><td>用于对象名的内部类型</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="datatype-money.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="datatype.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="datatype-binary.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">8.2. 货币类型 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 8.4. 二进制数据类型</td></tr></table></div></body></html>