<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>66.4. 实现</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="gin-extensibility.html" title="66.3. 可扩展性" /><link rel="next" href="gin-tips.html" title="66.5. GIN 提示和技巧" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">66.4. 实现</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="gin-extensibility.html" title="66.3. 可扩展性">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="gin.html" title="第 66 章 GIN 索引">上一级</a></td><th width="60%" align="center">第 66 章 GIN 索引</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 11.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="gin-tips.html" title="66.5. GIN 提示和技巧">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="GIN-IMPLEMENTATION"><div class="titlepage"><div><div><h2 class="title" style="clear: both">66.4. 实现</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="gin-implementation.html#GIN-FAST-UPDATE">66.4.1. GIN 快速更新技术</a></span></dt><dt><span class="sect2"><a href="gin-implementation.html#GIN-PARTIAL-MATCH">66.4.2. 部分匹配算法</a></span></dt></dl></div><p>
  在内部，一个<acronym class="acronym">GIN</acronym>索引包含一个在键上构建的 B 树索引，其中每一个键是一个或者多个被索引项的一个元素（例如，数组的一个成员），并且叶子页中的每一个元组包含一个指向堆指针 B 树的指针（一个<span class="quote">“<span class="quote">位置树</span>”</span>）或者一个堆指针的简单列表（<span class="quote">“<span class="quote">位置列表</span>”</span>），只有位置列表小到能够和键值一起放入索引时才使用后一种形式。
 </p><p>
  自<span class="productname">PostgreSQL</span> 9.1 起，空键值可以被包括在索引中。同样，用于为空或者根据<code class="function">extractValue</code>不包含键的被索引项的占位符空值也被包括在索引中。这允许实现应该找到空项的搜索。
 </p><p>
  多列<acronym class="acronym">GIN</acronym>索引可以通过在组合值（列号，键值）上建立一个单一 B 树实现。不同列的键值可以是不同类型。
 </p><div class="sect2" id="GIN-FAST-UPDATE"><div class="titlepage"><div><div><h3 class="title">66.4.1. GIN 快速更新技术</h3></div></div></div><p>
   更新一个<acronym class="acronym">GIN</acronym>索引可能会比较慢，这是因为倒排索引的天然特性造成的：
   对一个堆行的插入或更新可能导致对索引的很多次插入（每一次插入用于从被索引项中抽取的一个键）。
   从<span class="productname">PostgreSQL</span> 8.4 开始，<acronym class="acronym">GIN</acronym>可以通过将新元组插入到一个临时的未排序的待处理条目列表中来推迟很多这种工作。
   当表被清理、自动分析、<code class="function">gin_clean_pending_list</code>函数被调用
   或者待处理列表变得大于<a class="xref" href="runtime-config-client.html#GUC-GIN-PENDING-LIST-LIMIT">gin_pending_list_limit</a>时，
   这些条目被使用初始索引创建时使用的批量插入技术移动到主<acronym class="acronym">GIN</acronym>数据结构中。
   这大幅度提高了<acronym class="acronym">GIN</acronym>索引的更新速度，虽然带了一些额外的清理负荷。
   此外，这些开销可以通过用一个后台进程来取代一个前台进程执行。
  </p><p>
   这种方式的主要缺点是搜索必须在搜索普通索引之外扫描待处理条目的列表，并且因此一个大型的待处理条目列表会显著地拖慢搜索。另一个缺点是，虽然大部分更新变快了，一次导致待处理列表变得<span class="quote">“<span class="quote">太大</span>”</span>的更新将导致一次立即清理循环并且因此会比其他更新慢很多。正确使用自动清理可以把这些问题的影响变得最小。
  </p><p>
   如果一致的响应时间比更新速度更重要，可以通过为一个<acronym class="acronym">GIN</acronym>关闭<code class="literal">fastupdate</code>存储参数来禁用对待处理条目的使用。详见<a class="xref" href="sql-createindex.html" title="CREATE INDEX"><span class="refentrytitle">CREATE INDEX</span></a>。
  </p></div><div class="sect2" id="GIN-PARTIAL-MATCH"><div class="titlepage"><div><div><h3 class="title">66.4.2. 部分匹配算法</h3></div></div></div><p>
   GIN 可以支持<span class="quote">“<span class="quote">部分匹配</span>”</span>查询，在其中查询不能判断一个或多个键的精确匹配，但是可以确定落在键值（在<code class="function">compare</code>支持方法决定的键排序顺序中）的一个合理的狭窄范围内的可能匹配。<code class="function">extractQuery</code>方法，不会返回一个要被精确匹配的键值，而是返回一个作为要被搜索范围下界的键值，并且将<code class="literal">pmatch</code>标志设置为真。然后键范围将被使用<code class="function">comparePartial</code>方法扫描。<code class="function">comparePartial</code>必须对于一个匹配的索引键返回零，对一个不匹配但仍在要被搜索的范围内的返回小于零，对于超过被搜索范围的索引键返回大于零。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="gin-extensibility.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="gin.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="gin-tips.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">66.3. 可扩展性 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 66.5. GIN 提示和技巧</td></tr></table></div></body></html>