<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.9. cube</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="citext.html" title="F.8. citext" /><link rel="next" href="dblink.html" title="F.10. dblink" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.9. cube</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="citext.html" title="F.8. citext">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="附录 F. 额外提供的模块">上一级</a></td><th width="60%" align="center">附录 F. 额外提供的模块</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 11.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="dblink.html" title="F.10. dblink">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="CUBE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.9. cube</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="cube.html#id-1.11.7.18.4">F.9.1. 语法</a></span></dt><dt><span class="sect2"><a href="cube.html#id-1.11.7.18.5">F.9.2. 精度</a></span></dt><dt><span class="sect2"><a href="cube.html#id-1.11.7.18.6">F.9.3. 用法</a></span></dt><dt><span class="sect2"><a href="cube.html#id-1.11.7.18.7">F.9.4. 默认值</a></span></dt><dt><span class="sect2"><a href="cube.html#id-1.11.7.18.8">F.9.5. 注解</a></span></dt><dt><span class="sect2"><a href="cube.html#id-1.11.7.18.9">F.9.6. 工作人员</a></span></dt></dl></div><a id="id-1.11.7.18.2" class="indexterm"></a><p>
  这个模块实现了一种数据类型<code class="type">cube</code>来表示多维立方体。
 </p><div class="sect2" id="id-1.11.7.18.4"><div class="titlepage"><div><div><h3 class="title">F.9.1. 语法</h3></div></div></div><p>
   <a class="xref" href="cube.html#CUBE-REPR-TABLE" title="表 F.2. 立方体外部表示">表 F.2</a>展示了<code class="type">cube</code>类型有效的外部表示。<em class="replaceable"><code>x</code></em>、<em class="replaceable"><code>y</code></em>等表示浮点数。
  </p><div class="table" id="CUBE-REPR-TABLE"><p class="title"><strong>表 F.2. 立方体外部表示</strong></p><div class="table-contents"><table class="table" summary="立方体外部表示" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>外部语法</th><th>含义</th></tr></thead><tbody><tr><td><code class="literal"><em class="replaceable"><code>x</code></em></code></td><td>一个一维点（或者长度为零的一维区间）
      </td></tr><tr><td><code class="literal">(<em class="replaceable"><code>x</code></em>)</code></td><td>同上</td></tr><tr><td><code class="literal"><em class="replaceable"><code>x1</code></em>,<em class="replaceable"><code>x2</code></em>,...,<em class="replaceable"><code>xn</code></em></code></td><td>n-维空间中的一个点，内部表示为一个零容积立方体
      </td></tr><tr><td><code class="literal">(<em class="replaceable"><code>x1</code></em>,<em class="replaceable"><code>x2</code></em>,...,<em class="replaceable"><code>xn</code></em>)</code></td><td>同上</td></tr><tr><td><code class="literal">(<em class="replaceable"><code>x</code></em>),(<em class="replaceable"><code>y</code></em>)</code></td><td>开始于<em class="replaceable"><code>x</code></em>并且结束于<em class="replaceable"><code>y</code></em>的一个一维区间，反之亦然。顺序并不重要
      </td></tr><tr><td><code class="literal">[(<em class="replaceable"><code>x</code></em>),(<em class="replaceable"><code>y</code></em>)]</code></td><td>同上</td></tr><tr><td><code class="literal">(<em class="replaceable"><code>x1</code></em>,...,<em class="replaceable"><code>xn</code></em>),(<em class="replaceable"><code>y1</code></em>,...,<em class="replaceable"><code>yn</code></em>)</code></td><td>一个 n-维立方体，用它的对角顶点对表示
      </td></tr><tr><td><code class="literal">[(<em class="replaceable"><code>x1</code></em>,...,<em class="replaceable"><code>xn</code></em>),(<em class="replaceable"><code>y1</code></em>,...,<em class="replaceable"><code>yn</code></em>)]</code></td><td>同上</td></tr></tbody></table></div></div><br class="table-break" /><p>
   一个立方体的对角录入的顺序无关紧要。如果需要创建一种统一的<span class="quote">“<span class="quote">左下 — 右上</span>”</span>的内部表示，<code class="type">cube</code>函数会自动地交换值。当角重合时，<code class="type">cube</code>只存储一个角和一个<span class="quote">“<span class="quote">is point</span>”</span>标志，这样避免浪费空间。
  </p><p>
   输入中的空白空间会被忽略，因此<code class="literal">[(<em class="replaceable"><code>x</code></em>),(<em class="replaceable"><code>y</code></em>)]</code>与<code class="literal">[ ( <em class="replaceable"><code>x</code></em> ), ( <em class="replaceable"><code>y</code></em> ) ]</code>相同。
  </p></div><div class="sect2" id="id-1.11.7.18.5"><div class="titlepage"><div><div><h3 class="title">F.9.2. 精度</h3></div></div></div><p>
   值在内部被存储为 64 位浮点数。这意味着超过 16 位有效位的数字将被截断。
  </p></div><div class="sect2" id="id-1.11.7.18.6"><div class="titlepage"><div><div><h3 class="title">F.9.3. 用法</h3></div></div></div><p>
   <a class="xref" href="cube.html#CUBE-OPERATORS-TABLE" title="表 F.3. 立方体操作符">表 F.3</a>展示了为类型<code class="type">cube</code>提供的操作符。
  </p><div class="table" id="CUBE-OPERATORS-TABLE"><p class="title"><strong>表 F.3. 立方体操作符</strong></p><div class="table-contents"><table class="table" summary="立方体操作符" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>操作符</th><th>结果</th><th>描述</th></tr></thead><tbody><tr><td><code class="literal">a = b</code></td><td><code class="type">boolean</code></td><td>立方体 a 和 b 相同。</td></tr><tr><td><code class="literal">a &amp;&amp; b</code></td><td><code class="type">boolean</code></td><td>立方体 a 和 b 重叠。</td></tr><tr><td><code class="literal">a @&gt; b</code></td><td><code class="type">boolean</code></td><td>立方体 a 包含 立方体 b。</td></tr><tr><td><code class="literal">a &lt;@ b</code></td><td><code class="type">boolean</code></td><td>立方体 a 被包含在立方体 b 中。</td></tr><tr><td><code class="literal">a &lt; b</code></td><td><code class="type">boolean</code></td><td>立方体 a 小于立方体 b。</td></tr><tr><td><code class="literal">a &lt;= b</code></td><td><code class="type">boolean</code></td><td>立方体 a 小于或者等于立方体 b。</td></tr><tr><td><code class="literal">a &gt; b</code></td><td><code class="type">boolean</code></td><td>立方体 a 大于立方体 b。</td></tr><tr><td><code class="literal">a &gt;= b</code></td><td><code class="type">boolean</code></td><td>立方体 a 大于或者等于立方体 b。</td></tr><tr><td><code class="literal">a &lt;&gt; b</code></td><td><code class="type">boolean</code></td><td>立方体 a 不等于立方体 b。</td></tr><tr><td><code class="literal">a -&gt; n</code></td><td><code class="type">float8</code></td><td>得到立方体的第<em class="replaceable"><code>n</code></em>个坐标（从 1 开始数）。</td></tr><tr><td><code class="literal">a ~&gt; n</code></td><td><code class="type">float8</code></td><td>
        以下列方式获取多维数据集的第<em class="replaceable"><code>n</code></em>个坐标：
         n = 2 * k  -  1表示第<em class="replaceable"><code>k</code></em>维度的下限，
         n = 2 * k表示第<em class="replaceable"><code>k</code></em>维度的上限。 
         负的<em class="replaceable"><code>n</code></em>表示相应正坐标的倒数值。此运算符专为KNN-GiST支持而设计。
      </td></tr><tr><td><code class="literal">a &lt;-&gt; b</code></td><td><code class="type">float8</code></td><td>a 和 b 之间的欧氏距离。</td></tr><tr><td><code class="literal">a &lt;#&gt; b</code></td><td><code class="type">float8</code></td><td>a 和 b 之间的直线距离（taxicab 距离，L1 度量）。</td></tr><tr><td><code class="literal">a &lt;=&gt; b</code></td><td><code class="type">float8</code></td><td>a 和 b 之间的切比雪夫（L-inf 度量）距离。</td></tr></tbody></table></div></div><br class="table-break" /><p>
   （在 PostgreSQL 8.2 之前，包含操作符<code class="literal">@&gt;</code>和<code class="literal">&lt;@</code>分别被称为<code class="literal">@</code>和<code class="literal">~</code>。这些名称仍然可用，但是已经被废弃并且最终将会退休。注意旧的名字与之前核心几何数据类型遵循的习惯相反！）
  </p><p>
   标量排序操作符（<code class="literal">&lt;</code>、<code class="literal">&gt;=</code>等）除了用来排序之外没有什么实际用途。这些操作符首先比较第一个坐标，如果它们相等再比较第二个坐标等等。它们主要为支持<code class="type">cube</code>的 b-树索引操作符类而存在，这类操作符对支持<code class="type">cube</code>列上的 UNIQUE 约束等很有用。
  </p><p>
   <code class="filename">cube</code>模块也为<code class="type">cube</code>值提供了一个 GiST 索引操作符类。<code class="type">cube</code> GiST 索引可以被用于在<code class="literal">WHERE</code>子句中通过<code class="literal">=</code>、<code class="literal">&amp;&amp;</code>、<code class="literal">@&gt;</code>以及<code class="literal">&lt;@</code>操作符来搜索值。
  </p><p>
   此外，<code class="type">cube</code> GiST 索引可以被用在<code class="literal">ORDER BY</code>子句中通过度量操作符<code class="literal">&lt;-&gt;</code>、<code class="literal">&lt;#&gt;</code>和<code class="literal">&lt;=&gt;</code>来查找最近邻。例如， 3-D 点(0.5, 0.5, 0.5)的最近邻可以用下面的查询很快地找到：
</p><pre class="programlisting">
SELECT c FROM test ORDER BY c &lt;-&gt; cube(array[0.5,0.5,0.5]) LIMIT 1;
</pre><p>
  </p><p>
   也可以用这种方式使用<code class="literal">~&gt;</code>操作符来高效地检索通过选定坐标排序后的前几个值。例如，可以用下面的查询得到通过第一个坐标（左下角）升序排列后的前几个立方体：
</p><pre class="programlisting">
SELECT c FROM test ORDER BY c ~&gt; 1 LIMIT 5;
</pre><p>
   以及得到通过右上角第一个坐标降序排列后的 2-D 立方体：
</p><pre class="programlisting">
SELECT c FROM test ORDER BY c ~&gt; 3 DESC LIMIT 5;
</pre><p>
  </p><p>
   <a class="xref" href="cube.html#CUBE-FUNCTIONS-TABLE" title="表 F.4. 立方体函数">表 F.4</a>展示了可用的函数。
  </p><div class="table" id="CUBE-FUNCTIONS-TABLE"><p class="title"><strong>表 F.4. 立方体函数</strong></p><div class="table-contents"><table class="table" summary="立方体函数" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>函数</th><th>结果</th><th>描述</th><th>例子</th></tr></thead><tbody><tr><td><code class="literal">cube(float8)</code></td><td><code class="type">cube</code></td><td>制造一个一维立方体，坐标都是相同的。
      </td><td>
       <code class="literal">cube(1) == '(1)'</code>
      </td></tr><tr><td><code class="literal">cube(float8, float8)</code></td><td><code class="type">cube</code></td><td>制造一个一维立方体。
      </td><td>
       <code class="literal">cube(1,2) == '(1),(2)'</code>
      </td></tr><tr><td><code class="literal">cube(float8[])</code></td><td><code class="type">cube</code></td><td>使用数组定义的坐标制造一个零容积的立方体。
      </td><td>
       <code class="literal">cube(ARRAY[1,2]) == '(1,2)'</code>
      </td></tr><tr><td><code class="literal">cube(float8[], float8[])</code></td><td><code class="type">cube</code></td><td>用由两个数组定义的右上和左下坐标制造一个立方体，两个数组必须等长。
      </td><td>
       <code class="literal">cube(ARRAY[1,2], ARRAY[3,4]) == '(1,2),(3,4)'
       </code>
      </td></tr><tr><td><code class="literal">cube(cube, float8)</code></td><td><code class="type">cube</code></td><td>在一个现有的立方体上增加一维来制造一个新立方体，对新坐标的各个端点都采用相同的值。这可以用于从计算得到的值逐渐地构建立方体。
      </td><td>
       <code class="literal">cube('(1,2),(3,4)'::cube, 5) == '(1,2,5),(3,4,5)'</code>
      </td></tr><tr><td><code class="literal">cube(cube, float8, float8)</code></td><td><code class="type">cube</code></td><td>在一个现有的立方体上增加一维来制造一个新立方体。这可以用于从计算得到的值逐渐地构建立方体。
      </td><td>
       <code class="literal">cube('(1,2),(3,4)'::cube, 5, 6) == '(1,2,5),(3,4,6)'</code>
      </td></tr><tr><td><code class="literal">cube_dim(cube)</code></td><td><code class="type">integer</code></td><td>返回该立方体的维数
      </td><td>
       <code class="literal">cube_dim('(1,2),(3,4)') == '2'</code>
      </td></tr><tr><td><code class="literal">cube_ll_coord(cube, integer)</code></td><td><code class="type">float8</code></td><td>返回一个立方体的左下角的第 <em class="replaceable"><code>n</code></em>个坐标值
      </td><td>
       <code class="literal">cube_ll_coord('(1,2),(3,4)', 2) == '2'</code>
      </td></tr><tr><td><code class="literal">cube_ur_coord(cube, integer)</code></td><td><code class="type">float8</code></td><td>返回一个立方体的右上角的第<em class="replaceable"><code>n</code></em>个坐标值
      </td><td>
       <code class="literal">cube_ur_coord('(1,2),(3,4)', 2) == '4'</code>
      </td></tr><tr><td><code class="literal">cube_is_point(cube)</code></td><td><code class="type">boolean</code></td><td>如果一个立方体是一个点则返回真，也就是两个定义点相同。</td><td>
      </td></tr><tr><td><code class="literal">cube_distance(cube, cube)</code></td><td><code class="type">float8</code></td><td>返回两个立方体之间的距离。如果两个都是点，这就是普通距离函数。
      </td><td>
      </td></tr><tr><td><code class="literal">cube_subset(cube, integer[])</code></td><td><code class="type">cube</code></td><td>从一个现有的立方体制造一个新立方体，使用来自于一个数组的维索引列表。它可以被用来抽取一个单一维度的端点，或者它可以被用来去除维度，或者按照需要对它们重新排序。
      </td><td>
       <code class="literal">cube_subset(cube('(1,3,5),(6,7,8)'), ARRAY[2]) == '(3),(7)'</code>
       <code class="literal">cube_subset(cube('(1,3,5),(6,7,8)'), ARRAY[3,2,1,1]) ==
        '(5,3,1,1),(8,7,6,6)'</code>
      </td></tr><tr><td><code class="literal">cube_union(cube, cube)</code></td><td><code class="type">cube</code></td><td>产生两个立方体的并
      </td><td>
      </td></tr><tr><td><code class="literal">cube_inter(cube, cube)</code></td><td><code class="type">cube</code></td><td>产生两个立方体的交
      </td><td>
      </td></tr><tr><td><code class="literal">cube_enlarge(c cube, r double, n integer)</code></td><td><code class="type">cube</code></td><td>用一个指定的半径<em class="replaceable"><code>r</code></em>在至少<em class="replaceable"><code>n</code></em>个维度上增加立方体的尺寸。如果该半径是负值，则该立方体会收缩。这有助于围绕一个点创建一个外包盒来搜索附近点。所有已定义的维度都会按照半径<em class="replaceable"><code>r</code></em>被改变。左下坐标按照<em class="replaceable"><code>r</code></em>被减小并且右上坐标按照<em class="replaceable"><code>r</code></em>被增加。如果一个左下坐标被增加得超过对应的右上坐标（这只会发生在<em class="replaceable"><code>r</code></em>&lt; 0 时），则两个坐标会被设置为它们的均值。如果<em class="replaceable"><code>n</code></em>大于已定义的维度数并且该立方体被增加（<em class="replaceable"><code>r</code></em> &gt;= 0）， 则额外的维度会被加入以让维度数达到<em class="replaceable"><code>n</code></em>，对于额外的坐标将使用 0 作为初始值。这个函数可用来创建围绕一个点的外包盒以搜索临近点。
      </td><td>
       <code class="literal">cube_enlarge('(1,2),(3,4)', 0.5, 3) ==
        '(0.5,1.5,-0.5),(3.5,4.5,0.5)'</code>
      </td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="id-1.11.7.18.7"><div class="titlepage"><div><div><h3 class="title">F.9.4. 默认值</h3></div></div></div><p>
   我相信这个并：
  </p><pre class="programlisting">
select cube_union('(0,5,2),(2,3,1)', '0');
cube_union
-------------------
(0, 0, 0),(2, 5, 2)
(1 row)
</pre><p>
    不会与常识矛盾，下面的交也不会
   </p><pre class="programlisting">
select cube_inter('(0,-1),(1,1)', '(-2),(2)');
cube_inter
-------------
(0, 0),(1, 0)
(1 row)
</pre><p>
    在所有不同维度立方体的二元操作中，我假定低纬度的那一个要做笛卡尔投影，即为字符串表示中被省略的坐标取零。上面的例子等同于：
   </p><pre class="programlisting">
cube_union('(0,5,2),(2,3,1)','(0,0,0),(0,0,0)');
cube_inter('(0,-1),(1,1)','(-2,0),(2,0)');
</pre><p>
    下列包含谓词使用点语法，不过实际上第二个参数在内部被表示为一个盒子。这种语法让我们不必定义一种单独的点类型以及用于（盒子, 点）谓词的函数。
   </p><pre class="programlisting">
select cube_contains('(0,0),(1,1)', '0.5,0.5');
cube_contains
--------------
t
(1 row)
</pre></div><div class="sect2" id="id-1.11.7.18.8"><div class="titlepage"><div><div><h3 class="title">F.9.5. 注解</h3></div></div></div><p>
   用法的例子可见回归测试<code class="filename">sql/cube.sql</code>。
  </p><p>
   为了不容易出问题，对于立方体的维度数有 100 的限制。如果你想要更大的立方体，可以在<code class="filename">cubedata.h</code>中修改。
  </p></div><div class="sect2" id="id-1.11.7.18.9"><div class="titlepage"><div><div><h3 class="title">F.9.6. 工作人员</h3></div></div></div><p>
   原作者：Gene Selkov, Jr. <code class="email">&lt;<a class="email" href="mailto:selkovjr@mcs.anl.gov">selkovjr@mcs.anl.gov</a>&gt;</code>，数学与计算机科学部，阿尔贡国家实验室。
  </p><p>
   我的感谢主要要献给 Joe Hellerstein 教授（<a class="ulink" href="http://db.cs.berkeley.edu/jmh/" target="_top">http://db.cs.berkeley.edu/jmh/</a>），他阐明了 GiST （<a class="ulink" href="http://gist.cs.berkeley.edu/" target="_top">http://gist.cs.berkeley.edu/</a>），还要送给他以前的学生 Andy Dong，他为 Illustra 编写了例子。我也对所有的 Postgres 开发者（现在的和以前的）心存感激，他们让我能够创造自己的世界并且宁静地生活在其中。我也要感谢阿尔贡实验室和美国能源局对我多年数据库研究的支持。
  </p><p>
   这个包的小更新由 Bruno Wolff III <code class="email">&lt;<a class="email" href="mailto:bruno@wolff.to">bruno@wolff.to</a>&gt;</code>于 2002 年 8/9 月完成。这些修改包括将精度从单精度改为双精度以及增加了一些新的函数。
  </p><p>
   额外的更新由 Joshua Reich <code class="email">&lt;<a class="email" href="mailto:josh@root.net">josh@root.net</a>&gt;</code> 在 2006 年 7 月做出。其中包括<code class="literal">cube(float8[], float8[])</code>并且将代码从废弃的 V0 协议改到 V1 调用协议。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="citext.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="dblink.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">F.8. citext </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> F.10. dblink</td></tr></table></div></body></html>