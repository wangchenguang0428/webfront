<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>23.1. 区域支持</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="charset.html" title="第 23 章 本地化" /><link rel="next" href="collation.html" title="23.2. 排序规则支持" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">23.1. 区域支持</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="charset.html" title="第 23 章 本地化">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="charset.html" title="第 23 章 本地化">上一级</a></td><th width="60%" align="center">第 23 章 本地化</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 11.2 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="collation.html" title="23.2. 排序规则支持">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="LOCALE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">23.1. 区域支持</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="locale.html#id-1.6.10.3.4">23.1.1. 概述</a></span></dt><dt><span class="sect2"><a href="locale.html#id-1.6.10.3.5">23.1.2. 行为</a></span></dt><dt><span class="sect2"><a href="locale.html#id-1.6.10.3.6">23.1.3. 问题</a></span></dt></dl></div><a id="id-1.6.10.3.2" class="indexterm"></a><p>
   <em class="firstterm">区域</em>支持指的是应用遵守文化偏好的问题，包括字母表、排序、数字格式等。<span class="productname">PostgreSQL</span>使用服务器操作系统提供的标准 ISO C 和<acronym class="acronym">POSIX</acronym>的区域机制。更多的信息请参考你的系统的文档。
  </p><div class="sect2" id="id-1.6.10.3.4"><div class="titlepage"><div><div><h3 class="title">23.1.1. 概述</h3></div></div></div><p>
    区域支持是在使用<code class="command">initdb</code>创建一个数据库集簇时自动被初始化的。默认情况下，<code class="command">initdb</code>将会按照它的执行环境的区域设置初始化数据库集簇； 因此如果你的系统已经设置为你的数据库集簇想要使用的区域， 那么你就没有什么可干的。如果你想使用其它的区域（或者你还不知道你的系统设置的区域是什么），那么你可以用<code class="option">--locale</code>选项准确地告诉<code class="command">initdb</code>你要用哪一个区域。 比如：
</p><pre class="screen">
initdb --locale=sv_SE
</pre><p>
   </p><p>
    这个Unix系统上的例子把区域设置为瑞典（<code class="literal">SE</code>）瑞典语（<code class="literal">sv</code>）。 其他的可能性包括 <code class="literal">en_US</code>（美国英语）和<code class="literal">fr_CA</code>（加拿大法语）。如果有多于一种字符集可以用于区域，那么声明可以采用如下的形式：<em class="replaceable"><code>language_territory.codeset</code></em>。例如<code class="literal">fr_BE.UTF-8</code>表示在比利时（BE）讲的法语（fr），使用一个<acronym class="acronym">UTF-8</acronym>字符集编码。
   </p><p>
    在你的系统上有哪些区域可用取决于操作系统提供商提供了什么以及安装了什么。在大部分Unix系统上，命令<code class="literal">locale -a</code>将会提供一个所有可用区域的列表。Windows使用一些更繁琐的区域名，例如<code class="literal">German_Germany</code>或者<code class="literal">Swedish_Sweden.1252</code>，但是其原则是相同的。
   </p><p>
    有时候，把几种区域规则混合起来也很有用，比如，使用英语排序规则而用西班牙语消息。 为了支持这些，我们有一套区域子类用于控制本地化规则的某些方面：

    </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="envar">LC_COLLATE</code></td><td>字符串排序顺序</td></tr><tr><td><code class="envar">LC_CTYPE</code></td><td>字符分类（什么是一个字符？它的大写形式是否等效？）</td></tr><tr><td><code class="envar">LC_MESSAGES</code></td><td>消息使用的语言Language of messages</td></tr><tr><td><code class="envar">LC_MONETARY</code></td><td>货币数量使用的格式</td></tr><tr><td><code class="envar">LC_NUMERIC</code></td><td>数字的格式</td></tr><tr><td><code class="envar">LC_TIME</code></td><td>日期和时间的格式</td></tr></tbody></table></div><p>

    这些类名转换成<code class="command">initdb</code>的选项名来覆盖某个特定分类的区域选择。比如，要把区域设置为加拿大法语，但使用 U.S. 规则格式化货币，可以使用<code class="literal">initdb --locale=fr_CA --lc-monetary=en_US</code>。
   </p><p>
    如果你想让系统表现得象没有区域支持，那么使用特殊的区域名<code class="literal">C</code>或者等效的<code class="literal">POSIX</code>。
   </p><p>
    一些区域分类的值必需在数据库被创建时的就被固定。你可以为不同的数据库使用不同的设置，但是一旦一个数据库被创建，你就不能在数据库上修改这些区域分类的值。<code class="literal">LC_COLLATE</code>和<code class="literal">LC_CTYPE</code>就是这样的分类。它们影响索引的排序顺序，因此它们必需保持固定， 否则在文本列上的索引将会崩溃（但是你可以使用排序规则放松这种限制，讨论见<a class="xref" href="collation.html" title="23.2. 排序规则支持">第 23.2 节</a>）。这些分类的默认值在<code class="command">initdb</code>运行时被确定，并且这些值在新数据库被创建时使用，除非在<code class="command">CREATE DATABASE</code>命令中特别指定。
   </p><p>
    其它区域分类可以在任何时候被更改，更改的方式是设置与区域分类同名的服务器配置参数（详见<a class="xref" href="runtime-config-client.html#RUNTIME-CONFIG-CLIENT-FORMAT" title="19.11.2. 区域和格式化">第 19.11.2 节</a>）。被<code class="command">initdb</code>选中的值实际上只是被写入到配置文件<code class="filename">postgresql.conf</code>中作为服务器启动时的默认值。如果你将这些赋值从<code class="filename">postgresql.conf</code>中除去，那么服务器将会从其执行环境中继承该设置。
   </p><p>
    请注意服务器的区域行为是由它看到的环境变量决定的，而不是由任何客户端的环境变量影响的。 因此，我们要在启动服务器之前认真地设置好这些变量。这样带来的一种后果是如果客户端和服务器设置成不同的区域， 那么消息可能以不同的语言呈现，实际情况取决于它们的起源地。
   </p><div class="note"><h3 class="title">注意</h3><p>
     在我们谈到从执行环境继承区域的时候，我们的意思是在大多数操作系统上的下列动作： 对于一个给定的区域分类，比如排序规则，按照下面的顺序评估这些环境变量， 直到找到一个被设置了的：<code class="envar">LC_ALL</code>、 <code class="envar">LC_COLLATE</code>（或者对应于相应分类的变量）、<code class="envar">LANG</code>。如果这些环境变量一个都没有被设置，那么将区域缺省设置为<code class="literal">C</code>。
    </p><p>
     一些消息本地化库也查看环境变量<code class="envar">LANGUAGE</code>，它覆盖所有其它用于设置消息语言的区域设置。如果有疑问， 请参考你的操作系统的文档，特别是有关<span class="application">gettext</span>的文档。
    </p></div><p>
    要允许消息被翻译成用户喜欢的语言，编译时必需打开<acronym class="acronym">NLS</acronym>（<code class="literal">configure --enable-nls</code>）。所有其他区域支持都会被自动编译。
   </p></div><div class="sect2" id="id-1.6.10.3.5"><div class="titlepage"><div><div><h3 class="title">23.1.2. 行为</h3></div></div></div><p>
    区域设置特别影响下面的 SQL 特性：

    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       在文本数据上使用<code class="literal">ORDER BY</code>或标准比较操作符的查询中的排序顺序
       <a id="id-1.6.10.3.5.2.1.1.1.2" class="indexterm"></a>
      </p></li><li class="listitem"><p>
       函数<code class="function">upper</code>、<code class="function">lower</code>和<code class="function">initcap</code>
       <a id="id-1.6.10.3.5.2.1.2.1.4" class="indexterm"></a>
       <a id="id-1.6.10.3.5.2.1.2.1.5" class="indexterm"></a>
      </p></li><li class="listitem"><p>
       模式匹配操作符（<code class="literal">LIKE</code>、<code class="literal">SIMILAR TO</code>和POSIX风格的正则表达式）；区域影响大小写不敏感匹配和通过字符类正则表达式的字符分类
       <a id="id-1.6.10.3.5.2.1.3.1.3" class="indexterm"></a>
       <a id="id-1.6.10.3.5.2.1.3.1.4" class="indexterm"></a>
      </p></li><li class="listitem"><p>
       <code class="function">to_char</code>函数家族
       <a id="id-1.6.10.3.5.2.1.4.1.2" class="indexterm"></a>
      </p></li><li class="listitem"><p>
       为<code class="literal">LIKE</code>子句使用索引的能力
      </p></li></ul></div><p>
   </p><p>
    <span class="productname">PostgreSQL</span>中使用非<code class="literal">C</code>或非<code class="literal">POSIX</code>区域的缺点是性能影响。它降低了字符处理的速度并且阻止了在<code class="literal">LIKE</code>中对普通索引的使用。因此，只能在真正需要的时候才使用它。
   </p><p>
    作为允许<span class="productname">PostgreSQL</span>在非 C 区域下为<code class="literal">LIKE</code>子句使用索引， 有好几种自定义操作符类可用。这些操作符类允许创建一个执行严格按字符比较的索引。详见<a class="xref" href="indexes-opclass.html" title="11.10. 操作符类和操作符族">第 11.10 节</a>。另一种方法是创建使用<code class="literal">C</code>排序规则的索引，如<a class="xref" href="collation.html" title="23.2. 排序规则支持">第 23.2 节</a>所讨论的。
   </p></div><div class="sect2" id="id-1.6.10.3.6"><div class="titlepage"><div><div><h3 class="title">23.1.3. 问题</h3></div></div></div><p>
    如果根据上面解释区域支持仍然不能运转，检查一下操作系统的区域支持是否被正确配置。 要检查系统中安装了哪些区域，你可以使用命令<code class="literal">locale -a</code>（如果你的操作系统提供了该命令）。
   </p><p>
    请检查<span class="productname">PostgreSQL</span>确实正在使用你认为它该用的区域设置。<code class="envar">LC_COLLATE</code>和<code class="envar">LC_CTYPE</code>设置都是在数据库创建时决定的，并且在除了创建数据库之外的操作中都不能被更改。其它的区域设置包括<code class="envar">LC_MESSAGES</code>和<code class="envar">LC_MONETARY</code>都是由服务器启动的环境决定的， 但是可以在运行时修改。你可以用<code class="command">SHOW</code>命令检查活跃的区域设置。
   </p><p>
    源代码目录的<code class="filename">src/test/locale</code>中包含<span class="productname">PostgreSQL</span>的区域支持的测试套件。
   </p><p>
    那些通过分析错误消息来处理服务器端错误的客户端应用很明显会有问题，因为服务器来的消息可能会是以不同语言表示的。 我们建议这类应用的开发人员改用错误代码机制。
   </p><p>
    维护消息翻译目录需要许多志愿者的坚持不懈的努力， 他们希望<span class="productname">PostgreSQL</span>以他们的语言说话。 如果以你的语言表示的消息目前还不可用或者没有完全翻译完成，那么我们很感谢你的协助。如果你想帮忙，那么请参考<a class="xref" href="nls.html" title="第 55 章 本国语言支持">第 55 章</a>或者向开发者邮递列表发邮件。
   </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="charset.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="charset.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="collation.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">第 23 章 本地化 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 23.2. 排序规则支持</td></tr></table></div></body></html>