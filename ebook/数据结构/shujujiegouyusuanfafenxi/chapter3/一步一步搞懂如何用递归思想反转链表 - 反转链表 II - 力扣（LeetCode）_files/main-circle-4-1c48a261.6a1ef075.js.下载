(window.nojMonomainwebpackJsonpproduction=window.nojMonomainwebpackJsonpproduction||[]).push([[20],{"3Xm+":function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n("D57K"),i=n("ERkP"),r=n.n(i),o=n("GG6d"),d=r.a.forwardRef((function(e,t){return r.a.createElement(o.a,Object(a.__assign)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"1em",height:"1em",fill:"currentColor",ref:t},e),r.a.createElement("path",{fillRule:"evenodd",d:"M5.527 5.527a7.5 7.5 0 0111.268 9.852l3.581 3.583a1 1 0 01-1.414 1.415l-3.582-3.583A7.501 7.501 0 015.527 5.527zm1.414 1.414a5.5 5.5 0 107.779 7.779A5.5 5.5 0 006.94 6.94z",clipRule:"evenodd"}))}))},"8McP":function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n("D57K"),i=n("ERkP"),r=n.n(i),o=n("GG6d"),d=r.a.forwardRef((function(e,t){return r.a.createElement(o.a,Object(a.__assign)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"1em",height:"1em",fill:"currentColor",ref:t},e),r.a.createElement("path",{fillRule:"evenodd",d:"M13 7a1 1 0 011-1h2a6 6 0 010 12h-2a1 1 0 110-2h2a4 4 0 000-8h-2a1 1 0 01-1-1zm-3 10a1 1 0 01-1 1H8A6 6 0 018 6h1a1 1 0 010 2H8a4 4 0 100 8h1a1 1 0 011 1zm-1-6h6a1 1 0 110 2H9a1 1 0 110-2z",clipRule:"evenodd"}))}))},Q0jv:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var a=n("D57K"),i=n("3dHC"),r=n.n(i),o=n("ERkP"),d=n.n(o),l=n("TMWK"),c=n("v31z"),u=Object(l.a)("div",{target:"e1freqn70"})({display:"inline-flex",justifyContent:"space-between"},(function(e){return Object(a.__assign)({},e.style)}),"label:Wrapper;"),s=Object(l.a)(c.a,{target:"e1freqn71"})({minWidth:"24px",marginRight:"10px","&:nth-last-of-type(1)":{marginRight:0}},"label:Button;"),m=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.state={current:n.props.current||n.props.defaultCurrent||t.defaultCurrent},n.onClickPrevDot=function(){return n.updateCurrentPageNum(n.state.current-n.props.maxDisplayedPageBtnNum||1)},n.onClickNextDot=function(){var e=n.state.current+n.props.maxDisplayedPageBtnNum;n.updateCurrentPageNum(e>n.totalPage?n.totalPage:e)},n.onClickPrev=function(){return n.updateCurrentPageNum(n.state.current-1)},n.onClickNext=function(){return n.updateCurrentPageNum(n.state.current+1)},n.onSelectPage=function(e){n.updateCurrentPageNum(Number(e.currentTarget.dataset.page)||1)},n.updateCurrentPageNum=function(e){e!==n.state.current&&(e<1||e>n.totalPage||(void 0!==n.props.current?n.props.onChange&&n.props.onChange(e,n.props.numPerPage):n.setState({current:e},(function(){return n.props.onChange&&n.props.onChange(n.state.current,n.props.numPerPage)}))))},n}return Object(a.__extends)(t,e),Object.defineProperty(t.prototype,"totalPage",{get:function(){return Math.ceil(this.props.totalNum/this.props.numPerPage)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasDotBtn",{get:function(){return this.totalPage>this.props.maxDisplayedPageBtnNum+2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfMaxDisplayedPageBtnNum",{get:function(){return Math.ceil(this.props.maxDisplayedPageBtnNum/2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shouldRenderPrevDot",{get:function(){return this.hasDotBtn&&this.state.current-this.halfMaxDisplayedPageBtnNum>=2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shouldRenderNextDot",{get:function(){return this.hasDotBtn&&this.totalPage-this.state.current>this.halfMaxDisplayedPageBtnNum},enumerable:!1,configurable:!0}),t.getDerivedStateFromProps=function(e,t){return{current:void 0!==e.current?e.current:t.current}},t.prototype.componentDidMount=function(){this.props.onChange&&this.props.onChange(this.state.current,this.props.numPerPage)},t.prototype.render=function(){var e=this;if(this.state.current<1)throw Error("Page should not be less than 1.");return this.props.totalNum<=this.props.numPerPage?null:d.a.createElement(u,{style:this.props.style},this.getRenderedBtnsProps().map((function(t){return d.a.createElement(s,Object(a.__assign)({},t,{disabled:e.props.disabled}))})))},t.prototype.getRenderedBtnsProps=function(){return this.totalPage<1?[this.getRenderedAngleBtnProps("prev"),this.getRenderedAngleBtnProps("next")]:r()(Object(a.__spread)([this.getRenderedAngleBtnProps("prev"),this.getRenderedPageBtnProps(1),this.shouldRenderPrevDot?this.getRenderedDotBtnProps("prev"):null],this.getPageItemsPropsByCurrent(),[this.shouldRenderNextDot?this.getRenderedDotBtnProps("next"):null,1===this.totalPage?null:this.getRenderedPageBtnProps(this.totalPage),this.getRenderedAngleBtnProps("next")]))},t.prototype.getRenderedPageBtnProps=function(e){return{type:this.state.current===e?"primary":this.props.inactiveButtonType,size:"xs","data-page":e,children:e,onClick:this.onSelectPage,key:e}},t.prototype.getRenderedDotBtnProps=function(e){return{type:"ghost",size:"xs",icon:"ellipsis",onClick:"prev"===e?this.onClickPrevDot:this.onClickNextDot,key:e+"-dot"}},t.prototype.getRenderedAngleBtnProps=function(e){var t=this;return{type:this.props.inactiveButtonType,size:"xs",icon:"prev"===e?"angle-left":"angle-right",onClick:"prev"===e?this.onClickPrev:this.onClickNext,key:e+"-angle",disabled:t.totalPage<1||"prev"===e&&1===t.state.current||"next"===e&&t.state.current===t.totalPage||void 0}},t.prototype.getPageItemsPropsByCurrent=function(){if(this.hasDotBtn){var e=this.state.current-this.halfMaxDisplayedPageBtnNum,t=this.state.current+this.halfMaxDisplayedPageBtnNum;return e<=0?this.getItems({start:2,length:this.props.maxDisplayedPageBtnNum-1}):t>=this.totalPage?this.getItems({start:this.totalPage-this.props.maxDisplayedPageBtnNum+1,length:this.props.maxDisplayedPageBtnNum-1}):this.getItems({start:this.state.current-this.halfMaxDisplayedPageBtnNum+1,length:this.props.maxDisplayedPageBtnNum})}return this.getItems({start:2,length:this.totalPage-2})},t.prototype.getItems=function(e){var t=this,n=e.start,a=e.length;return Array.from({length:a}).map((function(e,a){var i=n+a;return t.getRenderedPageBtnProps(i)}))},t.defaultCurrent=1,t.defaultProps={numPerPage:15,maxDisplayedPageBtnNum:5,inactiveButtonType:"default"},t}(d.a.PureComponent)},Vw2C:function(e,t,n){"use strict";t.a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"topicCommentCount"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"topicId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"topic"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"topicId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"commentCount"},arguments:[],directives:[]}]}}]}}],loc:{source:{body:"query topicCommentCount($topicId: Int!) {\n  topic(id: $topicId) {\n    id\n    commentCount\n  }\n}\n"}},operationName:"topicCommentCount",defName:"topic"}},"Y+c1":function(e,t,n){"use strict";n.d(t,"a",(function(){return Kn}));var a=n("D57K"),i=n("K/af"),r=n("3dHC"),o=n.n(r),d=n("Ygfp"),l=n.n(d),c=n("ERkP"),u=n.n(c),s=n("60w7"),m=n("xqpu"),p=n("8JP3"),g=n("34li"),b=n("9KnD"),v=n("jWBs"),k=n("fgAA"),f=n("YnR9"),y=n("OJn1"),h=function(){function e(){var e=this;this.callbacks=[],this.isScheduled=!1,this.runCallbacks=function(){var t=e.callbacks.shift();t?(t(),requestAnimationFrame(e.runCallbacks)):e.isScheduled=!1}}return e.prototype.add=function(e){var t=this;return this.callbacks.push(e),this.flush(),function(){return t.remove(e)}},e.prototype.remove=function(e){var t=this.callbacks.indexOf(e);-1!==t&&this.callbacks.splice(t,1)},e.prototype.flush=function(){this.isScheduled||(this.isScheduled=!0,requestAnimationFrame(this.runCallbacks))},e}(),O=n("e96/"),j=n("tvc/"),N=n.n(j),_={};function S(e,t){t&&C(t),e.core.ruler.before("block","mention-plugin-rule",(function(e){var t=Object.keys(_).map((function(e){return N()(e)})).join("|");if(t){var n=new RegExp("@("+t+")","g");e.src=e.src.replace(n,(function(e,t){var n=_[t];return n?"["+e+"]("+f.a.main.paths.publicProfile.home({userSlug:n})+")":e}))}}))}function C(e){_=e}var I,x=n("PZQm"),F=n.n(x),w=n("RpsB");function P(){if(I)return I;(I=new F.a({html:!1,linkify:!0,highlight:function(e,t){if(t)try{return w.a.highlight(t,e,!0).value}catch(e){}return w.a.highlightAuto(e).value||e}})).disable(["table","blockquote","hr","reference","heading","lheading","html_block","strikethrough","emphasis","image","html_inline"]);var e=I.renderer.rules.link_open||function(e,t,n,a,i){return i.renderToken(e,t,n)};I.renderer.rules.link_open=function(t,n,a,i,r){var o=t[n].attrIndex("target");return o<0?t[n].attrPush(["target","_blank"]):t[n].attrs[o][1]="_blank",e(t,n,a,i,r)},I.use(S);var t=I.render.bind(I),n={};return I.render=function(e){return n[e]||(n[e]=t(e)),n[e]},I}var E=n("UqMZ"),R=n("ehcH"),D=n("u+Aj"),T=n("cPtI"),B=n("XKjd"),A=n("f7k3"),V=n("TMWK"),M=n("nnm9"),U=n.n(M),$=n("1szP"),H=n("JFCy"),z=n("v31z"),q=n("/NrN"),L=n("htYk");function W(e){var t=e.onClick||U.a;return u.a.createElement(z.a,{className:e.className,icon:e.icon,type:"transparent",size:"xs",disabled:e.disabled,onClick:t},e.text)}var K=Object(A.d)(G||(G=Object(a.__makeTemplateObject)(["\n  0% {\n    background-color: transparent;\n    box-shadow: none;\n  }\n  40% {\n    background-color: ",";\n    box-shadow: 0 0 0 5px ",";\n  }\n  60% {\n    background-color: ",";\n    box-shadow: 0 0 0 5px ",";\n  }\n  100% {\n    background-color: transparent;\n    box-shadow: none;\n  }\n"],["\n  0% {\n    background-color: transparent;\n    box-shadow: none;\n  }\n  40% {\n    background-color: ",";\n    box-shadow: 0 0 0 5px ",";\n  }\n  60% {\n    background-color: ",";\n    box-shadow: 0 0 0 5px ",";\n  }\n  100% {\n    background-color: transparent;\n    box-shadow: none;\n  }\n"])),k.a.green(0),k.a.green(0),k.a.green(0),k.a.green(0)),Y=Object(V.a)("div",{target:"e19tnut60"})((function(e){return e.highlight?{animation:K+" 3s cubic-bezier(0.77, 0.01, 0.23, 1) 500ms"}:null}),{flex:"0 0 auto",display:"flex",flexDirection:"column",padding:"10px 0",position:"relative"},"label:CommentBody;");Y.defaultProps=Object(a.__assign)(Object(a.__assign)({},Y.defaultProps),{"data-cypress":"CommentBody"});var G,J,Q,X,Z,ee,te=Object(V.a)("div",{target:"e19tnut61"})({display:"flex",width:"100%",justifyContent:"space-between",marginBottom:"10px"},"label:CommentHeader;"),ne=Object(V.a)("div",{target:"e19tnut62"})({display:"flex",alignItems:"center"},"label:CommentAvatarWrapper;"),ae=Object(V.a)("img",{target:"e19tnut63"})({width:"30px",height:"30px",borderRadius:"50%"},"label:CommentAvatar;"),ie=(k.a.grey(7),Object(B.a)({marginLeft:"8px"})),re=Object(V.a)("span",{target:"e19tnut65"})({fontSize:"14px",color:k.a.grey(5),lineHeight:"30px",'&[data-status="Deleted"]':{color:k.a.red(2)},'&[data-status="Pending"]':{color:k.a.grey(4)}},"label:CommentTime;"),oe=Object(V.a)("div",{target:"e19tnut66"})({margin:"0 15px",display:"flex",flexDirection:"column"},"label:ReplyCommentsWrapper;"),de=Object(V.a)(W,{target:"e19tnut67"})((function(e){return{display:!1===e.visible?"none":"block",color:e.isDanger?k.a.red(5):void 0,userSelect:"none"}}),"label:ToolButton;"),le=Object(V.a)(q.a,{target:"e19tnut68"})({color:k.a.red(5),"&:hover:not([disabled])":{color:k.a.red(5)},svg:{width:"14px",height:"14px"}},"label:AdminButton;"),ce=Object(V.a)(L.a,{target:"e19tnut69"})({textAlign:"center",color:k.a.red(5),fontSize:"12px"},"label:StyledMuteButton;"),ue=Object(V.a)("div",{target:"e19tnut610"})((function(e){return{display:e.visible?"flex":"none",margin:"5px 0 0"}}),"label:Toolbar;"),se=(k.a.grey(1),k.a.grey(1),k.a.grey(1),Object($.renderWithSize)((function(e){return e&&e.width<=530?{size:H.d.SM}:{size:H.d.MD}}),(function(e){var t=e.size,n=e.repliesCount;return t===H.d.SM?u.a.createElement("span",null,""+n):u.a.createElement("span",null,n&&"\u67e5\u770b "+n+" \u6761\u56de\u590d")}))),me=Object(A.b)({flexDirection:"row"},"label:errorWrap;"),pe=Object(V.a)("div",{target:"e19tnut617"})({background:k.a.grey(0),boxShadow:"inset 0 1px 6px "+k.a.grey(9,.1),padding:"5px 0 0",marginTop:"10px",borderRadius:"3px"},"label:CommentReplyWrapper;"),ge=Object(V.a)("div",{target:"e1hs3jt60"})({display:"flex",justifyContent:"flex-end"},"label:Wrapper;"),be=Object(V.a)("div",{target:"e1hs3jt61"})((function(e){return{fontSize:"12px",lineHeight:"24px",color:e.isActive?k.a.grey(8):k.a.grey(6),cursor:"pointer",padding:"0 15px",position:"relative","&:not(:last-of-type)::after":{content:'""',height:"12px",width:"1px",background:k.a.grey(3),position:"absolute",right:"0px",top:"50%",transform:"translateY(-50%)"}}}),"label:Option;"),ve=[{name:"\u6700\u65e9",key:g.s.OldToNew},{name:"\u6700\u65b0",key:g.s.NewToOld}],ke=u.a.memo((function(e){var t=e.activeOption,n=e.onOptionClick,a=Object(c.useCallback)((function(e){var t=e.currentTarget.dataset.key;n(t)}),[]);return u.a.createElement(ge,null,ve.map((function(e){var n=e.name,i=e.key;return u.a.createElement(be,{key:i,"data-key":i,onClick:a,isActive:t===i},n)})))})),fe=n("Q0jv"),ye=Object(V.a)("div",{target:"e6o0inv0"})({display:"flex",height:"55px",margin:"0 15px",borderTop:"1px solid "+k.a.grey(2),alignItems:"center",justifyContent:"center",position:"relative","> button":{color:k.a.grey(7),position:"absolute",left:0,top:"50%",transform:"translateY(-50%)"}},"label:Wrapper;"),he=u.a.memo((function(e){var t=e.page,n=e.totalNum,a=e.setRepliesPage,i=e.hideReplies,r=e.resetCommentReply,o=Object(c.useCallback)((function(){i(),r()}),[]);return u.a.createElement(ye,null,u.a.createElement(z.a,{size:H.e,type:"ghost",onClick:o,icon:"angle-up"},"\u6536\u8d77\u56de\u590d"),u.a.createElement(fe.a,{current:t,totalNum:n,numPerPage:10,maxDisplayedPageBtnNum:5,onChange:a,inactiveButtonType:"ghost"}))})),Oe=n("CkJS"),je=n("txck"),Ne=n("T/5y"),_e=Object(V.a)("div",{target:"e9bqj3q0"})({padding:"7px 10px"},"label:RenderContentWrapper;"),Se=V.a.div(J||(J=Object(a.__makeTemplateObject)(["\n  ","\n  ","\n  \n  code {\n    ","\n    ","\n    padding: 2px 4px;\n    border-radius: 3px;\n  }\n  \n  pre {\n    ","\n    overflowX: auto;\n    overflowY: hidden;\n    border-radius: 3px;\n    padding: 5px 8px;\n    \n    code {\n      border: 0;\n      padding: 0;\n      background: transparent !important;\n    }\n  }\n  \n  ul, li {\n    margin: 4px 0;\n  }\n  \n  li {\n    line-height: 1.6;\n  }\n  \n  a {\n    color: ",";\n  }\n  \n  .user {\n    cursor: pointer;\n    color: ",";\n    \n    :hover {\n      text-decoration: underline;\n    },\n  }\n"],["\n  ","\n  ","\n  \n  code {\n    ","\n    ","\n    padding: 2px 4px;\n    border-radius: 3px;\n  }\n  \n  pre {\n    ","\n    overflowX: auto;\n    overflowY: hidden;\n    border-radius: 3px;\n    padding: 5px 8px;\n    \n    code {\n      border: 0;\n      padding: 0;\n      background: transparent !important;\n    }\n  }\n  \n  ul, li {\n    margin: 4px 0;\n  }\n  \n  li {\n    line-height: 1.6;\n  }\n  \n  a {\n    color: ",";\n  }\n  \n  .user {\n    cursor: pointer;\n    color: ",";\n    \n    :hover {\n      text-decoration: underline;\n    },\n  }\n"])),Oe.a.paragraph.sm,je.a.primary,je.a.secondary,Ne.a.overlay,Ne.a.overlay,k.a.blue(6),k.a.blue(6)),Ce=n("DuHN"),Ie=(n("IJu9"),n("lKcY")),xe=n("xdqw"),Fe=n("AnWY"),we=n("GG6d"),Pe=u.a.forwardRef((function(e,t){return u.a.createElement(we.a,Object(a.__assign)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"1em",height:"1em",fill:"currentColor",ref:t},e),u.a.createElement("path",{fillRule:"evenodd",d:"M5.5 5h1.866a.5.5 0 01.486.617l-.96 4a.5.5 0 01-.486.383H5.5a.5.5 0 01-.5-.5v-4a.5.5 0 01.5-.5zm8 0h1.866a.5.5 0 01.486.617l-.96 4a.5.5 0 01-.486.383H13.5a.5.5 0 01-.5-.5v-4a.5.5 0 01.5-.5z",clipRule:"evenodd"}))})),Ee=u.a.forwardRef((function(e,t){return u.a.createElement(we.a,Object(a.__assign)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"1em",height:"1em",fill:"currentColor",ref:t},e),u.a.createElement("path",{fillRule:"evenodd",d:"M3.64 10.98c.147 0 .312-.022.495-.066.183-.044.348-.12.495-.23.147-.11.271-.269.374-.474.103-.205.154-.462.154-.77V5.084c0-.499.077-.928.231-1.287.154-.36.363-.66.627-.902s.565-.422.902-.539c.337-.117.69-.176 1.056-.176H9.58v1.848H8.37c-.425 0-.693.14-.803.418-.11.279-.165.58-.165.902v4.136c0 .425-.08.788-.242 1.09-.161.3-.352.545-.572.736-.22.19-.455.337-.704.44-.25.103-.462.161-.638.176v.044c.176.015.389.062.638.143.25.08.484.216.704.407.22.19.41.447.572.77.161.323.242.74.242 1.254v4.004c0 .323.055.623.165.902.11.279.378.418.803.418h1.21v1.848H7.974c-.367 0-.719-.059-1.056-.176a2.573 2.573 0 01-.902-.539 2.586 2.586 0 01-.627-.902c-.154-.36-.231-.788-.231-1.287V14.61c0-.352-.051-.638-.154-.858a1.494 1.494 0 00-.374-.517 1.18 1.18 0 00-.495-.253 2.143 2.143 0 00-.495-.066V10.98zm16.72 2.04c-.161 0-.33.022-.506.066a1.184 1.184 0 00-.484.253 1.494 1.494 0 00-.374.517c-.103.22-.154.506-.154.858v4.202c0 .499-.077.928-.231 1.287-.154.36-.363.66-.627.902a2.573 2.573 0 01-.902.54c-.337.116-.69.175-1.056.175H14.42v-1.848h1.21c.425 0 .693-.14.803-.418.11-.279.165-.58.165-.902v-4.004c0-.513.08-.931.242-1.254.161-.323.352-.58.572-.77.22-.19.455-.326.704-.407.25-.08.462-.128.638-.143v-.044a2.225 2.225 0 01-.638-.176 2.567 2.567 0 01-.704-.44c-.22-.19-.41-.436-.572-.737-.161-.3-.242-.664-.242-1.089V5.452c0-.323-.055-.623-.165-.902-.11-.279-.378-.418-.803-.418h-1.21V2.284h1.606c.367 0 .719.059 1.056.176.337.117.638.297.902.539.264.242.473.543.627.902.154.36.231.788.231 1.287v4.356c0 .308.051.565.154.77.103.205.227.363.374.473.147.11.308.187.484.231.176.044.345.066.506.066v1.936z",clipRule:"evenodd"}))})),Re=n("8McP"),De=n("wgQk"),Te=u.a.forwardRef((function(e,t){return u.a.createElement(we.a,Object(a.__assign)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"1em",height:"1em",fill:"currentColor",ref:t},e),u.a.createElement("path",{fillRule:"evenodd",d:"M7 6a1 1 0 011-1h13a1 1 0 110 2H8a1 1 0 01-1-1zm1 13a1 1 0 110-2h13a1 1 0 010 2H8zm0-6a1 1 0 110-2h13a1 1 0 010 2H8zM2.756 4.98l.236-1.18h2.22l-.92 4.6h-1.38l.684-3.42h-.84zm2.823 8.3l-.235 1.192H1.756l.174-.87.073-.117 1.911-1.498c.219-.178.368-.324.445-.434a.49.49 0 00.099-.287.208.208 0 00-.083-.18c-.067-.052-.176-.082-.335-.082a.897.897 0 00-.398.094 1.02 1.02 0 00-.342.272l-.12.144-.968-.702.118-.162c.193-.264.456-.473.786-.625.327-.15.684-.225 1.068-.225.318 0 .602.053.85.16.255.11.456.267.6.47.146.206.22.44.22.698 0 .298-.083.58-.247.839-.158.25-.424.518-.797.807l-.653.506h1.422zm-3.063 3.7l.245-1.18h3.345l-.166.867-.06.11-.93.869a1.205 1.205 0 01.737 1.144c-.001.327-.098.622-.29.881a1.856 1.856 0 01-.774.593c-.322.139-.685.208-1.087.208-.328 0-.636-.045-.924-.135a2.06 2.06 0 01-.743-.4l-.132-.114.688-1.05.173.147c.12.103.267.185.442.245.177.06.364.091.562.091.251 0 .435-.044.554-.124a.31.31 0 00.146-.282c0-.086-.025-.135-.08-.171-.076-.05-.213-.079-.41-.079h-.687l.173-.88.06-.108.674-.632H2.516z",clipRule:"evenodd"}))})),Be=u.a.forwardRef((function(e,t){return u.a.createElement(we.a,Object(a.__assign)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"1em",height:"1em",fill:"currentColor",ref:t},e),u.a.createElement("path",{fillRule:"evenodd",d:"M15.424 15.2a4.62 4.62 0 11-.742-6.947 1 1 0 011.985.176v4.524a1.714 1.714 0 003.429 0v-.905a8.048 8.048 0 10-3.155 6.39 1 1 0 111.216 1.588 10.048 10.048 0 113.939-7.978v.905a3.714 3.714 0 01-6.672 2.247zm-3.376-.533a2.62 2.62 0 100-5.238 2.62 2.62 0 000 5.238z",clipRule:"evenodd"}))})),Ae=n("nXSc"),Ve=n("r3KU"),Me=Object(V.a)("div",{target:"e1h3itgv0"})({position:"relative",border:"1px solid "+k.a.grey(3),borderRadius:"3px",background:k.a.grey(0)},"label:Container;"),Ue=Object(V.a)("textarea",{target:"e1h3itgv1"})({display:"block",outline:"none",resize:"none",width:"100%",padding:"7px 10px",border:"none",background:k.a.grey(0),borderTopLeftRadius:"3px",borderTopRightRadius:"3px",lineHeight:1.5,fontSize:"12px","&::placeholder":{color:k.a.grey(4)}},"label:TextArea;"),$e=Object(V.a)("div",{target:"e1h3itgv2"})({display:"flex",alignItems:"center",borderTop:"1px solid "+k.a.grey(3),padding:"0 5px 0 10px",height:"31px",userSelect:"none"},"label:Toolbar;"),He=Object(V.a)("div",{target:"e1h3itgv3"})((function(e){return Object(a.__assign)({marginTop:"-1px",padding:"4px 13px 5px",fontSize:"12px",lineHeight:"17px",alignSelf:"flex-start",flex:"0 0 auto"},e.isActive?{background:k.a.grey(0),color:k.a.grey(8),border:"1px solid "+k.a.grey(3),borderTop:"1px solid "+k.a.grey(0),borderBottomLeftRadius:"3px",borderBottomRightRadius:"3px"}:{background:"transparent",color:k.a.grey(5),cursor:"pointer"})}),"label:ModeTab;"),ze=Object(V.a)("div",{target:"e1h3itgv4"})({flex:"1 0 0",height:"1px"},"label:ToolbarPlaceholder;"),qe=Object(V.a)(q.a,{target:"e1h3itgv5"})({margin:"0 0 0 10px"},"label:SubmitButton;"),Le=Object(V.a)("div",{target:"e1h3itgv6"})({flex:"0 1 auto",display:"flex",flexWrap:"nowrap",overflow:"hidden"},"label:IconWrapper;"),We=Object(V.a)(q.a,{target:"e1h3itgv7"})({marginLeft:"8px","&:first-of-type":{marginLeft:"20px"}},"label:IconButton;"),Ke=n("lXyA"),Ye=n.n(Ke),Ge=n("43Bo"),Je=n.n(Ge),Qe=n("uhKY"),Xe=n("Hxrh"),Ze=n("5Nzd"),et=n("u3dr"),tt=n("2wT7"),nt=n("HnWI"),at=n("lqvn"),it=n("R+ki"),rt=n("AouM"),ot=n("Jg5f"),dt=n("W/Ou"),lt=n("B07F"),ct={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"matchedUsers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"namePrefix"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"topicId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"matchedUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"namePrefix"},value:{kind:"Variable",name:{kind:"Name",value:"namePrefix"}}},{kind:"Argument",name:{kind:"Name",value:"topicId"},value:{kind:"Variable",name:{kind:"Name",value:"topicId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"realName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userAvatar"},arguments:[],directives:[]}]}}]}}]}}],loc:{source:{body:"query matchedUsers($namePrefix: String!, $topicId: Int!) {\n  matchedUsers(namePrefix: $namePrefix, topicId: $topicId) {\n    username\n    profile {\n      realName\n      userSlug\n      userAvatar\n    }\n  }\n}\n"}},operationName:"matchedUsers",defName:"matchedUsers"},ut=function(e){function t(t){var n=e.call(this)||this;return n.client=t,n.defaultState={searchedUsers:[],loading:!1},n}var n,i,r;return Object(a.__extends)(t,e),t.prototype.setSearchedUser=function(e,t){var n=t.data,i=t.loading,r=void 0!==i&&i,o=n.matchedUsers;return Object(a.__assign)(Object(a.__assign)({},e),{searchedUsers:Object(a.__spread)(o||[]),loading:r})},t.prototype.searchUser=function(e){var t=this;return e.pipe(Object(at.a)(),Object(it.a)(500),Object(rt.a)((function(e){var n=e.value,a=e.topicId;return t.client.query({query:ct,variables:{namePrefix:n,topicId:a}}).pipe(Object(ot.a)((function(e){var n=e.data;return t.getActions().setSearchedUser({data:n})})),Object(dt.a)(t.getActions().setSearchedUser({data:{matchedUsers:[]},loading:!0})))})))},Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setSearchedUser",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(n="undefined"!==typeof nt.a&&nt.a)?n:Object]),Object(a.__metadata)("design:returntype","function"===typeof(i="undefined"!==typeof nt.a&&nt.a)?i:Object)],t.prototype,"searchUser",null),t=Object(a.__decorate)([Object(Ze.a)(),Object(a.__metadata)("design:paramtypes",["function"===typeof(r="undefined"!==typeof lt.a&&lt.a)?r:Object])],t)}(tt.a),st=n("pqRN"),mt=Object(V.a)("div",{target:"e15utkg50"})(((Q={background:k.a.grey(0),borderRadius:"3px",margin:"10px 0 0",width:"205px",boxShadow:"0 4px 16px 0 "+k.a.grey(9,.08),overflow:"auto",maxHeight:"300px"})[k.c]={background:k.a.grey(3),border:"1px solid "+k.a.grey(4),boxShadow:"0 1px 8px 0 rgba(0,0,0,.24)"},Q),"label:AutoCompleteContainer;"),pt=function(e){var t=e.className;return u.a.createElement("div",{className:t},u.a.createElement(bt,null),u.a.createElement(vt,null,u.a.createElement(kt,null),u.a.createElement(ft,null)))},gt=Object(V.a)(pt,{target:"e15utkg51"})({display:"flex",padding:"10px"},"label:MentionPlaceholder;"),bt=Object(V.a)("div",{target:"e15utkg52"})((function(e){var t,n=function(t){return e.url?"center/contain no-repeat url("+e.url+")":t?k.a.grey(4):k.a.grey(1)};return(t={background:n(!1),marginRight:"5px",width:"40px",height:"40px",borderRadius:"50%"})[k.c]={background:n(!0)},t}),"label:Avatar;"),vt=Object(V.a)("div",{target:"e15utkg53"})({flex:"1 0 0",display:"flex",flexDirection:"column",justifyContent:"center",overflow:"hidden"},"label:RightPart;"),kt=Object(V.a)("div",{target:"e15utkg54"})(((X={height:"18px",background:k.a.grey(1)})[k.c]={background:k.a.grey(4)},X),"label:PlaceholderRow1;"),ft=Object(V.a)("div",{target:"e15utkg55"})(((Z={marginTop:"4px",width:"100px",height:"12px",background:k.a.grey(1)})[k.c]={background:k.a.grey(4)},Z),"label:PlaceholderRow2;"),yt=Object(V.a)("div",{target:"e15utkg56"})(Object(a.__assign)(Object(a.__assign)({},st.i),{fontSize:"14px",lineHeight:"22px",color:k.a.grey(9)}),"label:DisplayName;"),ht=Object(V.a)("div",{target:"e15utkg57"})(Object(a.__assign)(Object(a.__assign)({},st.i),{fontSize:"12px",lineHeight:"18px",color:k.a.grey(5),transition:"color .3s"}),"label:Username;"),Ot=Object(V.a)("div",{target:"e15utkg58"})((function(e){var t,n;return(t={display:"flex",cursor:"pointer",padding:"10px",background:e.active?k.a.grey(1):k.a.grey(0),"&:hover":(n={},n[""+ht]={color:k.a.grey(9)},n)})[k.c]={background:e.active?k.a.grey(4):k.a.grey(3),"&:hover":{background:k.a.grey(4)}},t}),"label:MentionedUser;"),jt=Object(c.memo)((function(e){var t=Object(a.__read)(Object(c.useState)(""),2),n=t[0],r=t[1],o=Object(a.__read)(Object(c.useState)(""),2),d=o[0],l=o[1],s=Object(c.useRef)(null),m=e.onMentionUser,p=e.hideSelf,g=Object(a.__read)(Object(i.a)(ut,{scope:Ie.a}),2),b=g[0],v=g[1],f=Object(k.i)();Object(c.useEffect)((function(){var e;null===(e=null===s||void 0===s?void 0:s.current)||void 0===e||e.focus()}),[]);var y,h=Object(c.useCallback)((function(e){var t=b.searchedUsers.filter((function(t){return t.username===e}))[0];t&&m&&m(t)}),[b.searchedUsers,m]),O=Object(c.useCallback)((function(t){var n=t.currentTarget.value;r(n),v.searchUser({value:n,topicId:e.topicId})}),[r,v,e.topicId]),j=Object(c.useCallback)((function(e){e.stopPropagation()}),[]),N=Object(c.useCallback)((function(e){var t=b.searchedUsers,n=-1,a=t.length;if(0!==a){for(var i=0;i<a;i++)if(t[i].username===d){n=i;break}var r;r=-1===n?"prev"===e?t[a-1]:t[0]:"prev"===e?0===n?t[0]:t[n-1]:n===a-1?t[a-1]:t[n+1],l(r.username)}}),[b.searchedUsers,l,d]),_=Object(c.useCallback)((function(e){if("Escape"===e.key)p();else if("ArrowDown"===e.key)N("next");else if("ArrowUp"===e.key)N("prev");else if("Enter"===e.key){var t=b.searchedUsers[0],n=d||t&&t.username;n&&h(n)}}),[b.searchedUsers,d,N,p,h]),S=Object(c.useCallback)((function(e){e.stopPropagation();var t=e.currentTarget.dataset.username;t&&h(t)}),[h]);return u.a.createElement(u.a.Fragment,null,u.a.createElement(Xe.a,{placeholder:"\u8f93\u5165\u4f60\u60f3 @ \u7684\u7528\u6237",sizeType:"xs",value:n,onChange:O,onClick:j,onKeyDown:_,theme:"dark"===f?"darkSide":"light",inputRef:s}),0===(y=b.loading?Array(4).fill(0).map((function(e,t){return u.a.createElement(gt,{key:t})})):b.searchedUsers.map((function(e){return function(e){var t;return u.a.createElement(Ot,{key:e.username,"data-username":e.username,active:e.username===d,onClick:S},u.a.createElement(bt,{url:Object(Qe.b)(null!==(t=e.profile&&e.profile.userAvatar)&&void 0!==t?t:"",40)}),u.a.createElement(vt,null,u.a.createElement(yt,null,!!e.profile&&e.profile.realName),u.a.createElement(ht,null,e.username)))}(e)}))).length?null:u.a.createElement(mt,null,y))})),Nt=Object(V.a)("div",{target:"epuyubw0"})((function(e){return{position:"absolute",display:e.visible?"block":"none",top:e.top,left:e.left,zIndex:10}}),"label:MentionAnchorComp;"),_t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this.props.visible?this.props.children:null;return u.a.createElement(Nt,Object(a.__assign)({},this.props),e)},t}(u.a.PureComponent);!function(e){e.InlineCode="code-inline",e.CodeBlock="code",e.Link="link",e.BulletList="list",e.NumberList="number-list",e.Mention="at"}(ee||(ee={}));var St,Ct,It,xt=function(e){function t(t){var n=e.call(this,t)||this;return n.state={mentionInfo:{top:0,left:0,visible:!1}},n.$textarea=n.props.innerRef,n.baseScrollHeight=50,n.minRows=2,n.selectionEnd=(n.props.defaultValue||"").length,n.nameMap=n.props.defaultMeta?n.props.defaultMeta.nameMap:{},n.onChange=function(e){var t=e.currentTarget.value;n.changeValueAndReflow(t)},n.changeValueAndReflow=function(e,t){n.props.onChange(e,t),n.refreshTextAreaHeight()},n.onFocus=function(){n.hideMentionInput()},n.onBlur=function(){n.syncSelectionState()},n.onKeyDown=function(e){var t=e.key;setTimeout((function(){n.syncSelectionState(),"@"===t&&n.showMentionInput()}),18)},n.onInsertRule=function(e){var t=n.getRuleTemplate(e),a=n.$textarea.current;a&&(a.value=a.value.substr(0,n.selectionEnd)+t+a.value.substr(n.selectionEnd),n.selectionEnd=n.selectionEnd+t.length,n.changeValueAndReflow(a.value),e===ee.Mention?n.showMentionInput():n.focusSelf())},n.onMentionUser=function(e){var t=n.$textarea.current,a=e.profile.realName;t&&(t.value=t.value.substr(0,n.selectionEnd)+a+t.value.substr(n.selectionEnd),n.selectionEnd=n.selectionEnd+a.length,n.nameMap[e.profile.realName]=e.username,n.changeValueAndReflow(t.value,{nameMap:n.nameMap}),n.focusSelf())},n.hideMentionInput=function(){n.setState({mentionInfo:{visible:!1,top:0,left:0}})},n.initialTextArea=Ye()(n.initialTextArea),n}return Object(a.__extends)(t,e),t.prototype.componentDidMount=function(){this.parseCodeBlock(this.props.defaultValue),this.initialTextArea(),this.refreshTextAreaHeight(),this.props.setIconClickHandler(this.onInsertRule)},t.prototype.clear=function(){this.nameMap={},this.$textarea.current.value="",this.changeValueAndReflow("",{nameMap:this.nameMap})},t.prototype.render=function(){return u.a.createElement(u.a.Fragment,null,u.a.createElement(Ue,{ref:this.$textarea,placeholder:this.props.placeholder,onChange:this.onChange,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,defaultValue:this.props.defaultValue}),u.a.createElement(_t,Object(a.__assign)({},this.state.mentionInfo),u.a.createElement(jt,{topicId:this.props.topicId,hideSelf:this.hideMentionInput,onSearch:this.props.onSearchUsers,onMentionUser:this.onMentionUser})))},t.prototype.parseCodeBlock=function(e){void 0===e&&(e="");var t=this.$textarea.current;t&&(t.value=e.replace(/```(\S*)\n((.|\n)*?)```/g,(function(e,t,n){return!t&&n.length>15?"```"+w.a.highlightAuto(n).language+"\n"+n+"```":e})))},t.prototype.focusSelf=function(){var e=this.$textarea.current;e&&(e.focus(),e.selectionEnd=this.selectionEnd)},t.prototype.initialTextArea=function(){var e=this.$textarea.current;if(e){var t=e.value;e.value="",this.baseScrollHeight=e.scrollHeight,e.value=t}},t.prototype.syncSelectionState=function(){var e=this.$textarea.current;e&&(this.selectionEnd=e.selectionEnd)},t.prototype.refreshTextAreaHeight=function(){var e=this.$textarea.current;if(e){e.rows=this.minRows;var t=Math.ceil((e.scrollHeight-this.baseScrollHeight)/18),n=this.props.maxRow||Number.POSITIVE_INFINITY;e.rows=Math.min(n,this.minRows+t)}},t.prototype.getRuleTemplate=function(e){switch(e){case ee.InlineCode:return" `your inline code...` ";case ee.CodeBlock:return"\n```\ncode block\n```\n";case ee.Link:return"[\u529b\u6263](https://leetcode-cn.com)";case ee.BulletList:return"\n- \u65e0\u5e8f\u5217\u8868";case ee.NumberList:return"\n1. \u6709\u5e8f\u5217\u8868";case ee.Mention:return" @";default:return""}},t.prototype.showMentionInput=function(){var e=this.$textarea.current;if(e){var t=Je()(e,this.selectionEnd),n=t.top,a=t.left;this.setState({mentionInfo:{top:n-5,left:a+5,visible:!0}})}},t}(u.a.PureComponent);!function(e){e.Edit="edit",e.Preview="preview"}(It||(It={}));var Ft=((St={})[ee.InlineCode]="\u884c\u5185\u4ee3\u7801",St[ee.CodeBlock]="\u4ee3\u7801\u5757",St[ee.Link]="\u94fe\u63a5",St[ee.BulletList]="\u65e0\u5e8f\u5217\u8868",St[ee.NumberList]="\u6709\u5e8f\u5217\u8868",St[ee.Mention]="@\u7528\u6237",St),wt=((Ct={})[ee.InlineCode]=Pe,Ct[ee.CodeBlock]=Ee,Ct[ee.Link]=Re.a,Ct[ee.BulletList]=De.a,Ct[ee.NumberList]=Te,Ct[ee.Mention]=Be,Ct),Pt=Object(c.memo)((function(e){var t=Object(a.__read)(Object(c.useState)(It.Edit),2),n=t[0],i=t[1],r=Object(a.__read)(Object(c.useState)(e.defaultMeta),2),o=r[0],d=r[1],l=Object(a.__read)(Object(c.useState)(e.defaultValue||""),2),s=l[0],m=l[1],p=Object(a.__read)(Object(c.useState)(null),2),g=p[0],b=p[1],v=e.submitResult,k=e.onClose,f=e.onChange,y=e.onSubmit,h=e.onMockSubmit,O=Object(c.useRef)(null),j=Object(c.useRef)(null);Object(c.useEffect)((function(){v&&v.ok&&(i(It.Edit),m(""),d(void 0),O.current&&O.current.clear())}),[v]);var N=P(),_=Object(c.useCallback)((function(e){var t=e.currentTarget.dataset.mode;t&&i(t)}),[i]),S=Object(c.useCallback)((function(e,t){m(e),t&&d(t),f&&f(e,t)}),[f]),I=Object(c.useCallback)((function(){k&&k()}),[k]),x=Object(c.useCallback)((function(e){e.stopPropagation();var t=e.currentTarget.dataset.rule;t&&g&&g(t)}),[g]),F=Object(c.useCallback)((function(){y&&y(s,o)}),[y,s,o]),w=Object(c.useCallback)((function(){h&&h(s,o)}),[h,s,o]),E=Object(c.useCallback)((function(e){b((function(){return e}))}),[b]),R=function(e){var t=wt[e];return u.a.createElement(Ae.a,{content:Ft[e],placement:"top"},u.a.createElement(We,{"data-rule":e,size:"xs",kind:"ghost",prefixIcon:u.a.createElement(t,null),disabled:"preview"===n,onClick:x}))};return u.a.createElement(Me,{onClick:e.onClick},function(){if("edit"===n)return u.a.createElement(xt,{topicId:e.topicId,ref:O,innerRef:j,placeholder:e.placeholder,defaultValue:s,defaultMeta:o,maxRow:e.maxRow,onChange:S,onSearchUsers:e.onSearchUsers,setIconClickHandler:E});var t=o&&o.nameMap;t&&C(t);var a=N.render(s);return u.a.createElement(_e,null,u.a.createElement(Se,{dangerouslySetInnerHTML:{__html:a}}))}(),u.a.createElement($e,null,u.a.createElement(He,{isActive:"edit"===n,onClick:_,"data-mode":"edit"},"\u7f16\u8f91"),u.a.createElement(He,{isActive:"preview"===n,onClick:_,"data-mode":"preview"},"\u9884\u89c8"),u.a.createElement(Le,null,R(ee.InlineCode),R(ee.CodeBlock),R(ee.Link),R(ee.BulletList),R(ee.NumberList),R(ee.Mention)),u.a.createElement(ze,null),e.closable&&u.a.createElement(z.a,{size:"xs",type:"ghost",onClick:I},"\u53d6\u6d88"),u.a.createElement(Ve.a,{onConfirm:w,mockMode:Ve.b.Reply}),u.a.createElement(qe,{size:"xs",kind:"primary",onClick:F,disabled:e.isSubmitting},e.primaryBtnText||"\u8bc4\u8bba")))})),Et=n("HTDA"),Rt=Object(V.a)("div",{target:"equpptl0"})({height:"70px",border:"1px solid "+k.a.grey(2),borderRadius:"3px",background:k.a.grey(1),display:"flex",justifyContent:"center",alignItems:"center","& > div":{color:k.a.grey(6)},button:{margin:"0 10px"}},"label:Placeholder;");Rt.defaultProps=Object(a.__assign)(Object(a.__assign)({},Rt.defaultProps),{"data-cypress":"CommentPlaceHolder"});var Dt,Tt=n("U3QC"),Bt=n("wUZp"),At={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"createCnComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"topicId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"content"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mentionedUserSlugs"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"parentCommentId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createCnComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"content"},value:{kind:"Variable",name:{kind:"Name",value:"content"}}},{kind:"Argument",name:{kind:"Name",value:"topicId"},value:{kind:"Variable",name:{kind:"Name",value:"topicId"}}},{kind:"Argument",name:{kind:"Name",value:"mentionedUserSlugs"},value:{kind:"Variable",name:{kind:"Name",value:"mentionedUserSlugs"}}},{kind:"Argument",name:{kind:"Name",value:"parentCommentId"},value:{kind:"Variable",name:{kind:"Name",value:"parentCommentId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ok"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"error"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"comment"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"commentFields"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"commentFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CommentRelayNode"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numChildren"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isEdited"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"post"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteUpCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"creationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteStatus"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"author"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isDiscussAdmin"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userAvatar"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"realName"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"mentionedUsers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"nickName"},arguments:[],directives:[]}]}}]}}]}}],loc:{source:{body:'#import "../../fragments/comment.graphql"\n\nmutation createCnComment(\n  $topicId: Int!\n  $content: String!\n  $mentionedUserSlugs: [String]\n  $parentCommentId: Int\n) {\n  createCnComment(\n    content: $content\n    topicId: $topicId\n    mentionedUserSlugs: $mentionedUserSlugs\n    parentCommentId: $parentCommentId\n  ) {\n    ok\n    error\n    comment {\n      ...commentFields\n    }\n  }\n}\n'}},operationName:"createCnComment",defName:"createCnComment"},Vt={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"officialCreateCnComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"content"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mentionedUserSlugs"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"officialAccountSlug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"parentCommentId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"0"},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"topicId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"officialCreateCnComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"content"},value:{kind:"Variable",name:{kind:"Name",value:"content"}}},{kind:"Argument",name:{kind:"Name",value:"mentionedUserSlugs"},value:{kind:"Variable",name:{kind:"Name",value:"mentionedUserSlugs"}}},{kind:"Argument",name:{kind:"Name",value:"officialAccountSlug"},value:{kind:"Variable",name:{kind:"Name",value:"officialAccountSlug"}}},{kind:"Argument",name:{kind:"Name",value:"parentCommentId"},value:{kind:"Variable",name:{kind:"Name",value:"parentCommentId"}}},{kind:"Argument",name:{kind:"Name",value:"topicId"},value:{kind:"Variable",name:{kind:"Name",value:"topicId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ok"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"error"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"comment"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numChildren"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isEdited"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"post"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteUpCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"creationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteStatus"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"author"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isDiscussAdmin"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userAvatar"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"realName"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"mentionedUsers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"nickName"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{source:{body:"mutation officialCreateCnComment($content: String!, $mentionedUserSlugs: [String], $officialAccountSlug: String!, $parentCommentId: Int = 0, $topicId: Int!) {\n  officialCreateCnComment(content: $content, mentionedUserSlugs: $mentionedUserSlugs, officialAccountSlug: $officialAccountSlug, parentCommentId: $parentCommentId, topicId: $topicId) {\n    ok\n    error\n    comment {\n      id\n      numChildren\n      isEdited\n      post {\n        id\n        content\n        voteUpCount\n        creationDate\n        updationDate\n        status\n        voteStatus\n        author {\n          username\n          isDiscussAdmin\n          profile {\n            userSlug\n            userAvatar\n            realName\n          }\n        }\n        mentionedUsers {\n          key\n          username\n          userSlug\n          nickName\n        }\n      }\n    }\n  }\n}\n"}},operationName:"officialCreateCnComment",defName:"officialCreateCnComment"},Mt={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"updateCnComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"content"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mentionedUserSlugs"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"content"},value:{kind:"Variable",name:{kind:"Name",value:"content"}}},{kind:"Argument",name:{kind:"Name",value:"mentionedUserSlugs"},value:{kind:"Variable",name:{kind:"Name",value:"mentionedUserSlugs"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ok"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"error"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"comment"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"post"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mentionedUsers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"nickName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"comment"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isEdited"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{source:{body:"mutation updateCnComment(\n  $id: Int!\n  $content: String!\n  $mentionedUserSlugs: [String]\n) {\n  updateComment(\n    id: $id\n    content: $content\n    mentionedUserSlugs: $mentionedUserSlugs\n  ) {\n    ok\n    error\n    comment {\n      id\n      post {\n        id\n        content\n        mentionedUsers {\n          key\n          username\n          userSlug\n          nickName\n        }\n        comment {\n          id\n          isEdited\n        }\n      }\n    }\n  }\n}\n"}},operationName:"updateCnComment",defName:"updateComment"},Ut=n("L6nh");!function(e){e.TooShort="Your comment must be at least 3 characters long.",e.NotVerified="Not verified user"}(Dt||(Dt={}));var $t=function(e){function t(t){var n=e.call(this)||this;return n.client=t,n.defaultState={submitting:!1,submitResult:{ok:!1,comment:{},error:""}},n}var n,i,r,o,d,l,c,u;return Object(a.__extends)(t,e),t.prototype.setBeforeSubmit=function(){return{submitting:!0,submitResult:{ok:!1,comment:{},error:""}}},t.prototype.setSubmitting=function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{submitting:t})},t.prototype.setSubmitResult=function(e,t){var n=t.ok,i=t.comment,r=t.error;return Object(a.__assign)(Object(a.__assign)({},e),{submitResult:{ok:n||!1,comment:i||{},error:r||void 0},submitting:!1})},t.prototype.setUpdateResult=function(e,t){var n=t.ok,i=t.comment,r=t.error,o=i?{numChildren:0,isEdited:!1,post:i.post,id:String(i.id)}:{};return Object(a.__assign)(Object(a.__assign)({},e),{submitResult:{ok:n||!1,error:r||void 0,comment:o},submitting:!1})},t.prototype.submitReply=function(e){return this._reply(e,At)},t.prototype.mockSubmitReply=function(e){return this._reply(e,Vt)},t.prototype.updateComment=function(e){var t=this;return e.pipe(Object(rt.a)((function(e){var n=e.commentId,a=e.content,i=e.mentionedUserSlugs;return t.client.mutate({mutation:Mt,variables:{id:parseInt(n,10),content:a,mentionedUserSlugs:i}}).pipe(Object(ot.a)((function(e){var n=e.data;return n?t.getActions().setUpdateResult(n.updateComment):t.getActions().setSubmitting(!1)})),Object(dt.a)(t.getActions().setBeforeSubmit()))})))},t.prototype._reply=function(e,t){var n=this;return e.pipe(Object(rt.a)((function(e){return n.client.mutate({mutation:t,variables:Object(a.__assign)(Object(a.__assign)({},e),{parentCommentId:e.parentId?parseInt(e.parentId,10):void 0})}).pipe(Object(Bt.a)(),Object(ot.a)((function(e){var t=e.data;if(t)return"officialCreateCnComment"in t?t.officialCreateCnComment:"createCnComment"in t?t.createCnComment:void 0})),Object(Tt.a)((function(e){var t=n.getErrMsg(null===e||void 0===e?void 0:e.error);t&&Ce.b.error(t)})),Object(ot.a)((function(e){return e?n.getActions().setSubmitResult(e):n.getActions().setSubmitting(!1)})),Object(dt.a)(n.getActions().setBeforeSubmit()))})))},t.prototype.getErrMsg=function(e){if(!e)return"";switch(e){case Dt.TooShort:return"\u60a8\u7684\u8bc4\u8bba\u8fc7\u77ed";case Dt.NotVerified:return"\u8bf7\u5148\u9a8c\u8bc1\u60a8\u7684\u7535\u5b50\u90ae\u7bb1\u6216\u624b\u673a\u53f7";default:return"\u8bc4\u8bba\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"}},Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setBeforeSubmit",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Boolean]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setSubmitting",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setSubmitResult",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,"function"===typeof(n="undefined"!==typeof Ut.UpdateCnComment&&Ut.UpdateCnComment.UpdateComment)?n:Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setUpdateResult",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(i="undefined"!==typeof nt.a&&nt.a)?i:Object]),Object(a.__metadata)("design:returntype","function"===typeof(r="undefined"!==typeof nt.a&&nt.a)?r:Object)],t.prototype,"submitReply",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(o="undefined"!==typeof nt.a&&nt.a)?o:Object]),Object(a.__metadata)("design:returntype","function"===typeof(d="undefined"!==typeof nt.a&&nt.a)?d:Object)],t.prototype,"mockSubmitReply",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(l="undefined"!==typeof nt.a&&nt.a)?l:Object]),Object(a.__metadata)("design:returntype","function"===typeof(c="undefined"!==typeof nt.a&&nt.a)?c:Object)],t.prototype,"updateComment",null),t=Object(a.__decorate)([Object(Ze.a)(),Object(a.__metadata)("design:paramtypes",["function"===typeof(u="undefined"!==typeof lt.a&&lt.a)?u:Object])],t)}(tt.a),Ht=Object(c.memo)((function(e){var t=Object(a.__read)(Object(i.a)($t,{scope:Ie.a}),2),n=t[0],r=t[1],o=Object(a.__read)(Object(i.a)(Et.a),1)[0].currentOfficialAccount,d=Object(R.b)(),l=Object(xe.a)(Fe.m+e.userStatus.userSlug,{isSession:!0}),s=e.topicId,m=e.draftCacheKey,p=s+(void 0===m?"":m),g=l.get(p)||e.defaultValue;Object(c.useEffect)((function(){n.submitResult&&n.submitResult.ok&&e.onSubmitted&&e.onSubmitted(n.submitResult.comment)}),[n.submitResult]);var b=Object(c.useCallback)((function(){E.a.signIn({user:e.userStatus})}),[e.userStatus]),v=Object(c.useCallback)((function(t,n,i){E.a.ensurePhoneVerified(d((function(){var d,c=n&&Object.values(n.nameMap);if(t.length<3)Ce.b.error("\u8bc4\u8bba\u8fc7\u77ed");else{if(e.commentId)r.updateComment({commentId:e.commentId,content:t,mentionedUserSlugs:c}),e.tracker.submitComment("comment",c||[]);else{var u={content:t,topicId:e.topicId,parentId:e.parentId,mentionedUserSlugs:c};i?r.mockSubmitReply(Object(a.__assign)(Object(a.__assign)({},u),{officialAccountSlug:null!==(d=null===o||void 0===o?void 0:o.userSlug)&&void 0!==d?d:""})):r.submitReply(u),e.tracker.submitComment("reply",c||[])}l.remove(p)}})),{user:e.userStatus})()}),[e.commentId,e.topicId,e.parentId,e.userStatus,d,o]),k=Object(c.useCallback)((function(e,t){return v(e,t,!0)}),[v]),f=Object(c.useCallback)((function(e){l.set(p,e)}),[]);return e.userStatus.isSignedIn?u.a.createElement(Pt,{topicId:e.topicId,maxRow:10,primaryBtnText:e.commentId&&"\u786e\u5b9a",autoFocus:e.autoFocus,closable:!!e.parentId||!!e.commentId,defaultMeta:e.defaultMeta,defaultValue:g,submitResult:n.submitResult,isSubmitting:n.submitting,onClose:e.onCancel,onSubmit:v,onChange:f,onMockSubmit:k}):u.a.createElement(Rt,null,u.a.createElement("div",null,"\u8bf7\u5148",u.a.createElement(q.a,{kind:"primary",size:"xs",onClick:b},"\u767b\u5f55"),"\u540e\u53d1\u8868\u8bc4\u8bba"))})),zt=Object(c.memo)((function(e){var t=Object(c.useContext)(m.c),n=e.post,a=n.mentionedUsers,i={};return a&&a.forEach((function(e){e&&(i[e.nickName]=e.userSlug)})),e.shouldShowCommentEditor?u.a.createElement(Ht,{autoFocus:!0,topicId:e.topicId,commentId:e.commentId,defaultValue:n.content,defaultMeta:{nameMap:i},tracker:e.tracker,onCancel:e.onHideEditComment,onSubmitted:e.onHideEditComment,userStatus:t}):(C(i),u.a.createElement(Se,{dangerouslySetInnerHTML:{__html:P().render(n.content)}}))})),qt=n("nPqx"),Lt=Object(c.memo)((function(e){var t=e.parentId,n=e.numChildren,a=e.commentId,i=e.onDelete,r=Object(c.useCallback)((function(){i(t,a)}),[i,t,a]);return e.isAbleToMutate?u.a.createElement(qt.a,{visible:e.shouldShowDeleteConfirm,onClose:e.onHideDelete,onOk:r},n?"\u6b64\u8bc4\u8bba\u4e0b\u7684\u56de\u590d\u90fd\u4f1a\u88ab\u5220\u9664\uff0c\u60a8\u786e\u8ba4\u8981\u5220\u9664\u6b64\u8bc4\u8bba\u5417\uff1f":"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u6b64"+(t===a?"\u8bc4\u8bba":"\u56de\u590d")+"\u5417\uff1f"):null})),Wt=Object(c.memo)((function(e){var t,n=Object(c.useContext)(m.c),a=e.onSubmit,i=e.onHideReplyBox,r=e.comment.post.author.profile,o=r.userSlug,d=r.realName,l={nameMap:(t={},t[d]=o,t)},s=Object(c.useCallback)((function(e){a(e)}),[a]);return u.a.createElement(Ht,{autoFocus:!0,topicId:e.topicId,draftCacheKey:e.comment.id,defaultValue:"@"+d+" ",defaultMeta:l,tracker:e.tracker,parentId:e.parentId,onCancel:i,onSubmitted:s,userStatus:n})})),Kt=n("Y9Gt"),Yt=n("sOys"),Gt=n("b+y+"),Jt=Object(c.memo)((function(e){var t=Object(c.useContext)(m.c),n=e.comment,a=e.generateShareUrl,i=t.commonNojPermissionTypes.includes(g.yb.ColumnsReview),r=Object(c.useCallback)((function(){var e=a(n.id);O.a.copy(e,(function(){Ce.b.success("\u5df2\u590d\u5236\u5206\u4eab\u94fe\u63a5",1)}))}),[a,n]),o=function(a){var i=e.comment.post,r=i.voteStatus,o=i.voteUpCount,d=i.author,l=1===r,c=-1===r,s=t.userSlug===d.profile.userSlug,m="like"===a?l?0:1:c?0:-1,p=o+(l?-1:"like"===a?1:0),g="like"===a?o>0?o:"\u8d5e":"\u8e29",b="like"===a?l?"thumb-up":"thumb-up-o":c?"thumb-down":"thumb-down-o";return u.a.createElement(de,{icon:b,text:g,onClick:function(){e.toggleVote(n.post.id,m,p)},disabled:s})};return u.a.createElement(ue,{visible:!e.shouldShowReplyBox},o("like"),o("dislike"),u.a.createElement(de,{icon:"chat-o",text:u.a.createElement(se,{repliesCount:n.numChildren}),visible:!e.shouldRenderReplies&&n.numChildren>=1,onClick:e.onShowReplies}),u.a.createElement(de,{icon:"chat-o",text:"\u6536\u8d77\u56de\u590d",visible:e.shouldRenderReplies,onClick:e.onCloseReplies}),u.a.createElement(de,{icon:"reply-o",text:"\u56de\u590d",onClick:e.onShowReplyBox}),u.a.createElement(de,{icon:"share",text:"\u5206\u4eab",visible:e.shouldShowMoreTools,onClick:r}),u.a.createElement(de,{icon:"report",text:"\u4e3e\u62a5",visible:e.shouldShowMoreTools,onClick:e.toggleFlag}),e.isAbleToMutate&&u.a.createElement(de,{icon:"edit",text:"\u7f16\u8f91",isDanger:!!t.isSuperuser,visible:e.shouldShowMoreTools,onClick:e.editComment}),e.isAbleToMutate&&u.a.createElement(de,{icon:"bin",text:"\u5220\u9664",isDanger:!!t.isSuperuser,visible:e.shouldShowMoreTools,onClick:e.toggleDelete}),i&&e.shouldShowMoreTools&&u.a.createElement(Kt.a,{placement:"bottom",trigger:"click",content:u.a.createElement(Yt.a,null,u.a.createElement(Yt.a.Item,{key:"mute"},u.a.createElement(ce,{contentType:"Comment",id:parseInt(n.id,10)})))},u.a.createElement(le,{kind:"transparent",prefixIcon:u.a.createElement(Gt.a,null)})))})),Qt=n("9EWH"),Xt=n("pN2L"),Zt=n("eb+u"),en=n("BUlm"),tn=n("IMYO"),nn=n("rzNM"),an=n("Vw2C"),rn={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"commonTopicComments"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"topicId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"orderBy"}},type:{kind:"NamedType",name:{kind:"Name",value:"CommentOrderBy"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"skip"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"commonTopicComments"},arguments:[{kind:"Argument",name:{kind:"Name",value:"topicId"},value:{kind:"Variable",name:{kind:"Name",value:"topicId"}}},{kind:"Argument",name:{kind:"Name",value:"orderBy"},value:{kind:"Variable",name:{kind:"Name",value:"orderBy"}}},{kind:"Argument",name:{kind:"Name",value:"skip"},value:{kind:"Variable",name:{kind:"Name",value:"skip"}}},{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"IntValue",value:"15"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalNum"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"commentFields"},directives:[]}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"commentFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CommentRelayNode"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numChildren"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isEdited"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"post"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteUpCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"creationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteStatus"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"author"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isDiscussAdmin"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userAvatar"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"realName"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"mentionedUsers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"nickName"},arguments:[],directives:[]}]}}]}}]}}],loc:{source:{body:'#import "../../fragments/comment.graphql"\n\nquery commonTopicComments($topicId: Int!, $orderBy: CommentOrderBy, $skip: Int) {\n  commonTopicComments(\n    topicId: $topicId\n    orderBy: $orderBy\n    skip: $skip\n    first: 15\n  ) {\n    totalNum\n    edges {\n      node {\n        ...commentFields\n      }\n    }\n  }\n}\n'}},operationName:"commonTopicComments",defName:"commonTopicComments"},on={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"commentsSelection"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"topicId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"commentsSelection"},arguments:[{kind:"Argument",name:{kind:"Name",value:"topicId"},value:{kind:"Variable",name:{kind:"Name",value:"topicId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"commentFields"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"commentFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CommentRelayNode"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numChildren"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isEdited"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"post"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteUpCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"creationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteStatus"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"author"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isDiscussAdmin"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userAvatar"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"realName"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"mentionedUsers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"nickName"},arguments:[],directives:[]}]}}]}}]}}],loc:{source:{body:'#import "../../fragments/comment.graphql"\n\nquery commentsSelection($topicId: ID!) {\n  commentsSelection(topicId: $topicId) {\n    ...commentFields\n  }\n}\n'}},operationName:"commentsSelection",defName:"commentsSelection"},dn={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"commentPage"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"orderBy"}},type:{kind:"NamedType",name:{kind:"Name",value:"CommentOrderBy"}},defaultValue:{kind:"EnumValue",value:"HOT"},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"replyOrderBy"}},type:{kind:"NamedType",name:{kind:"Name",value:"CommentReplyOrderBy"}},defaultValue:{kind:"EnumValue",value:"OLD_TO_NEW"},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"numPerPage"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"15"},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"commentPage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"commentId"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}},{kind:"Argument",name:{kind:"Name",value:"orderBy"},value:{kind:"Variable",name:{kind:"Name",value:"orderBy"}}},{kind:"Argument",name:{kind:"Name",value:"replyOrderBy"},value:{kind:"Variable",name:{kind:"Name",value:"replyOrderBy"}}},{kind:"Argument",name:{kind:"Name",value:"numPerPage"},value:{kind:"Variable",name:{kind:"Name",value:"numPerPage"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pageNum"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"replyPageNum"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentId"},arguments:[],directives:[]}]}}]}}],loc:{source:{body:"query commentPage($commentId: ID!, $orderBy: CommentOrderBy = HOT, $replyOrderBy: CommentReplyOrderBy = OLD_TO_NEW, $numPerPage: Int = 15) {\n  commentPage(commentId: $commentId, orderBy: $orderBy, replyOrderBy: $replyOrderBy, numPerPage: $numPerPage) {\n    pageNum\n    replyPageNum\n    parentId\n  }\n}\n"}},operationName:"commentPage",defName:"commentPage"},ln={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"commentReplyConnection"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"orderBy"}},type:{kind:"NamedType",name:{kind:"Name",value:"CommentReplyOrderBy"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"skip"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"commentReplyConnection"},arguments:[{kind:"Argument",name:{kind:"Name",value:"commentId"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}},{kind:"Argument",name:{kind:"Name",value:"orderBy"},value:{kind:"Variable",name:{kind:"Name",value:"orderBy"}}},{kind:"Argument",name:{kind:"Name",value:"skip"},value:{kind:"Variable",name:{kind:"Name",value:"skip"}}},{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalNum"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"commentFields"},directives:[]}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"commentFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CommentRelayNode"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numChildren"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isEdited"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"post"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteUpCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"creationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updationDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteStatus"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"author"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isDiscussAdmin"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userAvatar"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"realName"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"mentionedUsers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userSlug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"nickName"},arguments:[],directives:[]}]}}]}}]}}],loc:{source:{body:'#import "../../fragments/comment.graphql"\n\nquery commentReplyConnection($commentId: ID!, $orderBy: CommentReplyOrderBy, $skip: Int, $first: Int) {\n  commentReplyConnection(commentId: $commentId, orderBy: $orderBy, skip: $skip, first: $first) {\n    totalNum\n    edges {\n      node {\n        ...commentFields\n      }\n    }\n  }\n}\n'}},operationName:"commentReplyConnection",defName:"commentReplyConnection"},cn={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"votePost"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"postId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"voteStatus"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"votePost"},arguments:[{kind:"Argument",name:{kind:"Name",value:"postId"},value:{kind:"Variable",name:{kind:"Name",value:"postId"}}},{kind:"Argument",name:{kind:"Name",value:"value"},value:{kind:"Variable",name:{kind:"Name",value:"voteStatus"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ok"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"error"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"value"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"post"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteStatus"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"voteUpCount"},arguments:[],directives:[]}]}}]}}]}}],loc:{source:{body:"mutation votePost($postId: Int!, $voteStatus: Int!) {\n  votePost(postId: $postId, value: $voteStatus) {\n    ok\n    error\n    value\n    post {\n      id\n      voteStatus\n      voteUpCount\n    }\n  }\n}\n"}},operationName:"votePost",defName:"votePost"},un={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"deleteComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ok"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"error"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"post"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]}]}}]}}]}}],loc:{source:{body:"mutation deleteComment($commentId: Int!) {\n  deleteComment(id: $commentId) {\n    ok\n    error\n    post {\n      id\n      status\n    }\n  }\n}\n"}},operationName:"deleteComment",defName:"deleteComment"};Object(Qt.d)();var sn,mn,pn={page:1,replyCount:0,orderBy:g.s.OldToNew,replies:[],loading:!1},gn=function(e){function t(t){var n=e.call(this)||this;return n.client=t,n.defaultState={topicId:null,totalNum:0,loadingComments:!1,currentPage:1,currentReplyPage:null,parentId:null,order:g.r.Hot,comments:{edges:[],totalNum:0},commentsSelection:[],topLevelNum:null,highlightCommentId:null,replyMap:new Map,replyingId:null,editingId:null},n}var n,i,r,o,d,l,c,u,s,m,p,b,v,k,f,y,h,O,j,N,_,S,C,I,x,F,w;return Object(a.__extends)(t,e),t.prototype.noop=function(e){return e},t.prototype.setTopicId=function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{topicId:t})},t.prototype.setOrderBy=function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{order:t})},t.prototype.setHighlightCommentId=function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{highlightCommentId:t})},t.prototype.setCurrentPage=function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{currentPage:t})},t.prototype.setTotalNumByDiff=function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{totalNum:e.totalNum+t})},t.prototype.setReplyingId=function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{replyingId:t})},t.prototype.setEditingId=function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{editingId:t})},t.prototype.updateTotalNum=function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{totalNum:t})},t.prototype.updateDetail=function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),t)},t.prototype.updatePageInfo=function(e,t){var n=t.pageNum,i=t.replyPageNum,r=t.parentId;return Object(a.__assign)(Object(a.__assign)({},e),{parentId:r,currentPage:n,currentReplyPage:i})},t.prototype.updateCommentReply=function(e,t){var n=t.data,a=t.commentId,i=t.loading,r=void 0!==i&&i,o=n.commentReplyConnection,d=e.replyMap,l=e.parentId,c=e.currentReplyPage,u=e.highlightCommentId;if(o){var s=o.edges,m=o.totalNum,p=s&&s.filter((function(e){return"Deleted"!==e.node.post.status})),b=d.get(a),v=u&&l===a&&c;e.replyMap=d.set(a,{page:v?c:b&&b.page||1,replyCount:m,orderBy:b&&b.orderBy||g.s.OldToNew,replies:p,loading:r}),v&&(e.currentReplyPage=null)}},t.prototype.updateCommentReplyLoading=function(e,t){var n=e.replyMap,i=n.get(t)||pn;e.replyMap=n.set(t,Object(a.__assign)(Object(a.__assign)({},i),{loading:!0}))},t.prototype.updateCommentReplyPage=function(e,t){var n=t.commentId,i=t.page,r=e.replyMap,o=r.get(n)||pn;e.replyMap=r.set(n,Object(a.__assign)(Object(a.__assign)({},o),{page:i}))},t.prototype.updateCommentReplyOrderBy=function(e,t){var n=t.commentId,i=t.orderBy,r=e.replyMap,o=r.get(n)||pn;e.replyMap=r.set(n,Object(a.__assign)(Object(a.__assign)({},o),{orderBy:i}))},t.prototype.updateCommentCount=function(e,t){var n=t.id,a=e.comments.edges.findIndex((function(e){return e.node.id===n})),i=e.commentsSelection.findIndex((function(e){return e.id===n}));-1!==a&&(e.comments.edges[a].node.numChildren+=1),-1!==i&&(e.commentsSelection[i].numChildren+=1),e.totalNum+=1},t.prototype.deleteReply=function(e,t){var n=t.id,a=t.parentId,i=e.replyMap;if(n!==a&&i.has(a)){var r=i.get(a),o=r.replies.findIndex((function(e){return e.node.id===n}));-1!==o&&r.replies.splice(o,1),r.replyCount-=1;var d=e.comments.edges.findIndex((function(e){return e.node.id===a})),l=e.commentsSelection.findIndex((function(e){return e.id===a}));-1!==d&&(e.comments.edges[d].node.numChildren-=1),-1!==l&&(e.commentsSelection[l].numChildren-=1)}},t.prototype.updateResetCommentReply=function(e,t){var n=e.replyMap;n.has(t)&&(e.replyMap=n.set(t,pn))},t.prototype.updateVoteCache=function(e,t){var n=t.commentId,i=t.parentId,r=t.status,o=t.newCount;if(n===i){var d=e.comments.edges.findIndex((function(e){return e.node.id===n})),l=e.commentsSelection.findIndex((function(e){return e.id===n})),c=Object(Qt.e)(e.comments,(function(e){-1!==d&&(e.edges[d].node.post.voteStatus=r,e.edges[d].node.post.voteUpCount=o)})),u=Object(Qt.e)(e.commentsSelection,(function(e){-1!==l&&(e[l].post.voteStatus=r,e[l].post.voteUpCount=o)}));return Object(a.__assign)(Object(a.__assign)({},e),{comments:c,commentsSelection:u})}var s=e.replyMap;if(!s.has(i))return e;var m=Object(Qt.e)(s.get(i),(function(e){var t=e.replies.findIndex((function(e){return e.node.id===n}));e.replies[t].node.post.voteStatus=r,e.replies[t].node.post.voteUpCount=o}));return s.set(i,m),Object(a.__assign)(Object(a.__assign)({},e),{replyMap:new Map(s)})},t.prototype.deleteCommentInState=function(e,t){e.commentsSelection=e.commentsSelection.filter((function(e){return e.post.id!==t})),e.comments.edges=e.comments.edges.filter((function(e){return e.node.post.id!==t}))},t.prototype.getTotalNum=function(e,t){var n=this;return e.pipe(Object(Zt.a)(t),Object(rt.a)((function(e){var t=Object(a.__read)(e,2)[1];return n.client.query({query:an.a,variables:{topicId:t.topicId}}).pipe(Object(ot.a)((function(e){var t=e.data;return t.topic?n.getActions().updateTotalNum(t.topic.commentCount):n.getActions().noop()})))})))},t.prototype.getCurrentPage=function(e,t){var n=this;return e.pipe(Object(Zt.a)(t),Object(rt.a)((function(e){var t,i=Object(a.__read)(e,2)[1],r=n.client.watchQuery({query:rn,fetchPolicy:"network-only",variables:{topicId:i.topicId,skip:15*(i.currentPage-1),orderBy:i.order}});return t=i.order===g.r.Hot&&1===i.currentPage?n.client.watchQuery({query:on,fetchPolicy:"network-only",variables:{topicId:String(i.topicId)}}).pipe(Object(ot.a)((function(e){var t=e.data;return t&&t.commentsSelection}))):Object(Xt.a)([]),r.pipe(Object(ot.a)((function(e){var t=e.data;return t&&t.commonTopicComments})),Object(en.a)(t),Object(ot.a)((function(e){var t=Object(a.__read)(e,2),i=t[0],r=t[1];if(i&&r){var o=i.edges;return n.getActions().updateDetail({loadingComments:!1,comments:Object(a.__assign)(Object(a.__assign)({},i),{edges:o.filter((function(e){return"Deleted"!==e.node.post.status}))}),commentsSelection:r.filter((function(e){return"Deleted"!==e.post.status})),topLevelNum:i.totalNum})}return n.getActions().noop()})),Object(dt.a)(n.getActions().updateDetail({loadingComments:!0})))})))},t.prototype.getPageInfo=function(e){var t=this;return e.pipe(Object(rt.a)((function(e){var n={pageNum:1,replyPageNum:null,parentId:null};return e?t.client.query({query:dn,variables:{commentId:e}}).pipe(Object(ot.a)((function(e){var t=e.data;return t.commentPage?{pageNum:t.commentPage.pageNum,replyPageNum:t.commentPage.replyPageNum,parentId:t.commentPage.parentId}:n})),Object(tn.a)((function(){return Object(Xt.a)(n)}))):Object(Xt.a)(n)})),Object(ot.a)((function(e){return t.getActions().updatePageInfo({pageNum:e.pageNum,replyPageNum:e.replyPageNum||null,parentId:e.parentId||null})})))},t.prototype.getCommentReply=function(e){var t=this;return e.pipe(Object(rt.a)((function(e){var n=e.commentId,a=e.page,i=e.orderBy;return t.client.watchQuery({query:ln,variables:{commentId:n,orderBy:i,first:10,skip:10*(a-1)},fetchPolicy:"network-only"}).pipe(Object(ot.a)((function(e){var a=e.data;return t.getActions().updateCommentReply({data:a,commentId:n})})),Object(dt.a)(t.getActions().updateCommentReplyLoading(n)))})))},t.prototype.vote=function(e){var t=this;return e.pipe(Object(nn.a)((function(e){var n=e.postId,a=e.status,i=e.newCount;return t.client.mutate({mutation:cn,variables:{postId:n,voteStatus:a},optimisticResponse:{votePost:{__typename:"VotePost",ok:!0,error:null,value:i,post:{__typename:"PostNode",id:n,voteStatus:i,voteUpCount:i}}}}).pipe(Object(ot.a)((function(){return t.getActions().noop()})))})))},t.prototype.deleteComment=function(e){var t=this;return e.pipe(Object(nn.a)((function(e){return t.client.mutate({mutation:un,variables:{commentId:e}}).pipe(Object(Bt.a)("\u5220\u9664\u5931\u8d25"),Object(ot.a)((function(e){var n=e.data;return t.getActions().deleteCommentInState(n.deleteComment.post.id)})))})))},t.prototype.searchUser=function(e){var t=this;return e.pipe(Object(nn.a)((function(e){var n=e.namePrefix,a=e.topicId;return t.client.query({query:ct,variables:{namePrefix:n,topicId:a}}).pipe(Object(ot.a)((function(e){var t=e.data.matchedUsers;return t||[]})),Object(ot.a)((function(e){return e.filter((function(e){return e&&!!e.profile&&!!e.profile.realName}))})),Object(ot.a)((function(){return t.getActions().noop()})))})))},Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"noop",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setTopicId",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,"function"===typeof(n="undefined"!==typeof g.r&&g.r)?n:Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setOrderBy",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setHighlightCommentId",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Number]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setCurrentPage",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Number]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setTotalNumByDiff",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setReplyingId",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"setEditingId",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Number]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"updateTotalNum",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,"function"===typeof(i="undefined"!==typeof Partial&&Partial)?i:Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"updateDetail",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"updatePageInfo",null),Object(a.__decorate)([Object(et.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(r="undefined"!==typeof Qt.Draft&&Qt.Draft)?r:Object,Object]),Object(a.__metadata)("design:returntype",void 0)],t.prototype,"updateCommentReply",null),Object(a.__decorate)([Object(et.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(o="undefined"!==typeof Qt.Draft&&Qt.Draft)?o:Object,String]),Object(a.__metadata)("design:returntype",void 0)],t.prototype,"updateCommentReplyLoading",null),Object(a.__decorate)([Object(et.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(d="undefined"!==typeof Qt.Draft&&Qt.Draft)?d:Object,Object]),Object(a.__metadata)("design:returntype",void 0)],t.prototype,"updateCommentReplyPage",null),Object(a.__decorate)([Object(et.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(l="undefined"!==typeof Qt.Draft&&Qt.Draft)?l:Object,Object]),Object(a.__metadata)("design:returntype",void 0)],t.prototype,"updateCommentReplyOrderBy",null),Object(a.__decorate)([Object(et.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(c="undefined"!==typeof Qt.Draft&&Qt.Draft)?c:Object,Object]),Object(a.__metadata)("design:returntype",void 0)],t.prototype,"updateCommentCount",null),Object(a.__decorate)([Object(et.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(u="undefined"!==typeof Qt.Draft&&Qt.Draft)?u:Object,Object]),Object(a.__metadata)("design:returntype",void 0)],t.prototype,"deleteReply",null),Object(a.__decorate)([Object(et.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(s="undefined"!==typeof Qt.Draft&&Qt.Draft)?s:Object,String]),Object(a.__metadata)("design:returntype",void 0)],t.prototype,"updateResetCommentReply",null),Object(a.__decorate)([Object(et.d)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object,Object]),Object(a.__metadata)("design:returntype",Object)],t.prototype,"updateVoteCache",null),Object(a.__decorate)([Object(et.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(m="undefined"!==typeof Qt.Draft&&Qt.Draft)?m:Object,Number]),Object(a.__metadata)("design:returntype",void 0)],t.prototype,"deleteCommentInState",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(p="undefined"!==typeof nt.a&&nt.a)?p:Object,"function"===typeof(b="undefined"!==typeof nt.a&&nt.a)?b:Object]),Object(a.__metadata)("design:returntype","function"===typeof(v="undefined"!==typeof nt.a&&nt.a)?v:Object)],t.prototype,"getTotalNum",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(k="undefined"!==typeof nt.a&&nt.a)?k:Object,"function"===typeof(f="undefined"!==typeof nt.a&&nt.a)?f:Object]),Object(a.__metadata)("design:returntype","function"===typeof(y="undefined"!==typeof nt.a&&nt.a)?y:Object)],t.prototype,"getCurrentPage",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(h="undefined"!==typeof nt.a&&nt.a)?h:Object]),Object(a.__metadata)("design:returntype","function"===typeof(O="undefined"!==typeof nt.a&&nt.a)?O:Object)],t.prototype,"getPageInfo",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(j="undefined"!==typeof nt.a&&nt.a)?j:Object]),Object(a.__metadata)("design:returntype","function"===typeof(N="undefined"!==typeof nt.a&&nt.a)?N:Object)],t.prototype,"getCommentReply",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(_="undefined"!==typeof nt.a&&nt.a)?_:Object]),Object(a.__metadata)("design:returntype","function"===typeof(S="undefined"!==typeof nt.a&&nt.a)?S:Object)],t.prototype,"vote",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(C="undefined"!==typeof nt.a&&nt.a)?C:Object]),Object(a.__metadata)("design:returntype","function"===typeof(I="undefined"!==typeof nt.a&&nt.a)?I:Object)],t.prototype,"deleteComment",null),Object(a.__decorate)([Object(et.b)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",["function"===typeof(x="undefined"!==typeof nt.a&&nt.a)?x:Object]),Object(a.__metadata)("design:returntype","function"===typeof(F="undefined"!==typeof nt.a&&nt.a)?F:Object)],t.prototype,"searchUser",null),t=Object(a.__decorate)([Object(Ze.a)(),Object(a.__metadata)("design:paramtypes",["function"===typeof(w="undefined"!==typeof lt.a&&lt.a)?w:Object])],t)}(tt.a),bn=Object(A.d)(sn||(sn=Object(a.__makeTemplateObject)(["\n  0% {\n    bottom: 0;\n  }\n  100% {\n    bottom: -800%;\n  }\n"],["\n  0% {\n    bottom: 0;\n  }\n  100% {\n    bottom: -800%;\n  }\n"]))),vn=function(e){var t="white"===e.type;return{backgroundColor:t?k.a.grey(0):k.a.grey(2),position:"relative",overflow:"hidden","&::before":{content:'""',borderRadius:"3px",position:"absolute",width:"100%",height:"900%",bottom:0,backgroundImage:"linear-gradient(5deg, "+(t?k.a.grey(0):k.a.grey(1))+" 30%, "+(t?k.a.grey(1):k.a.grey(0))+" 50%, "+(t?k.a.grey(0):k.a.grey(1))+" 70%)",animation:bn+" 1.4s linear infinite"}}},kn=Object(V.a)("div",{target:"e1hucbtw0"})({display:"flex",flexDirection:"column",margin:"20px 0 0",width:"100%","&:nth-last-type-of(1)":{marginBottom:"20px"}},"label:LoadingCard;"),fn=Object(V.a)("div",{target:"e1hucbtw1"})({display:"flex",alignItems:"center"},"label:HeadRow;"),yn=Object(V.a)("div",{target:"e1hucbtw2"})(vn,{width:"32px",height:"32px",borderRadius:"50%"},"label:LoadingcardImage;"),hn={height:"15px"},On=Object(V.a)("div",{target:"e1hucbtw3"})(vn,Object(a.__assign)(Object(a.__assign)({},hn),{flex:"0 1 100px",margin:"0 0 0 10px"}),"label:Row1;"),jn=Object(V.a)("div",{target:"e1hucbtw4"})(vn,Object(a.__assign)(Object(a.__assign)({},hn),{width:"100%",margin:"10px 0 0"}),"label:Row2;"),Nn=Object(V.a)("div",{target:"e1hucbtw5"})(vn,Object(a.__assign)(Object(a.__assign)({},hn),{width:"100%",maxWidth:"200px",margin:"10px 0 0"}),"label:Row3;"),_n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(a.__extends)(t,e),t.prototype.render=function(){return u.a.createElement(kn,null,u.a.createElement(fn,null,u.a.createElement(yn,{type:this.props.type}),u.a.createElement(On,{type:this.props.type})),u.a.createElement(jn,{type:this.props.type}),u.a.createElement(Nn,{type:this.props.type}))},t.defaultProps={type:"gray"},t}(u.a.PureComponent),Sn=Object(c.memo)((function(e){var t=Object(a.__read)(Object(c.useState)(!1),2),n=t[0],r=t[1],o=Object(a.__read)(Object(c.useState)(!1),2),d=o[0],l=o[1],s=Object(a.__read)(Object(c.useState)(!!e.shouldRenderReplies),2),b=s[0],v=s[1],h=Object(a.__read)(Object(c.useState)(!1),2),j=h[0],N=h[1],_=Object(c.useRef)(null),S=Object(a.__read)(Object(i.a)(gn,{scope:e.topicId}),2),C=S[0],I=S[1],x=Object(c.useContext)(m.c),F=Object(R.b)(),w=e.comment,P=w.id,B=w.post,A=w.isEdited,V=B.author,M=e.parentId||P,U=C.replyMap,$=(e.level>0?U.get(P):U.get(e.parentId))||{},H=$.page,z=void 0===H?1:H,q=$.replyCount,L=void 0===q?0:q,W=$.orderBy,K=void 0===W?g.s.OldToNew:W;Object(c.useEffect)((function(){O.a.prepare(),b&&I.getCommentReply({commentId:P,page:z,orderBy:K})}),[b,P,z,K]),Object(c.useEffect)((function(){e.comment.id===C.highlightCommentId&&requestAnimationFrame((function(){_.current&&_.current.scrollIntoView({behavior:"smooth",block:"center"})}))}),[C.highlightCommentId]),Object(c.useEffect)((function(){P===C.parentId&&C.highlightCommentId&&v(!0)}),[P,C.parentId,C.highlightCommentId]);var G=x.userSlug===V.profile.userSlug||!!x.isSuperuser,J=function(){v(!1)},Q=Object(c.useCallback)((function(e){I.updateCommentReplyOrderBy({commentId:P,orderBy:e})}),[P]),X=Object(c.useCallback)((function(e){I.updateCommentReplyPage({commentId:P,page:e})}),[P]);return u.a.createElement(u.a.Fragment,null,u.a.createElement(Lt,{isAbleToMutate:G,parentId:M,shouldShowDeleteConfirm:n,commentId:P,numChildren:e.comment.numChildren||0,onDelete:function(t,n){var a=t!==n;I.deleteComment(parseInt(n,10)),a&&I.deleteReply({id:n,parentId:t}),I.setTotalNumByDiff(-1),r(!1),e.tracker.confirmDeleteComment(t===n?void 0:t)},onHideDelete:function(){r(!1),e.tracker.cancelDeleteComment(M===P?void 0:M)}}),u.a.createElement(D.a,{visible:j,onClose:function(){N(!1)},resourceType:g.Mb.Comment,resourceId:P}),u.a.createElement(Y,{ref:_,highlight:P===C.highlightCommentId,onMouseEnter:function(){l(!0)},onMouseLeave:function(){l(!1)}},u.a.createElement(te,null,u.a.createElement(ne,null,u.a.createElement("a",{href:f.a.main.paths.publicProfile.home({userSlug:V.profile.userSlug}),target:"_blank"},u.a.createElement(ae,{src:V.profile.userAvatar,alt:V.username}),u.a.createElement(T.a,{userSlug:V.profile.userSlug,realName:V.profile.realName+(e.topicAuthorSlug===V.profile.userSlug?" (\u4f5c\u8005)":""),defaultColor:k.a.grey(7),className:ie}))),u.a.createElement(re,{"data-status":B.status},"Deleted"===B.status&&"\u5df2\u5220\u9664","Pending"===B.status&&"\u5ba1\u6838\u4e2d",A&&"\uff08\u7f16\u8f91\u8fc7\uff09",["Deleted","Pending"].indexOf(B.status)<0&&Object(y.a)(1e3*B.creationDate))),u.a.createElement(p.a,null,u.a.createElement(zt,{topicId:C.topicId,commentId:P,post:B,shouldShowCommentEditor:C.editingId===P,onHideEditComment:function(){I.setEditingId(null)},tracker:e.tracker})),u.a.createElement(p.a,{css:me},u.a.createElement(Jt,{comment:e.comment,shouldRenderReplies:b,shouldShowReplyBox:C.replyingId===P,shouldShowMoreTools:d,isAbleToMutate:G,generateShareUrl:e.generateShareUrl,onShowReplyBox:function(){E.a.ensurePhoneVerified((function(){I.setReplyingId(P)}),{user:x})()},onShowReplies:function(){v(!0)},onCloseReplies:J,toggleVote:function(e,t,n){E.a.ensureVerified(F((function(){I.vote({postId:e,status:t,newCount:n}),I.updateVoteCache({commentId:P,parentId:M,postId:e,status:t,newCount:n})}),[g.n.Posting]),{user:x})()},toggleFlag:function(){E.a.ensureVerified((function(){N(!0)}),{user:x})()},toggleDelete:function(){r(!0),e.tracker.deleteComment(M===P?void 0:M)},editComment:function(){I.setEditingId(P)}})),C.replyingId===P&&u.a.createElement(Wt,{comment:e.comment,topicId:C.topicId,tracker:e.tracker,parentId:M,onSubmit:function(t){I.setReplyingId(null);var n=e.level>0?P:e.parentId;I.updateCommentCount({comment:t,id:n}),1===z&&K===g.s.NewToOld?I.getCommentReply({commentId:n,page:z,orderBy:K}):(I.updateCommentReplyPage({commentId:n,page:1}),I.updateCommentReplyOrderBy({commentId:n,orderBy:g.s.NewToOld})),function(e){I.setHighlightCommentId(e)}(t.id),v(!0)},onHideReplyBox:function(){I.setReplyingId(null),e.tracker.cancelComment()}}),b&&e.level>0&&u.a.createElement(xn,{topicAuthorSlug:e.topicAuthorSlug,activeOption:K,onOptionClick:Q,commentId:P,reply:$,generateShareUrl:e.generateShareUrl,tracker:e.tracker,page:z,totalNum:L,setRepliesPage:X,hideReplies:J,resetCommentReply:function(){I.updateResetCommentReply(P)},level:e.level,topicId:e.topicId})))})),Cn=(mn=new h,function(e){var t=Object(a.__read)(Object(c.useState)(!1),2),n=t[0],i=t[1],r=e.maxReplyDepth,o=Object(a.__rest)(e,["maxReplyDepth"]);return Object(c.useEffect)((function(){var t=mn.add((function(){var t=e.comment.post,n=t.content,a=t.mentionedUsers,i={};a&&a.forEach((function(e){e&&(i[e.nickName]=e.userSlug)})),C(i),P().render(n)})),n=mn.add((function(){i(!0)}));return function(){t(),n()}}),[]),n?u.a.createElement(Sn,Object(a.__assign)({level:r},o)):null}),In=Object(c.memo)((function(e){var t=e.reply,n=t.replies,a=void 0===n?[]:n,i=t.loading,r=void 0===i||i,d=Object(v.a)().getUsernameConfigs,l=a.map((function(t){return u.a.createElement(Sn,{key:t.node.id,topicAuthorSlug:e.topicAuthorSlug,comment:t.node,parentId:e.commentId,generateShareUrl:e.generateShareUrl,level:e.level-1,tracker:e.tracker,topicId:e.topicId})}));return Object(c.useEffect)((function(){var e=a.map((function(e){var t,n;return null===(n=null===(t=e.node)||void 0===t?void 0:t.post.author)||void 0===n?void 0:n.profile.userSlug}));d(o()(e))}),[d,a]),r?u.a.createElement(oe,null,u.a.createElement(_n,null),u.a.createElement(_n,null)):u.a.createElement(oe,null,l)})),xn=Object(c.memo)((function(e){return u.a.createElement(pe,null,u.a.createElement(ke,{activeOption:e.activeOption,onOptionClick:e.onOptionClick}),u.a.createElement(In,{topicAuthorSlug:e.topicAuthorSlug,orderBy:e.activeOption,commentId:e.commentId,reply:e.reply,tracker:e.tracker,generateShareUrl:e.generateShareUrl,hideReplies:e.hideReplies,level:e.level,topicId:e.topicId}),u.a.createElement(he,{page:e.page,totalNum:e.totalNum,setRepliesPage:e.setRepliesPage,hideReplies:e.hideReplies,resetCommentReply:e.resetCommentReply}))})),Fn=Object(V.a)("div",{target:"ei9q7no0"})(je.a.disable,{margin:"30px 0 50px",textAlign:"center",fontSize:"20px",lineHeight:1.4},"label:EmptyPlaceHolder;"),wn=Object(V.a)("div",{target:"ei9q7no1"})({display:"flex",alignItems:"stretch",flexDirection:"column",minHeight:"100%",WebkitOverflowScrolling:"touch"},"label:DiscussWrapper;"),Pn=Object(V.a)("div",{target:"ei9q7no2"})({display:"flex",flex:"0 0 auto",flexDirection:"column"},"label:DiscussContent;");Pn.defaultProps=Object(a.__assign)(Object(a.__assign)({},Pn.defaultProps),{"data-cypress":"DiscussContent"});var En=Object(V.a)((function(e){var t=e.className,n=Object(a.__rest)(e,["className"]);return u.a.createElement("div",{className:t,"data-cypress":"CommentPagination"},u.a.createElement(fe.a,Object(a.__assign)({},n)))}),{target:"ei9q7no3"})({margin:"30px 0",display:"flex",justifyContent:"center"},"label:CommentPagination;"),Rn=Object(V.a)("div",{target:"ei9q7no4"})(je.a.disable,{position:"relative",margin:"10px 0",textAlign:"center","&::before, &::after":{position:"absolute",top:"10px",content:'""',width:"calc(50% - 60px)",height:"1px",background:"currentColor"},"&::before":{left:0},"&::after":{right:0}},"label:CommentsHead;"),Dn=n("5ZzG"),Tn=n("rF4R"),Bn=n("P4jA"),An=[{name:"\u6700\u70ed",key:g.r.Hot},{name:"\u6700\u65b0",key:g.r.NewToOld},{name:"\u6700\u65e9",key:g.r.OldToNew}],Vn=u.a.memo((function(e){var t=e.activeOption,n=e.onOptionSelect,i=Object(a.__read)(u.a.useState(!1),2),r=i[0],o=i[1],d=u.a.useCallback((function(e){n(e),o(!1)}),[n,o]);return u.a.createElement(Tn.a,{trigger:"click",placement:"bottom-end",isActive:r,onChangeActive:o,content:u.a.createElement(Bn.a,{onSelect:d,selectedKey:t},An.map((function(e){var t=e.name,n=e.key;return u.a.createElement(Bn.a.Item,{key:n},t)})))},u.a.createElement(q.a,{suffixIcon:u.a.createElement(Dn.a,{type:"rank"}),kind:"transparent",size:"xs"},An[An.findIndex((function(e){return e.key===t}))].name))})),Mn=Object(V.a)("div",{target:"e4aog6i0"})({display:"flex",alignItems:"center",flex:"0 0 auto"},"label:TopPart;"),Un=Object(V.a)("div",{target:"e4aog6i1"})({flex:"1 1 auto",display:"flex",height:"42px",alignItems:"center",fontSize:"13px",color:k.a.grey(7)},"label:CommentInfo;"),$n=Object(V.a)("div",{target:"e4aog6i2"})({marginRight:"5px",fontSize:"20px",fontFamily:"FetteMittelschrift, sans-serif"},"label:CommentNum;"),Hn=Object(V.a)(Dn.a,{target:"e4aog6i3"})({width:"14px",height:"14px",marginLeft:"4px"},"label:Icon;"),zn=Object(V.a)("div",{target:"e4aog6i4"})({padding:"0 0 20px"},"label:EditorWrapper;"),qn=Object(c.memo)((function(e){return u.a.createElement(u.a.Fragment,null,u.a.createElement(Mn,null,u.a.createElement(Un,null,u.a.createElement($n,null,null!==e.commentNum?e.commentNum:"-"),"\u6761\u8bc4\u8bba",u.a.createElement(Hn,{type:"debug"})),u.a.createElement(Vn,{activeOption:e.orderBy,onOptionSelect:e.onChangeOrderBy})),e.isActive&&u.a.createElement(zn,null,u.a.createElement(p.a,null,u.a.createElement(Ht,{topicId:e.topicId,tracker:e.tracker,onSubmitted:e.onSubmitted,userStatus:e.userStatus}))))})),Ln=Object(c.memo)((function(e){var t=Object(a.__read)(Object(i.a)(gn,{scope:e.topicId}),1)[0],n=Object(v.a)().getUsernameConfigs,r=function(n){return n?u.a.createElement(p.a,{key:n.id},u.a.createElement(Cn,{topicAuthorSlug:e.topicAuthorSlug,comment:n,shouldRenderReplies:n.id===t.parentId,generateShareUrl:e.generateShareUrl,tracker:e.tracker,maxReplyDepth:1,topicId:e.topicId})):null},d=t.comments.edges,m=t.commentsSelection,g=m&&m.length?m.map(r):null,b=l()(o()(d).map((function(e){return e.node})),m,"id").map(r);return Object(c.useEffect)((function(){var e=o()(d).map((function(e){var t,n;return null===(n=null===(t=e.node)||void 0===t?void 0:t.post.author)||void 0===n?void 0:n.profile.userSlug}));n(o()(e))}),[d,n]),t.loadingComments?u.a.createElement(u.a.Fragment,null,u.a.createElement(_n,null),u.a.createElement(_n,null)):d.length?u.a.createElement(Pn,null,!!g&&u.a.createElement(Rn,null,"\u7cbe\u9009\u8bc4\u8bba(",m.length,")"),g,!!g&&u.a.createElement(Rn,null,"\u8bc4\u8bba(",Object(s.b)(t.totalNum||0),")"),b):u.a.createElement(Fn,null,"\u6682\u65e0\u8bc4\u8bba")})),Wn=Object(c.memo)((function(e){var t,n=e.topicId,r=Object(a.__read)(Object(i.a)(gn,{scope:n}),2),o=r[0],d=r[1];return o.loadingComments||null!==o.topLevelNum&&o.topLevelNum<=15?null:u.a.createElement(p.a,null,u.a.createElement(En,{current:o.currentPage,numPerPage:15,totalNum:null!==(t=o.topLevelNum)&&void 0!==t?t:0,onChange:function(e){e!==o.currentPage&&d.setCurrentPage(e)}}))})),Kn=Object(c.memo)((function(e){var t=Object(a.__read)(Object(i.a)(gn,{scope:e.topicId}),2),n=t[0],r=t[1],o=Object(c.useContext)(m.c);Object(c.useEffect)((function(){e.isActive&&(r.setTopicId(e.topicId),r.getCurrentPage(),r.getTotalNum())}),[e.isActive,e.topicId,n.order,n.currentPage]),Object(c.useEffect)((function(){var t;e.isActive&&((t=e.sharedCommentId)&&/^\d+$/.test(t))&&r.getPageInfo(e.sharedCommentId)}),[e.isActive,e.sharedCommentId]),Object(c.useEffect)((function(){r.setHighlightCommentId(e.sharedCommentId)}),[e.sharedCommentId]);var d=Object(c.useMemo)((function(){return"function"===typeof e.generateDescription?u.a.createElement(b.a,Object(a.__assign)({},e.generateDescription(n))):null}),[e.generateDescription,n]);return u.a.createElement(u.a.Fragment,null,d,u.a.createElement(wn,null,u.a.createElement(p.a,null,u.a.createElement(qn,{isActive:e.isActive,topicId:e.topicId,commentNum:n.totalNum,orderBy:n.order,tracker:e.tracker,onSubmitted:function(e){r.setHighlightCommentId(e.id),r.setTotalNumByDiff(1),n.order===g.r.NewToOld&&1===n.currentPage?r.getCurrentPage():(r.setOrderBy(g.r.NewToOld),r.setCurrentPage(1))},onChangeOrderBy:function(e){r.setOrderBy(e)},userStatus:o})),u.a.createElement(Ln,Object(a.__assign)({},e,{userStatus:o})),u.a.createElement(Wn,{topicId:e.topicId})))}))},kCEr:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"d",(function(){return k})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return y}));var a,i,r,o,d=n("D57K"),l=n("f7k3"),c=n("fgAA"),u=n("T/5y"),s=n("6LfN"),m=n("dxiE"),p=n("7a+J"),g=n("txck"),b=Object(l.b)(a||(a=Object(d.__makeTemplateObject)(["\n  .ant-pagination {\n    &.ant-table-pagination-right {\n      margin-right: 8px;\n    }\n\n    .ant-pagination-prev,\n    .ant-pagination-next {\n      button {\n        ",";\n        ",";\n      }\n    }\n\n    .ant-pagination-item-ellipsis,\n    .ant-pagination-item-link-icon {\n      ",";\n    }\n\n    .ant-pagination-item {\n      ",";\n      a {\n        ",";\n      }\n    }\n\n    .ant-pagination-options {\n      .ant-select {\n        .ant-select-selection {\n          ",";\n          ",";\n\n          .ant-select-arrow {\n            ",";\n          }\n        }\n      }\n    }\n  }\n"],["\n  .ant-pagination {\n    &.ant-table-pagination-right {\n      margin-right: 8px;\n    }\n\n    .ant-pagination-prev,\n    .ant-pagination-next {\n      button {\n        ",";\n        ",";\n      }\n    }\n\n    .ant-pagination-item-ellipsis,\n    .ant-pagination-item-link-icon {\n      ",";\n    }\n\n    .ant-pagination-item {\n      ",";\n      a {\n        ",";\n      }\n    }\n\n    .ant-pagination-options {\n      .ant-select {\n        .ant-select-selection {\n          ",";\n          ",";\n\n          .ant-select-arrow {\n            ",";\n          }\n        }\n      }\n    }\n  }\n"])),u.a.layer1,g.a.title,g.a.title,u.a.layer1,g.a.title,u.a.layer1,g.a.title,g.a.title),v=s.a.level2((function(e){return{borderColor:e}})),k=Object(l.b)(i||(i=Object(d.__makeTemplateObject)(["\n  .ant-table,\n  .ant-table.ant-table-bordered {\n    ",";\n\n    & > .ant-table-container {\n      ",";\n    }\n\n    table {\n      ",";\n    }\n\n    .ant-table-placeholder {\n      background: transparent;\n      border: none;\n    }\n\n    .ant-table-tbody > tr > td {\n      white-space: nowrap;\n      ",";\n      color: ",";\n      &.ant-table-column-sort {\n        ",";\n      }\n    }\n\n    .ant-table-tbody > tr:hover:not(.ant-table-expanded-row):not(.ant-table-row-selected) > td {\n      ",";\n    }\n\n    .ant-table-thead > tr > th {\n      ",";\n      ",";\n      white-space: nowrap;\n      border-bottom: 1px solid;\n      ",";\n    }\n\n    .ant-table-thead > tr > th.ant-table-column-has-actions.ant-table-column-has-filters {\n      .anticon-filter,\n      .ant-table-filter-icon {\n        color: ",";\n        background: ",";\n\n        &:hover,\n        &.ant-table-filter-open {\n          color: ",";\n          background: ",";\n        }\n      }\n    }\n\n    .ant-table-thead > tr > th .ant-table-column-sorter .ant-table-column-sorter-inner {\n      .ant-table-column-sorter-up,\n      .ant-table-column-sorter-down {\n        &.on {\n          color: ",";\n        }\n      }\n    }\n\n    .ant-table-thead > tr > th.ant-table-column-has-actions.ant-table-column-has-sorters:hover,\n    .ant-table-thead > tr > th.ant-table-column-has-actions.ant-table-column-has-sorters:hover .ant-table-filter-icon,\n    .ant-table-thead > tr > th.ant-table-column-has-actions.ant-table-column-has-sorters:hover .anticon-filter {\n      ",";\n    }\n\n    .ant-table-thead > tr > th .ant-table-header-column .ant-table-column-sorters:hover::before {\n      ",";\n    }\n\n    .ant-empty-normal {\n      ","\n    }\n\n    .ant-table-footer {\n      ",";\n      border-top: 1px solid ",";\n\n      &::before {\n        ",";\n      }\n    }\n\n    .ant-btn-link {\n      &,\n      &:hover,\n      &:focus,\n      &:active {\n        color: ",";\n\n        &[disabled] {\n          color: ",";\n        }\n      }\n    }\n  }\n"],["\n  .ant-table,\n  .ant-table.ant-table-bordered {\n    ",";\n\n    & > .ant-table-container {\n      ",";\n    }\n\n    table {\n      ",";\n    }\n\n    .ant-table-placeholder {\n      background: transparent;\n      border: none;\n    }\n\n    .ant-table-tbody > tr > td {\n      white-space: nowrap;\n      ",";\n      color: ",";\n      &.ant-table-column-sort {\n        ",";\n      }\n    }\n\n    .ant-table-tbody > tr:hover:not(.ant-table-expanded-row):not(.ant-table-row-selected) > td {\n      ",";\n    }\n\n    .ant-table-thead > tr > th {\n      ",";\n      ",";\n      white-space: nowrap;\n      border-bottom: 1px solid;\n      ",";\n    }\n\n    .ant-table-thead > tr > th.ant-table-column-has-actions.ant-table-column-has-filters {\n      .anticon-filter,\n      .ant-table-filter-icon {\n        color: ",";\n        background: ",";\n\n        &:hover,\n        &.ant-table-filter-open {\n          color: ",";\n          background: ",";\n        }\n      }\n    }\n\n    .ant-table-thead > tr > th .ant-table-column-sorter .ant-table-column-sorter-inner {\n      .ant-table-column-sorter-up,\n      .ant-table-column-sorter-down {\n        &.on {\n          color: ",";\n        }\n      }\n    }\n\n    .ant-table-thead > tr > th.ant-table-column-has-actions.ant-table-column-has-sorters:hover,\n    .ant-table-thead > tr > th.ant-table-column-has-actions.ant-table-column-has-sorters:hover .ant-table-filter-icon,\n    .ant-table-thead > tr > th.ant-table-column-has-actions.ant-table-column-has-sorters:hover .anticon-filter {\n      ",";\n    }\n\n    .ant-table-thead > tr > th .ant-table-header-column .ant-table-column-sorters:hover::before {\n      ",";\n    }\n\n    .ant-empty-normal {\n      ","\n    }\n\n    .ant-table-footer {\n      ",";\n      border-top: 1px solid ",";\n\n      &::before {\n        ",";\n      }\n    }\n\n    .ant-btn-link {\n      &,\n      &:hover,\n      &:focus,\n      &:active {\n        color: ",";\n\n        &[disabled] {\n          color: ",";\n        }\n      }\n    }\n  }\n"])),u.a.layer1,v,v,v,c.a.grey(7),u.a.layer1,u.a.overlay,g.a.title,u.a.overlay,v,c.a.grey(9,.6),c.a.grey(9,0),c.a.grey(9,.6),c.a.grey(9,.04),c.a.primary(5),m.b,m.b,g.a.secondary,u.a.layer1,c.a.grey(4),u.a.layer1,c.a.grey(7),c.a.grey(5)),f=Object(l.b)(r||(r=Object(d.__makeTemplateObject)(["\n  .ant-select-dropdown {\n    ",";\n    ",";\n\n    .ant-select-dropdown-menu-item {\n      ",";\n    }\n\n    .ant-select-dropdown-menu-item-selected {\n      ",";\n      color: ",";\n    }\n\n    .ant-select-dropdown-menu-item:hover:not(.ant-select-dropdown-menu-item-disabled) {\n      ",";\n      background-color: unset;\n    }\n  }\n"],["\n  .ant-select-dropdown {\n    ",";\n    ",";\n\n    .ant-select-dropdown-menu-item {\n      ",";\n    }\n\n    .ant-select-dropdown-menu-item-selected {\n      ",";\n      color: ",";\n    }\n\n    .ant-select-dropdown-menu-item:hover:not(.ant-select-dropdown-menu-item-disabled) {\n      ",";\n      background-color: unset;\n    }\n  }\n"])),u.a.layer1,p.a.level3,g.a.title,u.a.layer1,c.a.primary(5),Object(m.a)()),y=Object(l.b)(o||(o=Object(d.__makeTemplateObject)(["\n  .ant-table-filter-dropdown {\n    ",";\n\n    .ant-dropdown-menu {\n      ",";\n\n      .ant-dropdown-menu-item {\n        ",";\n        ",";\n\n        :hover {\n          background-color: unset;\n        }\n\n        .ant-checkbox-checked .ant-checkbox-inner {\n          background-color: ",";\n          border-color: ",";\n        }\n      }\n\n      .ant-dropdown-menu-item-selected {\n        ",";\n      }\n    }\n\n    .ant-table-filter-dropdown-btns {\n      border-top: 1px solid ",";\n\n      .ant-btn-link {\n        ",";\n      }\n    }\n  }\n"],["\n  .ant-table-filter-dropdown {\n    ",";\n\n    .ant-dropdown-menu {\n      ",";\n\n      .ant-dropdown-menu-item {\n        ",";\n        ",";\n\n        :hover {\n          background-color: unset;\n        }\n\n        .ant-checkbox-checked .ant-checkbox-inner {\n          background-color: ",";\n          border-color: ",";\n        }\n      }\n\n      .ant-dropdown-menu-item-selected {\n        ",";\n      }\n    }\n\n    .ant-table-filter-dropdown-btns {\n      border-top: 1px solid ",";\n\n      .ant-btn-link {\n        ",";\n      }\n    }\n  }\n"])),u.a.layer1,u.a.layer1,g.a.title,Object(m.a)({top:0,right:0,bottom:0,left:0}),c.a.primary(5),c.a.primary(5),u.a.layer1,c.a.grey(4),g.a.title)},sOys:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("D57K"),i=n("D02H"),r=n("7j1U"),o=n("Hn49"),d=n("WDwU");function l(e){var t=e.children,n=Object(a.__rest)(e,["children"]),i=Object(d.b)(t);return Object(o.a)(Object(a.__assign)({options:i,createHandleItemClick:function(e){var t=e.disabled,n=e.onClick;if(!t)return n}},n))}l.Item=i.a,l.ItemGroup=r.a},sqX5:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n("D57K"),i=n("ERkP"),r=n.n(i),o=n("GG6d"),d=r.a.forwardRef((function(e,t){return r.a.createElement(o.a,Object(a.__assign)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"1em",height:"1em",fill:"currentColor",ref:t},e),r.a.createElement("path",{fillRule:"evenodd",d:"M1.104 12.444a1 1 0 010-.888c.13-.26.37-.693.722-1.241A18.85 18.85 0 013.88 7.652C6.184 5.176 8.896 3.667 12 3.667s5.816 1.509 8.119 3.985c.79.85 1.475 1.756 2.055 2.663.352.548.593.98.722 1.24a1 1 0 010 .89c-.13.26-.37.692-.722 1.24a18.848 18.848 0 01-2.055 2.663c-2.303 2.476-5.015 3.985-8.119 3.985s-5.816-1.509-8.119-3.985a18.846 18.846 0 01-2.055-2.663c-.352-.548-.593-.98-.722-1.24zm2.406.162a16.87 16.87 0 001.836 2.38c1.959 2.106 4.19 3.347 6.654 3.347 2.465 0 4.695-1.24 6.654-3.347A16.87 16.87 0 0020.86 12a16.871 16.871 0 00-2.206-2.986C16.695 6.908 14.464 5.667 12 5.667c-2.465 0-4.695 1.24-6.654 3.347A16.87 16.87 0 003.14 12c.108.188.232.391.37.607zM12 15.75c-2.06 0-3.727-1.68-3.727-3.75 0-2.07 1.667-3.75 3.727-3.75 2.06 0 3.727 1.68 3.727 3.75 0 2.07-1.667 3.75-3.727 3.75zm0-2c.952 0 1.727-.782 1.727-1.75s-.775-1.75-1.727-1.75c-.952 0-1.727.782-1.727 1.75s.775 1.75 1.727 1.75z",clipRule:"evenodd"}))}))},wgQk:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n("D57K"),i=n("ERkP"),r=n.n(i),o=n("GG6d"),d=r.a.forwardRef((function(e,t){return r.a.createElement(o.a,Object(a.__assign)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"1em",height:"1em",fill:"currentColor",ref:t},e),r.a.createElement("path",{fillRule:"evenodd",d:"M8 7a1 1 0 110-2h13a1 1 0 110 2H8zm0 6a1 1 0 110-2h13a1 1 0 110 2H8zm0 6a1 1 0 110-2h13a1 1 0 110 2H8zM2.952 6.85a1.201 1.201 0 111.698-1.7 1.201 1.201 0 01-1.698 1.7zm0 6a1.201 1.201 0 111.698-1.7 1.201 1.201 0 01-1.698 1.7zm0 6a1.201 1.201 0 111.698-1.7 1.201 1.201 0 01-1.698 1.7z",clipRule:"evenodd"}))}))}}]);